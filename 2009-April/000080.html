<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Ignition-commits] r51 - in trunk: . add-ons
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ignition-commits/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:ignition-commits%40lists.berlios.de?Subject=Re%3A%20%5BIgnition-commits%5D%20r51%20-%20in%20trunk%3A%20.%20add-ons&In-Reply-To=%3C200904222222.n3MMMAHl016838%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000081.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Ignition-commits] r51 - in trunk: . add-ons</H1>
    <B>marust at mail.berlios.de</B> 
    <A HREF="mailto:ignition-commits%40lists.berlios.de?Subject=Re%3A%20%5BIgnition-commits%5D%20r51%20-%20in%20trunk%3A%20.%20add-ons&In-Reply-To=%3C200904222222.n3MMMAHl016838%40sheep.berlios.de%3E"
       TITLE="[Ignition-commits] r51 - in trunk: . add-ons">marust at mail.berlios.de
       </A><BR>
    <I>Thu Apr 23 00:22:10 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000081.html">[Ignition-commits] r50 - in trunk: . libs/gtdrag libs/gtdrag/aros libs/gtdrag/aros/include libs/gtdrag/aros/include/clib libs/gtdrag/aros/include/defines libs/gtdrag/aros/include/proto libs/scroller libs/scroller/aros libs/scroller/aros/include libs/scroller/aros/include/clib libs/scroller/aros/include/defines libs/scroller/aros/include/proto libs/textedit libs/textedit/aros libs/textedit/aros/include libs/textedit/aros/include/clib  libs/textedit/aros/include/defines libs/textedit/aros/include/proto locale
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80">[ date ]</a>
              <a href="thread.html#80">[ thread ]</a>
              <a href="subject.html#80">[ subject ]</a>
              <a href="author.html#80">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: marust
Date: 2009-04-23 00:22:08 +0200 (Thu, 23 Apr 2009)
New Revision: 51
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/ignition?rev=51&amp;view=rev">http://svn.berlios.de/viewcvs/ignition?rev=51&amp;view=rev</A>

Removed:
   trunk/add-ons/mmakefile.src
Modified:
   trunk/Makefile
   trunk/add-ons/Makefile
Log:
* Add-ons: replaced mmakefile.src by Makefile.
* Some fixes for the main Makefile.


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2009-04-21 22:48:16 UTC (rev 50)
+++ trunk/Makefile	2009-04-22 22:22:08 UTC (rev 51)
@@ -137,11 +137,11 @@
 
 # Common Directories
 PREFIX   = $(CDTHIS)
-OBJDIR   = .obj_$(OS)
+OBJDIR   = OBJS
 VPATH    = $(OBJDIR)
 
 # target definition
-TARGET   = Ignition_$(OS)
+TARGET   = Ignition
 
 # Common compiler/linker flags
 WARN     = -W -Wall
@@ -289,8 +289,12 @@
 
 # main target
 .PHONY: all
-all: $(OBJDIR) $(TARGET)
+all: $(OBJDIR) $(TARGET) addons
 
+.PHONY: addons
+addons:
+	$(MAKE) -C add-ons
+
 # make the object directories
 $(OBJDIR):
 	@echo &quot;  MK $@&quot;
@@ -317,26 +321,23 @@
 # cleanup target
 .PHONY: clean
 clean:
-	-$(RM) $(TARGET) $(TARGET).debug $(addprefix $(OBJDIR)/,$(OBJS))
+	-$(RM) $(TARGET) $(TARGET).debug $(OBJDIR)/*.o
+	$(MAKE) clean -C add-ons
 
 # clean all including .obj directory
-.PHONY: cleanall
-cleanall: clean
+.PHONY: distclean
+distclean: clean
 	-$(RMDIR) $(OBJDIR)
+	-$(RM) ignition_strings.h Makefile.dep
+	$(MAKE) distclean -C add-ons
 
-# clean all stuff, including our autotools
-.PHONY: distclean
-distclean: cleanall
-	-$(RMDIR) $(TARGET).*
-
-
 ## DEPENDENCY GENERATION ##############
 
 Makefile.dep: ;
 	@echo &quot;WARNING: Makefile.dep missing. Please run 'make depend'&quot;
 
 .PHONY: depend
-depend:
+depend: ignition_strings.h
 	@echo &quot;  MK Makefile.dep&quot;
 	@echo &quot;# AUTOGENERATED! DO NOT EDIT!!!&quot; &gt;Makefile.dep
 	@$(CC) -MM $(CFLAGS) $(patsubst %.o,%.c, $(OBJS)) &gt;&gt;Makefile.dep

Modified: trunk/add-ons/Makefile
===================================================================
--- trunk/add-ons/Makefile	2009-04-21 22:48:16 UTC (rev 50)
+++ trunk/add-ons/Makefile	2009-04-22 22:22:08 UTC (rev 51)
@@ -1,61 +1,323 @@
-## ignition-Modules-Makefile
+## ignition-Makefile
 ##
 ## Copyright 1996-2009 pinc Software. All Rights Reserved.
 ## Licensed under the terms of the GNU General Public License, version 3.
 
-.c.o:
-	@echo &quot;compiling $*.c&quot;
-	@sc $(OPTIMIZE) $(CFLAGS) $(INCLUDES) $(DEFINES) $(DEBUG) gst=$(GST) cpu=$(CPU) idir=/ $*.c
 
-.c.oo:
-	sc $(CFLAGS) $(INCLUDES) $(DEFINES) $(DEBUG) cpu=$(CPU) gst=$(GST) objname=$*.oo $*.c
+###########################################################################
+# I've borrowed some ideas from the Makefile for &quot;codesets.library&quot;.
+# Note that this works currently only for AROS !
 
-.c.ooo:
-	sc $(OPTIMIZE) $(CFLAGS) $(INCLUDES) $(DEBUG) gst=$(GST) cpu=any objname=$*.ooo $*.c
 
-.asm.o:
-	asm -D -DCPU_$(CPU) -u $*.asm
+###########################################################################
+# This makefile is a very generic one. It tries to identify both, the host
+# and the target operating system for which Ignition should be compiled.
+# However, this auto-detection can be easily overridden by directly
+# specifying an option on the commandline while calling 'make'.
+#
+# Example:
+#
+# # to explicitly compile for AmigaOS3
+# &gt; make OS=os3
+#
+# # to compile for AmigaOS4 but without debugging
+# &gt; make OS=os4 DEBUG=
+#
 
-#CFLAGS			= nostkchk afp math=i ign=147
-CFLAGS			= nostkchk math=i code=n data=n nostartup ign=147 utillib
-#LFLAGS			= sc sd nd noicons
-LFLAGS			= sc sd noicons
+#############################################
+# find out the HOST operating system
+# on which this makefile is run
+HOST ?= $(shell uname)
+ifeq ($(HOST), AmigaOS)
+  ifeq ($(shell uname -m), powerpc)
+    HOST = AmigaOS4
+  endif
+  ifeq ($(shell uname -m), ppc)
+    HOST = AmigaOS4
+  endif
+endif
 
-#OPTIMIZE		= opt opttime
-OPTIMIZE		= noopt
-CPU				= 68040
-#CPU			= 68020
-INCLUDES		= idir=/libs/include idir=/libs
-#DEFINES		= def=IGNITION_LITE_EDITION
-DEFINES			=
-DEBUG			= dbg=l def=DEBUG
-#DEBUG			= nodbg
-LIBS			= lib:scmieee.lib lib:sc.lib lib:amiga.lib lib:debug.lib
-GST				= include:all.gst
+# if no host is identifed (no uname tool)
+# we assume a AmigaOS build
+ifeq ($(HOST),)
+  HOST = AmigaOS
+endif
 
-IOOBJS			= iotype.o
-GCOBJS			= gclass.o
+#############################################
+# now we find out the target OS for
+# which we are going to compile Ignition in case
+# the caller didn't yet define OS himself
+ifndef (OS)
+  ifeq ($(HOST), AmigaOS4)
+    OS = os4
+  else
+  ifeq ($(HOST), AmigaOS)
+    OS = os3
+  else
+  ifeq ($(HOST), MorphOS)
+    OS = mos
+  else
+  ifeq ($(HOST), AROS)
+    # now we find out which CPU system aros will be used
+    ifeq ($(shell uname -m), powerpc)
+      OS = aros-ppc
+    endif
+	 ifeq ($(shell uname -m), ppc)
+      OS = aros-ppc
+    endif
+	 ifeq ($(shell uname -m), i386)
+      OS = aros-i386
+    endif
+	 ifeq ($(shell uname -m), i686)
+      OS = aros-i686
+    endif
+	 ifeq ($(shell uname -m), x86_64)
+      OS = aros-x86_64
+    endif
+  else
+    OS = os4
+  endif
+  endif
+  endif
+  endif
+endif
 
-all:			ioobjs iotypes gcobjs gclasses
+#############################################
+# define common commands we use in this
+# makefile. Please note that each of them
+# might be overridden on the commandline.
 
-start:			all
+# common commands
+FLEX    = flex
+FC      = FlexCat
+EXPR    = expr
+DATE    = date
+RM      = delete force
+RMDIR   = delete force all
+MKDIR   = makedir
+CHMOD   = protect FLAGS=rwed
+CP      = copy
+CC      = gcc
+STRIP   = strip
+OBJDUMP = objdump
 
+# path definitions
+CDUP  = /
+CDTHIS=
+
+# override some variables for non-native builds (cross-compiler)
+ifneq ($(HOST), AmigaOS)
+ifneq ($(HOST), AmigaOS4)
+ifneq ($(HOST), MorphOS)
+
+  # when we end up here this is either a unix or Aros host
+  # so lets use unix kind of commands
+  RM    = rm -f
+  RMDIR = rm -rf
+  MKDIR = mkdir -p
+  CHMOD = chmod 755
+  CP    = cp -f
+
+  CDUP  = ../
+  CDTHIS= ./
+
+endif
+endif
+endif
+
+###########################################################################
+# CPU and DEBUG can be defined outside, defaults to above
+# using e.g. &quot;make DEBUG= CPU=-mcpu=603e&quot; produces optimized non-debug
+# PPC-603e version
+#
+# OPTFLAGS are disabled by DEBUG normally!
+#
+# ignored warnings are:
+# none - because we want to compile with -Wall all the time
+
+# Common Directories
+PREFIX   = $(CDTHIS)
+OBJDIR   = OBJS
+VPATH    = $(OBJDIR)
+
+# Common compiler/linker flags
+WARN     = -W -Wall
+OPTFLAGS = -O2 -fomit-frame-pointer -funroll-loops
+DEBUG    = -DDEBUG -O0
+DEBUGSYM = -gstabs
+CFLAGS   = -I.. -I../libs/include -I../libs/gtdrag/include \
+           $(CPU) $(WARN) $(OPTFLAGS) $(DEBUG) $(DEBUGSYM) $(USER_CFLAGS)
+LDFLAGS  = $(CPU) $(DEBUGSYM) -nostartfiles
+LDLIBS   =
+
+# different options per target OS
+ifeq ($(OS), os4)
+
+  ##############################
+  # AmigaOS4
+
+  # Compiler/link/strip commands
+  ifneq ($(HOST), AmigaOS4)
+    CC      = ppc-amigaos-gcc
+    STRIP   = ppc-amigaos-strip
+    OBJDUMP = ppc-amigaos-objdump
+  endif
+
+  # Compiler/Linker flags
+  CRT      = newlib
+  CPU      = -mcpu=powerpc
+  WARN     += -Wdeclaration-after-statement -Wdisabled-optimization
+  REDEFINE =
+  CFLAGS   += -mcrt=$(CRT) -D__USE_INLINE__ -D__NEW_TIMEVAL_DEFINITION_USED__ \
+              $(REDEFINE) -Wa,-mregnames
+  LDFLAGS  += -mcrt=$(CRT)
+
+else
+ifeq ($(OS), os3)
+
+  ##############################
+  # AmigaOS3
+
+  # Compiler/link/strip commands
+  ifneq ($(HOST), AmigaOS)
+    CC      = m68k-amigaos-gcc
+    STRIP   = m68k-amigaos-strip
+    OBJDUMP = m68k-amigaos-objdump
+  endif
+
+  # Compiler/Linker flags
+  CPU      = -m68020-60 -msoft-float
+  CFLAGS  += -noixemul
+  LDFLAGS += -noixemul
+  LDLIBS  += -ldebug
+
+else
+ifeq ($(OS), mos)
+
+  ##############################
+  # MorphOS
+
+  # Compiler/link/strip commands
+  ifneq ($(HOST), MorphOS)
+    CC      = ppc-morphos-gcc
+    STRIP   = ppc-morphos-strip
+    OBJDUMP = ppc-morphos-objdump
+  endif
+
+  # Compiler/Linker flags
+  CPU     = -mcpu=powerpc
+  CFLAGS  += -noixemul
+  LDFLAGS += -noixemul
+  LDLIBS  += -ldebug
+
+  OBJS = stubs-morphos.o
+
+else
+ifeq ($(OS), aros-i386)
+
+  ##############################
+  # AROS (i386)
+
+  ifneq ($(HOST), AROS)
+    CC      = i386-aros-gcc
+    STRIP   = i386-aros-strip
+    OBJDUMP = i386-aros-objdump
+  endif
+
+  # Compiler/Linker flags
+  CFLAGS += -Wno-pointer-sign -UDEBUG -fno-stack-protector
+  OBJS   += 
+  LDLIBS += -lrom
+
+else
+ifeq ($(OS), aros-ppc)
+
+  ##############################
+  # AROS (PPC)
+
+  ifneq ($(HOST), AROS)
+    CC      = ppc-aros-gcc
+    STRIP   = ppc-aros-strip
+    OBJDUMP = ppc-aros-objdump
+  endif
+
+  # Compiler/Linker flags
+  CFLAGS += -Wno-pointer-sign
+  LDLIBS +=
+
+else
+ifeq ($(OS), aros-x86_64)
+
+  ##############################
+  # AROS (x86_64)
+
+  ifneq ($(HOST), AROS)
+    CC      = x86_64-aros-gcc
+    STRIP   = x86_64-aros-strip
+    OBJDUMP = x86_64-aros-objdump
+  endif
+
+  # Compiler/Linker flags
+  CFLAGS += -Wno-pointer-sign
+  LDLIBS +=
+
+endif
+endif
+endif
+endif
+endif
+endif
+
+###########################################################################
+# Here starts all stuff that is common for all target platforms and
+# hosts.
+
+IOOBJS			= $(OBJDIR)/iotype.o $(OBJDIR)/iotype_variadic.o
+GCOBJS			= $(OBJDIR)/gclass.o $(OBJDIR)/gclass_variadic.o
+
+# main target
+.PHONY: all
+all: $(OBJDIR) ioobjs iotypes gcobjs gclasses
+
+# make the object directories
+$(OBJDIR):
+	@echo &quot;  MK $@&quot;
+	@$(MKDIR) $(OBJDIR)
+
+# for compiling single .c files
+$(OBJDIR)/%.o: %.c
+	@echo &quot;  CC $&lt;&quot;
+	$(CC) $(CFLAGS) -c $&lt; -o $@
+
+%.io : %.o $(IOOBJS)
+	@echo &quot;  LD $@&quot;
+	@$(CC) $(LDFLAGS) -o $@ $(IOOBJS) $&lt; $(LDLIBS)
+	@$(CHMOD) $@
+
+%.gc : %.o $(GCOBJS)
+	@echo &quot;  LD $@&quot;
+	@$(CC) $(LDFLAGS) -o $@ $(GCOBJS) $&lt; $(LDLIBS)
+	@$(CHMOD) $@
+
+# cleanup target
+.PHONY: clean
 clean:
-	delete *.o *.gc *.io
+	-$(RM) *.gc *.io $(OBJDIR)/*.o
 
-lib:
-	makelib /*.h gclass_functable.c name=gclass to=t:include fd=gclass.fd protos with=gclass_makelib.with
-	copy T:include/clib/gclass_protos.h &quot;&quot;
-	copy T:include/pragmas/gclass_pragmas.h &quot;&quot;
-	smake -a gcobjs gclasses
+# clean all stuff, including our autotools
+.PHONY: distclean
+distclean: clean
+	-$(RMDIR) $(OBJDIR)
 
-ioobjs:			$(IOOBJS) csv.o ascii.o turbocalc.o
+.PHONY: ioobjs iotypes gcobjs gclasses
+
+ioobjs:			$(IOOBJS) $(OBJDIR)/csv.o $(OBJDIR)/ascii.o $(OBJDIR)/turbocalc.o
 iotypes:		csv.io ascii.io turbocalc.io
 
 gcobjs:			$(GCOBJS) \
-				button.o checkbox.o frame.o text.o \
-				line.o rectangle.o gradient.o \
-				area_diagram.o column_diagram.o line_diagram.o circle_diagram.o
+				$(OBJDIR)/button.o $(OBJDIR)/checkbox.o $(OBJDIR)/frame.o $(OBJDIR)/text.o \
+				$(OBJDIR)/line.o $(OBJDIR)/rectangle.o $(OBJDIR)/gradient.o \
+				$(OBJDIR)/area_diagram.o $(OBJDIR)/column_diagram.o $(OBJDIR)/line_diagram.o $(OBJDIR)/circle_diagram.o
 
 gclasses:		button.gc checkbox.gc frame.gc text.gc \
 				line.gc rectangle.gc gradient.gc \
@@ -63,15 +325,3 @@
 
 iotype.c:		iotype.h
 gclass.c:		gclass.h
-
-%.io : %.o 			$(IOOBJS) #%.o
-	@echo &quot;linking $@...&quot;
-	@slink with lib:utillib.with from $(IOOBJS) $*.o to $@ lib $(LIBS) $(LFLAGS)
-
-%.gc : %.o 			$(GCOBJS) #%.o
-	@echo &quot;linking $@...&quot;
-	@slink with lib:utillib.with \
-		from $(GCOBJS) $*.o \
-		to $@ \
-		lib $(LIBS) \
-		$(LFLAGS)

Deleted: trunk/add-ons/mmakefile.src


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000081.html">[Ignition-commits] r50 - in trunk: . libs/gtdrag libs/gtdrag/aros libs/gtdrag/aros/include libs/gtdrag/aros/include/clib libs/gtdrag/aros/include/defines libs/gtdrag/aros/include/proto libs/scroller libs/scroller/aros libs/scroller/aros/include libs/scroller/aros/include/clib libs/scroller/aros/include/defines libs/scroller/aros/include/proto libs/textedit libs/textedit/aros libs/textedit/aros/include libs/textedit/aros/include/clib  libs/textedit/aros/include/defines libs/textedit/aros/include/proto locale
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80">[ date ]</a>
              <a href="thread.html#80">[ thread ]</a>
              <a href="subject.html#80">[ subject ]</a>
              <a href="author.html#80">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ignition-commits">More information about the Ignition-commits
mailing list</a><br>
</body></html>
