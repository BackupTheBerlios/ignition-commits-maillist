From marust at mail.berlios.de  Sat Dec 13 07:22:02 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:22:02 +0100
Subject: [Ignition-commits] r5 - in trunk/libs/scroller: . include/gadgets
Message-ID: <200812130622.mBD6M2rG003259@sheep.berlios.de>

Author: marust
Date: 2008-12-13 07:21:37 +0100 (Sat, 13 Dec 2008)
New Revision: 5
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=5&view=rev

Added:
   trunk/libs/scroller/Scroller_lib_aros.c
   trunk/libs/scroller/mmakefile.src
   trunk/libs/scroller/pScroller.conf
Modified:
   trunk/libs/scroller/
   trunk/libs/scroller/SMakefile
   trunk/libs/scroller/Scroller.c
   trunk/libs/scroller/Scroller_includes.h
   trunk/libs/scroller/Scroller_lib.c
   trunk/libs/scroller/Scroller_rev.i
   trunk/libs/scroller/Scroller_romtag.asm
   trunk/libs/scroller/include/gadgets/Scroller.h
Log:
* AROS/GCC port


Property changes on: trunk/libs/scroller
___________________________________________________________________
Name: svn:ignore
   + mmakefile



Property changes on: trunk/libs/scroller/SMakefile
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/scroller/Scroller.c
===================================================================
--- trunk/libs/scroller/Scroller.c	2008-12-11 22:38:32 UTC (rev 4)
+++ trunk/libs/scroller/Scroller.c	2008-12-13 06:21:37 UTC (rev 5)
@@ -3,80 +3,21 @@
  * Licensed under the terms of the MIT License.
  */
 
-//!	init & support functions.
+//!	dispatcher functions.
 
 
 #include "Scroller_includes.h"
 
 
-Class * PUBLIC GetClass(reg (a6) APTR cb)
-{
-  return(((struct ClassBase *)cb)->cb_ScrollerClass);
-}
-
-
-void PRIVATE SC_Exit(struct ClassBase *cb)
-{
-  if (FreeClass(cb->cb_ScrollerClass))
-    cb->cb_ScrollerClass = NULL;
-  if (FreeClass(cb->cb_ArrowClass))
-    cb->cb_ArrowClass = NULL;
-
-  CloseLibrary(cb->cb_IntuitionBase);
-  CloseLibrary((struct Library *)cb->cb_GfxBase);
-  CloseLibrary(cb->cb_UtilityBase);
-}
-
-
-int PRIVATE SC_Init(struct ClassBase *cb)
-{
-  if (cb->cb_IntuitionBase = OpenLibrary("intuition.library",37))
-  {
-    if (cb->cb_GfxBase = (APTR)OpenLibrary("graphics.library",37))
-    {
-      if (cb->cb_UtilityBase = OpenLibrary("utility.library",37))
-      {
-        Class *cl;
-
-        if (cl = MakeClass("pinc-scrollergadget","propgclass",NULL,sizeof(struct ScrollerGData),0))
-        {
-          cl->cl_Dispatcher.h_Entry = (APTR)DispatchScrollerGadget;
-          cl->cl_Dispatcher.h_Data = cb;
-          cl->cl_UserData = (ULONG)cb;
-          AddClass(cl);
-
-          cb->cb_ScrollerClass = cl;
-
-          if (cl = MakeClass("pinc-arrowimage","imageclass",NULL,sizeof(struct ArrowIData),0))
-          {
-            cl->cl_Dispatcher.h_Entry = (APTR)DispatchArrowImage;
-            cl->cl_Dispatcher.h_Data = cb;
-            cl->cl_UserData = (ULONG)cb;
-            //AddClass(cl);
-
-            cb->cb_ArrowClass = cl;
-            return(TRUE);
-          }
-          FreeClass(cl);
-        }
-        CloseLibrary(cb->cb_UtilityBase);
-      }
-      CloseLibrary(cb->cb_GfxBase);
-    }
-    CloseLibrary(cb->cb_IntuitionBase);
-  }
-  return(FALSE);
-}
-
 /********************************** Arrow-Images **********************************/
 
 #define IM(o) ((struct Image *)o)
 
-ULONG PUBLIC DispatchArrowImage(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg)
+IPTR PUBLIC DispatchArrowImage(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
   struct ArrowIData *ad;
   struct ClassBase *cb;
-  ULONG  retval = 0;
+  IPTR   retval = 0;
 
   ad = INST_DATA(cl,o);
   cb = (APTR)cl->cl_UserData;
@@ -84,7 +25,7 @@
   switch(msg->MethodID)
   {
     case OM_NEW:
-      if (retval = DoSuperMethodA(cl,o,msg))
+      if ((retval = DoSuperMethodA(cl,o,msg)) != 0)
       {
         IM(retval)->Width = GetTagData(IA_Width,16,((struct opSet *)msg)->ops_AttrList);
         IM(retval)->Height = GetTagData(IA_Height,13,((struct opSet *)msg)->ops_AttrList);
@@ -156,12 +97,12 @@
 
 BOOL PRIVATE DispatchScrollerNew(struct ClassBase *cb,struct ScrollerGData *sd,struct Gadget *gad,struct opSet *ops)
 {
-  static ULONG upmap[] = {GA_ID,SGA_Up,TAG_END};
-  static ULONG downmap[] = {GA_ID,SGA_Down,TAG_END};
+  static struct TagItem upmap[] = {{GA_ID,SGA_Up},{TAG_END}};
+  static struct TagItem downmap[] = {{GA_ID,SGA_Down},{TAG_END}};
   struct Gadget *previous;
   long   x,y,w,h;
 
-  if (!(previous = (struct Gadget *)GetTagData(GA_Previous,NULL,ops->ops_AttrList)))
+  if (!(previous = (struct Gadget *)GetTagData(GA_Previous,0,ops->ops_AttrList)))
     return(FALSE);
   sd->sd_ItemHeight = GetTagData(SGA_ItemHeight,13,ops->ops_AttrList);
 
@@ -209,11 +150,11 @@
 }
 
 
-ULONG PUBLIC DispatchScrollerGadget(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg)
+IPTR PUBLIC DispatchScrollerGadget(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
   struct ScrollerGData *sd;
   struct ClassBase *cb;
-  ULONG  retval = 0;
+  IPTR   retval = 0;
 
   sd = INST_DATA(cl,o);
   cb = (APTR)cl->cl_UserData;
@@ -221,7 +162,7 @@
   switch(msg->MethodID)
   {
     case OM_NEW:
-      if (retval = DoSuperMethodA(cl,o,msg))
+      if ((retval = DoSuperMethodA(cl,o,msg)) != 0)
       {
         struct Gadget *gad = (struct Gadget *)retval;
 
@@ -241,7 +182,7 @@
         else
         {
           DoMethod(o,OM_DISPOSE);
-          retval = NULL;
+          retval = 0;
         }
       }
       break;
@@ -252,7 +193,7 @@
 
       retval = DoSuperMethodA(cl,o,msg);
 
-      if (move = -GetTagData(SGA_Up,0,opu->opu_AttrList))
+      if ((move = -GetTagData(SGA_Up,0,opu->opu_AttrList)) != 0)
         if (!(sd->sd_Up->Flags & GFLG_SELECTED))
           move = 0;
       if (!move && (move = GetTagData(SGA_Down,0,opu->opu_AttrList)))
@@ -262,16 +203,16 @@
       {
         long top;
 
-        if (GetAttr(PGA_Top,o,(ULONG *)&top))
+        if (GetAttr(PGA_Top,o,(IPTR *)&top))
         {
           top += move;
           if (top >= 0)
           {
             struct RastPort *rp = ObtainGIRPort(opu->opu_GInfo);
-            ULONG  tags[] = {PGA_Top,0,TAG_END};
+            struct TagItem  tags[] = {{PGA_Top,0},{TAG_END}};
 
             SetAttrs(o,PGA_Top,top,TAG_END);
-            GetAttr(PGA_Top,o,&tags[1]);
+            GetAttr(PGA_Top,o,&tags[0].ti_Data);
             DoSuperMethod(cl,o,OM_NOTIFY,tags,opu->opu_GInfo,0);
             DoSuperMethod(cl,o,GM_RENDER,opu->opu_GInfo,rp,GREDRAW_UPDATE);
             ReleaseGIRPort(rp);
@@ -301,4 +242,3 @@
   }
   return(retval);
 }
-


Property changes on: trunk/libs/scroller/Scroller.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/scroller/Scroller_includes.h
===================================================================
--- trunk/libs/scroller/Scroller_includes.h	2008-12-11 22:38:32 UTC (rev 4)
+++ trunk/libs/scroller/Scroller_includes.h	2008-12-13 06:21:37 UTC (rev 5)
@@ -5,14 +5,20 @@
 #ifndef SCROLLER_INCLUDES_H
 #define SCROLLER_INCLUDES_H
 
+
 #define INTUI_V36_NAMES_ONLY
-#define __USE_SYSBASE
 
-#define SysBase cb->cb_SysBase
-#define IntuitionBase cb->cb_IntuitionBase
-#define GfxBase cb->cb_GfxBase
-#define UtilityBase cb->cb_UtilityBase
+#if defined(__SASC)
+#	define __USE_SYSBASE
 
+#	define SysBase cb->cb_SysBase
+#	define IntuitionBase cb->cb_IntuitionBase
+#	define GfxBase cb->cb_GfxBase
+#	define UtilityBase cb->cb_UtilityBase
+#endif
+
+#include "SDI_compiler.h"
+
 #include <exec/execbase.h>
 #include <exec/libraries.h>
 #include <exec/nodes.h>
@@ -29,28 +35,23 @@
 #include <gadgets/Scroller.h>
 #include <dos/dos.h>
 
-#include <clib/exec_protos.h>
-#include <clib/intuition_protos.h>
-#include <clib/graphics_protos.h>
-#include <clib/utility_protos.h>
+#include <proto/exec.h>
+#include <proto/intuition.h>
+#include <proto/graphics.h>
+#include <proto/utility.h>
 
-#include <pragmas/exec_pragmas.h>
-#include <pragmas/intuition_pragmas.h>
-#include <pragmas/graphics_pragmas.h>
-#include <pragmas/utility_pragmas.h>
+#if defined(__SASC)
+#	include <pragmas/exec_pragmas.h>
+#	include <pragmas/intuition_pragmas.h>
+#	include <pragmas/graphics_pragmas.h>
+#	include <pragmas/utility_pragmas.h>
+#endif
 
 #include <stdlib.h>
 #include <ctype.h>
 #include <string.h>
 #include <math.h>
 
-#define PUBLIC __asm __saveds
-#define PRIVATE __regargs
-#define reg(x) register __ ## x
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 #define ID_FTXT  MAKE_ID('F','T','X','T')
 #define ID_CHRS  MAKE_ID('C','H','R','S')
 
@@ -101,9 +102,8 @@
 extern void PRIVATE SC_Exit(struct ClassBase *cb);
 
 /** public functions **/
+extern Class * PUBLIC GetClass(REG(a6, APTR classbase));
+extern IPTR PUBLIC DispatchScrollerGadget(REG(a0, Class *cl),REG(a2, Object *o),REG(a1, Msg msg));
+extern IPTR PUBLIC DispatchArrowImage(REG(a0, Class *cl),REG(a2,Object *o),REG(a1, Msg msg));
 
-extern Class * PUBLIC GetClass(reg (a6) APTR classbase);
-extern ULONG PUBLIC DispatchScrollerGadget(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg);
-extern ULONG PUBLIC DispatchArrowImage(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg);
-
 #endif    // SCROLLER_INCLUDES_H


Property changes on: trunk/libs/scroller/Scroller_includes.h
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/scroller/Scroller_lib.c
===================================================================
--- trunk/libs/scroller/Scroller_lib.c	2008-12-11 22:38:32 UTC (rev 4)
+++ trunk/libs/scroller/Scroller_lib.c	2008-12-13 06:21:37 UTC (rev 5)
@@ -9,12 +9,73 @@
 #include "Scroller_includes.h"
 
 
-struct Library * PUBLIC LibInit(reg (a0) BPTR Segment,reg (d0) struct ClassBase *cb,reg (a6) struct ExecBase *ExecBase);
-struct Library * PUBLIC LibOpen(reg (a6) struct ClassBase *cb);
-BPTR PUBLIC LibExpunge(reg (a6) struct ClassBase *cb);
-BPTR PUBLIC LibClose(reg (a6) struct ClassBase *cb);
-LONG PUBLIC LibNull(reg (a6) struct ClassBase *cb);
+struct Library * PUBLIC LibInit(REG(a0, BPTR Segment),REG(d0, struct ClassBase *cb),REG(a6, struct ExecBase *ExecBase);
+struct Library * PUBLIC LibOpen(REG(a6, struct ClassBase *cb));
+BPTR PUBLIC LibExpunge(REG(a6, struct ClassBase *cb));
+BPTR PUBLIC LibClose(REG(a6, struct ClassBase *cb));
+LONG PUBLIC LibNull(REG(a6, struct ClassBase *cb));
 
+
+void PRIVATE SC_Exit(struct ClassBase *cb)
+{
+  if (FreeClass(cb->cb_ScrollerClass))
+    cb->cb_ScrollerClass = NULL;
+  if (FreeClass(cb->cb_ArrowClass))
+    cb->cb_ArrowClass = NULL;
+
+  CloseLibrary(cb->cb_IntuitionBase);
+  CloseLibrary((struct Library *)cb->cb_GfxBase);
+  CloseLibrary(cb->cb_UtilityBase);
+}
+
+
+int PRIVATE SC_Init(struct ClassBase *cb)
+{
+  if (cb->cb_IntuitionBase = OpenLibrary("intuition.library",37))
+  {
+    if (cb->cb_GfxBase = (APTR)OpenLibrary("graphics.library",37))
+    {
+      if (cb->cb_UtilityBase = OpenLibrary("utility.library",37))
+      {
+        Class *cl;
+
+        if (cl = MakeClass("pinc-scrollergadget","propgclass",NULL,sizeof(struct ScrollerGData),0))
+        {
+          cl->cl_Dispatcher.h_Entry = (APTR)DispatchScrollerGadget;
+          cl->cl_Dispatcher.h_Data = cb;
+          cl->cl_UserData = (ULONG)cb;
+          AddClass(cl);
+
+          cb->cb_ScrollerClass = cl;
+
+          if (cl = MakeClass("pinc-arrowimage","imageclass",NULL,sizeof(struct ArrowIData),0))
+          {
+            cl->cl_Dispatcher.h_Entry = (APTR)DispatchArrowImage;
+            cl->cl_Dispatcher.h_Data = cb;
+            cl->cl_UserData = (ULONG)cb;
+            //AddClass(cl);
+
+            cb->cb_ArrowClass = cl;
+            return(TRUE);
+          }
+          FreeClass(cl);
+        }
+        CloseLibrary(cb->cb_UtilityBase);
+      }
+      CloseLibrary(cb->cb_GfxBase);
+    }
+    CloseLibrary(cb->cb_IntuitionBase);
+  }
+  return(FALSE);
+}
+
+
+Class * PUBLIC GetClass(REG(a6, APTR cb))
+{
+  return(((struct ClassBase *)cb)->cb_ScrollerClass);
+}
+
+
 STATIC APTR LibVectors[] =
 {
   LibOpen,
@@ -39,7 +100,7 @@
 };
 
 
-struct Library * PUBLIC LibInit(reg (a0) BPTR segment,reg (d0) struct ClassBase *cb,reg (a6) struct ExecBase *ExecBase)
+struct Library * PUBLIC LibInit(REG(a0, BPTR segment),REG(d0, struct ClassBase *cb),REG(a6, struct ExecBase *ExecBase))
 {
   if(ExecBase->LibNode.lib_Version < 37)
     return(NULL);
@@ -59,7 +120,7 @@
 }
 
 
-struct Library * PUBLIC LibOpen(reg (a6) struct ClassBase *cb)
+struct Library * PUBLIC LibOpen(REG(a6, struct ClassBase *cb))
 {
   cb->cb_LibNode.lib_Flags &= ~LIBF_DELEXP;
   cb->cb_LibNode.lib_OpenCnt++;
@@ -82,7 +143,7 @@
 }
 
 
-BPTR PUBLIC LibExpunge(reg (a6) struct ClassBase *cb)
+BPTR PUBLIC LibExpunge(REG(a6, struct ClassBase *cb))
 {
   if (!cb->cb_LibNode.lib_OpenCnt && cb->cb_LibSegment)
   {
@@ -100,7 +161,7 @@
 }
 
 
-BPTR PUBLIC LibClose(reg (a6) struct ClassBase *cb)
+BPTR PUBLIC LibClose(REG(a6, struct ClassBase *cb))
 {
   if (cb->cb_LibNode.lib_OpenCnt)
     cb->cb_LibNode.lib_OpenCnt--;
@@ -118,9 +179,7 @@
 }
 
 
-LONG PUBLIC LibNull(reg (a6) struct ClassBase *cb)
+LONG PUBLIC LibNull(REG(a6, struct ClassBase *cb))
 {
   return(NULL);
 }
-
-


Property changes on: trunk/libs/scroller/Scroller_lib.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Added: trunk/libs/scroller/Scroller_lib_aros.c
===================================================================
--- trunk/libs/scroller/Scroller_lib_aros.c	2008-12-11 22:38:32 UTC (rev 4)
+++ trunk/libs/scroller/Scroller_lib_aros.c	2008-12-13 06:21:37 UTC (rev 5)
@@ -0,0 +1,23 @@
+/*
+ * Copyright ?1999-2008 pinc Software. All Rights Reserved.
+ * Licensed under the terms of the MIT License.
+ */
+
+//!	AROS init functions.
+
+
+#include "Scroller_includes.h"
+
+#include <aros/symbolsets.h>
+
+struct IClass *pscrollervar;
+struct IClass *parrowvar;
+
+int SC_Init(struct ClassBase *cb)
+{
+  cb->cb_ScrollerClass = pscrollervar;
+  cb->cb_ArrowClass = parrowvar;
+  return TRUE;
+}
+
+ADD2OPENLIB(SC_Init, 0);


Property changes on: trunk/libs/scroller/Scroller_lib_aros.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/libs/scroller/Scroller_rev.i
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/libs/scroller/Scroller_romtag.asm
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/libs/scroller/include/gadgets/Scroller.h
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Added: trunk/libs/scroller/mmakefile.src
===================================================================
--- trunk/libs/scroller/mmakefile.src	2008-12-11 22:38:32 UTC (rev 4)
+++ trunk/libs/scroller/mmakefile.src	2008-12-13 06:21:37 UTC (rev 5)
@@ -0,0 +1,19 @@
+# $Id$
+
+include $(TOP)/config/make.cfg
+
+#MM contrib-ignition-scroller : includes linklibs
+
+FILES := Scroller Scroller_lib_aros
+USER_INCLUDES := -I../include
+
+%build_module mmake=contrib-ignition-scroller \
+  modname=pScroller modtype=gadget \
+  files=$(FILES) uselibs="amiga rom"
+
+#MM includes-copy
+
+INCLUDE_FILES := include/gadgets/Scroller.h
+%copy_includes path=gadgets dir=include/gadgets
+
+%common


Property changes on: trunk/libs/scroller/mmakefile.src
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Added: trunk/libs/scroller/pScroller.conf
===================================================================
--- trunk/libs/scroller/pScroller.conf	2008-12-11 22:38:32 UTC (rev 4)
+++ trunk/libs/scroller/pScroller.conf	2008-12-13 06:21:37 UTC (rev 5)
@@ -0,0 +1,34 @@
+##begin config
+basename pScroller
+libbasetype struct ClassBase
+version 0.2
+date 23.9.2000
+copyright Copyright (C) 1999-2008 pinc Software
+superclass PROPGCLASS
+classdatatype struct ScrollerGData
+dispatcher DispatchScrollerGadget
+classid "pinc-scrollergadget"
+classptr_var pscrollervar
+##end config
+
+##begin cdef
+#include <gadgets/Scroller.h>
+##end cdef
+
+##begin cdefprivate
+#include "Scroller_includes.h"
+extern struct IClass *pscrollervar;
+extern struct IClass *parrowvar;
+##end cdefprivate
+
+##begin class
+##begin config
+basename pArrow
+type image
+superclass IMAGECLASS
+classdatatype struct ArrowIData
+dispatcher DispatchArrowImage
+classid "pinc-arrowimage"
+classptr_var parrowvar
+##end config
+##end class


Property changes on: trunk/libs/scroller/pScroller.conf
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native



From marust at mail.berlios.de  Sat Dec 13 07:36:38 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:36:38 +0100
Subject: [Ignition-commits] r6 - in trunk/libs/textedit: . fd include/clib
	include/gadgets include/pragmas include/proto test
Message-ID: <200812130636.mBD6acrU027940@sheep.berlios.de>

Author: marust
Date: 2008-12-13 07:36:25 +0100 (Sat, 13 Dec 2008)
New Revision: 6
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=6&view=rev

Added:
   trunk/libs/textedit/TextEdit_lib_aros.c
   trunk/libs/textedit/mmakefile.src
   trunk/libs/textedit/pTextEdit.conf
   trunk/libs/textedit/test/mmakefile.src
Modified:
   trunk/libs/textedit/
   trunk/libs/textedit/SMakefile
   trunk/libs/textedit/TE_clip.c
   trunk/libs/textedit/TE_dispatch.c
   trunk/libs/textedit/TE_draw.c
   trunk/libs/textedit/TextEdit.c
   trunk/libs/textedit/TextEdit_includes.h
   trunk/libs/textedit/TextEdit_lib.c
   trunk/libs/textedit/TextEdit_rev.i
   trunk/libs/textedit/TextEdit_romtag.asm
   trunk/libs/textedit/fd/TextEdit_lib.fd
   trunk/libs/textedit/include/clib/TextEdit_protos.h
   trunk/libs/textedit/include/gadgets/TextEdit.h
   trunk/libs/textedit/include/pragmas/TextEdit_pragmas.h
   trunk/libs/textedit/include/proto/TextEdit.h
   trunk/libs/textedit/test/
   trunk/libs/textedit/test/tedit.c
Log:
* AROS/GCC port
* made struct EditGData public because
  it's needed as function argument


Property changes on: trunk/libs/textedit
___________________________________________________________________
Name: svn:ignore
   + mmakefile



Property changes on: trunk/libs/textedit/SMakefile
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/textedit/TE_clip.c
===================================================================
--- trunk/libs/textedit/TE_clip.c	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TE_clip.c	2008-12-13 06:36:25 UTC (rev 6)
@@ -10,14 +10,14 @@
 #include "dos/dostags.h"
 
 
-void PUBLIC internal_Text2Clipboard(reg (d0) UBYTE clipunit,reg (a0) STRPTR t,reg (d1) long len,reg (a6) struct ClassBase *cb)
+void PUBLIC internal_Text2Clipboard(REG(d0, UBYTE clipunit),REG(a0, STRPTR t),REG(d1, long len),REG(a6, struct ClassBase *cb))
 {
   struct IFFHandle *iff;
   long   error;
 
-  if (iff = AllocIFF())
+  if ((iff = AllocIFF()) != 0)
   {
-    if (iff->iff_Stream = (ULONG)OpenClipboard((long)clipunit))
+    if ((iff->iff_Stream = (ULONG)OpenClipboard((long)clipunit)) != 0)
     {
       InitIFFasClip(iff);
       if (!(error = OpenIFF(iff,IFFF_WRITE)))
@@ -46,15 +46,15 @@
 }
 
 
-STRPTR PUBLIC internal_TextFromClipboard(reg(d0) UBYTE clipunit,reg (a0) APTR pool,reg (a6) struct ClassBase *cb)
+STRPTR PUBLIC internal_TextFromClipboard(REG(d0, UBYTE clipunit),REG(a0, APTR pool),REG(a6, struct ClassBase *cb))
 {
   struct IFFHandle *iff;
   long   error,size = 1;
   STRPTR t = NULL,temp;
 
-  if (iff = AllocIFF())
+  if ((iff = AllocIFF()) != 0)
   {
-    if (iff->iff_Stream = (ULONG)OpenClipboard(clipunit))
+    if ((iff->iff_Stream = (ULONG)OpenClipboard(clipunit)) != 0)
     {
       InitIFFasClip(iff);
 
@@ -73,7 +73,7 @@
 
           if ((cn = CurrentChunk(iff)) && cn->cn_ID == ID_CHRS && cn->cn_Type == ID_FTXT)
           {
-            if (temp = AllocPooled(pool,size+cn->cn_Size+(t ? 1 : 0)))
+            if ((temp = AllocPooled(pool,size+cn->cn_Size+(t ? 1 : 0))) != 0)
             {
               if (t)
               {
@@ -119,8 +119,14 @@
 }
 
 
-void PUBLIC Text2Clipboard(reg (d0) UBYTE clipunit,reg (a0) STRPTR t,reg (d1) long len,reg (a6) struct ClassBase *cb)
+LIB_LH3(void, Text2Clipboard,
+  LIB_LHA(UBYTE, clipunit, D0),
+  LIB_LHA(STRPTR, t, A0),
+  LIB_LHA(long, len, D1),
+  struct ClassBase *, cb, 5, pTextEdit)
 {
+  LIBFUNC_INIT
+
   struct Task *this;
 
   if (!t || !len || !cb->cb_IFFParseBase)
@@ -147,11 +153,18 @@
   }
   else
     internal_Text2Clipboard(clipunit,t,len,cb);
+
+  LIBFUNC_EXIT
 }
 
 
-STRPTR PUBLIC TextFromClipboard(reg(d0) UBYTE clipunit,reg (a0) APTR pool,reg (a6) struct ClassBase *cb)
+LIB_LH2(STRPTR, TextFromClipboard,
+  LIB_LHA(UBYTE, clipunit, A0),
+  LIB_LHA(APTR, pool, A0),
+  struct ClassBase *, cb, 6, pTextEdit)
 {
+  LIBFUNC_INIT
+
   struct Task *this;
 
   if (!pool || !cb->cb_IFFParseBase)
@@ -184,6 +197,6 @@
   }
   else
     return(internal_TextFromClipboard(clipunit,pool,cb));
+
+  LIBFUNC_EXIT
 }
-
-


Property changes on: trunk/libs/textedit/TE_clip.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/textedit/TE_dispatch.c
===================================================================
--- trunk/libs/textedit/TE_dispatch.c	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TE_dispatch.c	2008-12-13 06:36:25 UTC (rev 6)
@@ -7,8 +7,8 @@
 
 
 #include "TextEdit_includes.h"
+#include "compatibility.h"
 
-
 ULONG PRIVATE DispatchEditHandleRawKey(struct ClassBase *cb,struct EditGData *ed,struct gpInput *gpi,struct Gadget *gad,struct InputEvent *ie)
 {
   struct RastPort *rp = ObtainGIRPort(gpi->gpi_GInfo);
@@ -21,7 +21,7 @@
   {
     case CURSORUP:
     case CURSORDOWN:
-      if (mln = GetEditCursorLine(ed,ed->ed_Pos,&line))
+      if ((mln = GetEditCursorLine(ed,ed->ed_Pos,&line)) != 0)
         pos = ed->ed_Text+ed->ed_Pos-EDITLINE(mln)->el_Word;
     case CURSORLEFT:
     case CURSORRIGHT:
@@ -37,7 +37,7 @@
           else
             mln = ed->ed_List.mlh_TailPred;
         }
-        else if (mln = GetEditCursorLine(ed,ed->ed_Pos,&line))
+        else if ((mln = GetEditCursorLine(ed,ed->ed_Pos,&line)) != 0)
         {
           struct EditLine *el,*fel = EDITLINE(mln);
 
@@ -98,7 +98,7 @@
           else
             for(;mln->mln_Succ->mln_Succ && line < ed->ed_Lines-1;mln = mln->mln_Succ,line++);
         }
-        else if (mln = GetEditCursorLine(ed,ed->ed_Pos,&line))
+        else if ((mln = GetEditCursorLine(ed,ed->ed_Pos,&line)) != 0)
         {
           if (ie->ie_Code == CURSORLEFT)
             ed->ed_Pos = EDITLINE(mln)->el_Word-ed->ed_Text;
@@ -167,7 +167,7 @@
             {
               case 'c':
                 DrawEditCursor(cb,rp,gad,ed);
-                Text2Clipboard(ed->ed_ClipUnit,ed->ed_Text+pos,len,cb);
+                Text2Clipboard(ed->ed_ClipUnit,ed->ed_Text+pos,len);
                 ed->ed_Pos = ed->ed_MarkPos;
                 DrawEditCursor(cb,rp,gad,ed);
                 break;
@@ -176,9 +176,9 @@
                 STRPTR t;
                 long   len;
 
-                if (t = TextFromClipboard(ed->ed_ClipUnit,ed->ed_Pool,cb))
+                if ((t = TextFromClipboard(ed->ed_ClipUnit,ed->ed_Pool)) != 0)
                 {
-                  FreeEditList(cb,ed);
+                  FreeEditList(ed);
                   if ((len = strlen(t)+1) > ed->ed_Size-strlen(ed->ed_Text))
                     SetEditBuffer(cb,ed,ed->ed_Size+len);
                   strins(ed->ed_Text+ed->ed_Pos,t);
@@ -190,16 +190,16 @@
                 break;
               }
               case 'x':
-                FreeEditList(cb,ed);
+                FreeEditList(ed);
                 if (len < 2)
                 {
-                  Text2Clipboard(ed->ed_ClipUnit,ed->ed_Text,strlen(ed->ed_Text),cb);
+                  Text2Clipboard(ed->ed_ClipUnit,ed->ed_Text,strlen(ed->ed_Text));
                   *ed->ed_Text = 0;
                   ed->ed_Pos = 0;
                 }
                 else
                 {
-                  Text2Clipboard(ed->ed_ClipUnit,ed->ed_Text+pos,len,cb);
+                  Text2Clipboard(ed->ed_ClipUnit,ed->ed_Text+pos,len);
                   strdel(ed->ed_Text+pos,len);
                   ed->ed_Pos = pos;
                 }
@@ -213,7 +213,7 @@
             switch(c[0])
             {
               case 13:   /* Return */
-                FreeEditList(cb,ed);
+                FreeEditList(ed);
                 if (ed->ed_Flags & EDF_AUTOINDENT)
                 {
                   int  spaces = 0,pos,i;
@@ -249,7 +249,7 @@
                   break;
                 if (ie->ie_Qualifier & (IEQUALIFIER_RSHIFT | IEQUALIFIER_LSHIFT | IEQUALIFIER_LALT | IEQUALIFIER_RALT))
                 {
-                  if (mln = GetEditCursorLine(ed,ed->ed_Pos,&line))
+                  if ((mln = GetEditCursorLine(ed,ed->ed_Pos,&line)) != 0)
                   {
                     struct EditLine *el = EDITLINE(mln);
 
@@ -270,13 +270,13 @@
                         strdel(ed->ed_Text+ed->ed_Pos,1);
                       }
                     }
-                    FreeEditList(cb,ed);
+                    FreeEditList(ed);
                     break;
                   }
                 }
                 else
                 {
-                  FreeEditList(cb,ed);
+                  FreeEditList(ed);
                   if (ed->ed_Pos > ed->ed_MarkPos)
                   {
                     strdel(ed->ed_Text+ed->ed_MarkPos,ed->ed_Pos-ed->ed_MarkPos+1);
@@ -294,7 +294,7 @@
                   break;
                 if (ie->ie_Qualifier & (IEQUALIFIER_RSHIFT | IEQUALIFIER_LSHIFT | IEQUALIFIER_LALT | IEQUALIFIER_RALT))
                 {
-                  if (mln = GetEditCursorLine(ed,ed->ed_Pos,&line))
+                  if ((mln = GetEditCursorLine(ed,ed->ed_Pos,&line)) != 0)
                   {
                     struct EditLine *el = EDITLINE(mln);
                     STRPTR to = NULL,from = ed->ed_Text+ed->ed_Pos;
@@ -319,12 +319,12 @@
                     }
                     if (to)
                       strdel(from,to-from);
-                    FreeEditList(cb,ed);
+                    FreeEditList(ed);
                   }
                 }
                 else
                 {
-                  FreeEditList(cb,ed);
+                  FreeEditList(ed);
                   if (ed->ed_Pos != ed->ed_MarkPos)
                   {
                     strdel(ed->ed_Text+min(ed->ed_Pos,ed->ed_MarkPos),abs(ed->ed_Pos-ed->ed_MarkPos)+1);
@@ -335,7 +335,7 @@
                 }
                 break;
               default:
-                FreeEditList(cb,ed);
+                FreeEditList(ed);
                 c[1] = 0;
                 strins(ed->ed_Text+ed->ed_Pos++,c);
             }
@@ -343,7 +343,7 @@
           ed->ed_MarkPos = ed->ed_Pos;
           if (IsListEmpty((struct List *)&ed->ed_List))
           {
-            PrepareEditText(cb,ed,rp,ed->ed_Text);
+            PrepareEditText(ed,rp,ed->ed_Text);
             for(mln = ed->ed_List.mlh_Head;mln->mln_Succ && top;top--,mln = mln->mln_Succ);
             ed->ed_Top = mln;
 
@@ -364,14 +364,14 @@
   struct DrawInfo *dri;
   STRPTR t;
 
-  if (dri = (struct DrawInfo *)GetTagData(GA_DrawInfo,NULL,ops->ops_AttrList))
+  if ((dri = (struct DrawInfo *)GetTagData(GA_DrawInfo,0,ops->ops_AttrList)) != 0)
   {
-    if (ed->ed_Pool = CreatePool(MEMF_PUBLIC | MEMF_CLEAR,8192,8192))
+    if ((ed->ed_Pool = CreatePool(MEMF_PUBLIC | MEMF_CLEAR,8192,8192)) != 0)
     {
       ed->ed_GadWidth = ((struct Gadget *)o)->Width;
       ed->ed_LineHeight = dri->dri_Font->tf_YSize+2;
 
-      previous = (APTR)GetTagData(GA_Previous,NULL,ops->ops_AttrList);
+      previous = (APTR)GetTagData(GA_Previous,0,ops->ops_AttrList);
       if (GetTagData(EGA_Scroller,FALSE,ops->ops_AttrList) && MakeEditScroller(cb,ed,(struct Gadget *)o,previous))
         ed->ed_GadWidth -= 16;
 
@@ -388,11 +388,11 @@
 
       if (GetTagData(EGA_ShowControls,0,ops->ops_AttrList))
         ed->ed_Flags |= EDF_SPECIAL;
-      NewList((struct List *)&ed->ed_List);
+      NEWLIST((struct List *)&ed->ed_List);
       ed->ed_Top = ed->ed_List.mlh_Head;
 
-      t = (STRPTR)GetTagData(EGA_Text,NULL,ops->ops_AttrList);
-      if (ed->ed_Text = AllocPooled(ed->ed_Pool,ed->ed_Size = (t ? strlen(t) : 0)+4096))
+      t = (STRPTR)GetTagData(EGA_Text,0,ops->ops_AttrList);
+      if ((ed->ed_Text = AllocPooled(ed->ed_Pool,ed->ed_Size = (t ? strlen(t) : 0)+4096)) != 0)
       {
         if (t)
           CopyMem(t,ed->ed_Text,strlen(t));
@@ -405,11 +405,11 @@
 }
 
 
-ULONG PUBLIC DispatchEditGadget(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg)
+IPTR DispatchEditGadget(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
   struct EditGData *ed;
   struct ClassBase *cb;
-  ULONG  retval = 0;
+  IPTR   retval = 0;
 
   ed = INST_DATA(cl,o);
   cb = (APTR)cl->cl_UserData;
@@ -417,7 +417,7 @@
   switch(msg->MethodID)
   {
     case OM_NEW:
-      if (retval = DoSuperMethodA(cl,o,msg))
+      if ((retval = DoSuperMethodA(cl,o,msg)) != 0)
       {
         SetAttrs((Object *)retval,GA_TabCycle,TRUE,TAG_END);
         ed = INST_DATA(cl,retval);
@@ -425,7 +425,7 @@
         if (!DispatchEditNew(cb,(struct opSet *)msg,(Object *)retval,ed))
         {
           DoSuperMethod(cl,(Object *)retval,OM_DISPOSE);
-          retval = NULL;
+          retval = 0;
         }
       break;
     }
@@ -443,7 +443,7 @@
         struct TagItem *tstate,*ti;
 
         tstate = ((struct opSet *)msg)->ops_AttrList;
-        while(ti = NextTagItem(&tstate))
+        while((ti = NextTagItem(&tstate)) != 0)
         {
           switch(ti->ti_Tag)
           {
@@ -452,7 +452,7 @@
               struct RastPort *rp = ObtainGIRPort(((struct opUpdate *)msg)->opu_GInfo);
               long   len;
 
-              FreeEditList(cb,ed);
+              FreeEditList(ed);
               ed->ed_MarkPos = ed->ed_Pos = 0;
               if (ti->ti_Data)
               {
@@ -462,7 +462,7 @@
               }
               else
                 *ed->ed_Text = 0;
-              PrepareEditText(cb,ed,rp,ed->ed_Text);
+              PrepareEditText(ed,rp,ed->ed_Text);
               DrawEditGadget(cb,rp,(struct Gadget *)o,((struct opSet *)msg)->ops_GInfo,ed,FALSE);
               ReleaseGIRPort(rp);
               break;
@@ -510,7 +510,7 @@
         ed->ed_Lines = (((struct Gadget *)o)->Height-2*ed->ed_BorderV)/ed->ed_LineHeight;
         ed->ed_MinSpace = TextLength(gpr->gpr_RPort," ",1);
         ed->ed_MaxSpace = 42*ed->ed_MinSpace;
-        PrepareEditText(cb,ed,gpr->gpr_RPort,ed->ed_Text);
+        PrepareEditText(ed,gpr->gpr_RPort,ed->ed_Text);
 
         SetAttrs(ed->ed_Scroller,PGA_Visible, ed->ed_Lines,TAG_END);
         DrawEditGadget(cb,gpr->gpr_RPort,(struct Gadget *)o,gpr->gpr_GInfo,ed,TRUE);
@@ -614,5 +614,3 @@
   }
   return(retval);
 }
-
-


Property changes on: trunk/libs/textedit/TE_dispatch.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/textedit/TE_draw.c
===================================================================
--- trunk/libs/textedit/TE_draw.c	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TE_draw.c	2008-12-13 06:36:25 UTC (rev 6)
@@ -7,8 +7,8 @@
 
 
 #include "TextEdit_includes.h"
+#include "compatibility.h"
 
-
 void PRIVATE DrawEditCursor(struct ClassBase *cb,struct RastPort *rp,struct Gadget *gad,struct EditGData *ed)
 {
   long cx,cy,cw,mx,my,i,j,by,ox,oy;
@@ -32,11 +32,11 @@
     GetEditCursorCoord(cb,rp,ed,ed->ed_MarkPos,&mx,&my,&i);
     if (cy > my || cy == my && cx > mx)
     {
-      swmem(&cy,&my,sizeof(long));
-      swmem(&cx,&mx,sizeof(long));
+      swmem((UBYTE *)&cy,(UBYTE *)&my,sizeof(long));
+      swmem((UBYTE *)&cx,(UBYTE *)&mx,sizeof(long));
     }
     else
-      swmem(&cw,&i,sizeof(long));
+      swmem((UBYTE *)&cw,(UBYTE *)&i,sizeof(long));
 
     SetDrMd(rp,COMPLEMENT);
     if (cy == my && cy >= 0 && cy < by)
@@ -70,11 +70,11 @@
   {
     struct Image *im;
 
-    if (im = NewObject(NULL,"frameiclass",IA_Width,     ed->ed_GadWidth,
+    if ((im = NewObject(NULL,"frameiclass",IA_Width,     ed->ed_GadWidth,
                                           IA_Height,    gad->Height,
                                           IA_FrameType, ed->ed_FrameType,
                                           IA_EdgesOnly, TRUE,
-                                          TAG_END))
+                                          TAG_END)) != 0)
     {
       DrawImage(rp,im,gad->LeftEdge,gad->TopEdge);
       DisposeObject(im);
@@ -141,7 +141,9 @@
     SetABPenDrMd(rp,ed->ed_APen,ed->ed_BPen,JAM1);
     rp->AreaPtrn = (unsigned short *)&ghostPtrn;
     rp->AreaPtSz = 1;
-    RectFill(rp,x = gad->LeftEdge+4,y = gad->TopEdge+2,x+ed->ed_GadWidth-10,y+gad->Height-5);
+    x = gad->LeftEdge+4;
+    y = gad->TopEdge+2;
+    RectFill(rp,x,y,x+ed->ed_GadWidth-10,y+gad->Height-5);
     rp->AreaPtrn = NULL;
     rp->AreaPtSz = 0;
   }
@@ -151,7 +153,7 @@
     static long total;
 
     for(mln = ed->ed_List.mlh_Head;mln->mln_Succ && mln != ed->ed_Top;top++,mln = mln->mln_Succ);
-    if (GetAttr(PGA_Top,ed->ed_Scroller,(ULONG *)&i) && i == top)
+    if (GetAttr(PGA_Top,(Object *)ed->ed_Scroller,(IPTR *)&i) && i == top)
     {
       if (total == ed->ed_TextLines)
         return;
@@ -163,5 +165,3 @@
     DoMethod((APTR)ed->ed_Scroller,GM_RENDER,gi,rp,GREDRAW_REDRAW);
   }
 }
-
-


Property changes on: trunk/libs/textedit/TE_draw.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/textedit/TextEdit.c
===================================================================
--- trunk/libs/textedit/TextEdit.c	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TextEdit.c	2008-12-13 06:36:25 UTC (rev 6)
@@ -3,71 +3,12 @@
  * Licensed under the terms of the MIT License.
  */
 
-//!	init & support functions.
+//!	support functions.
 
 
 #include "TextEdit_includes.h"
 
 
-Class * PUBLIC GetClass(reg (a6) APTR cb)
-{
-  return(((struct ClassBase *)cb)->cb_Class);
-}
-
-
-void PRIVATE TE_Exit(struct ClassBase *cb)
-{
-  if (FreeClass(cb->cb_Class))
-    cb->cb_Class = NULL;
-
-  CloseLibrary(cb->cb_ScrollerBase);
-  cb->cb_ScrollerBase = NULL;
-  CloseLibrary(cb->cb_IFFParseBase);
-  CloseLibrary(cb->cb_DOSBase);
-  CloseLibrary(cb->cb_IntuitionBase);
-  CloseLibrary((struct Library *)cb->cb_GfxBase);
-  CloseLibrary(cb->cb_UtilityBase);
-  CloseDevice(&cb->cb_Console);
-}
-
-
-int PRIVATE TE_Init(struct ClassBase *cb)
-{
-  if (cb->cb_IntuitionBase = OpenLibrary("intuition.library",37))
-  {
-    if (cb->cb_GfxBase = (APTR)OpenLibrary("graphics.library",37))
-    {
-      if (cb->cb_UtilityBase = OpenLibrary("utility.library",37))
-      {
-        if (!OpenDevice("console.device",-1,(struct IORequest *)&cb->cb_Console,0))
-        {
-          Class *cl;
-
-          if (cl = MakeClass("pinc-editgadget",GADGETCLASS,NULL,sizeof(struct EditGData),0))
-          {
-            cl->cl_Dispatcher.h_Entry = (APTR)DispatchEditGadget;
-            cl->cl_Dispatcher.h_Data = cb;
-            cl->cl_UserData = (ULONG)cb;
-            AddClass(cl);
-
-            if (cb->cb_IFFParseBase = OpenLibrary("iffparse.library",37))
-              cb->cb_DOSBase = OpenLibrary("dos.library",37);
-            cb->cb_Class = cl;
-
-            return(TRUE);
-          }
-          CloseDevice(&cb->cb_Console);
-        }
-        CloseLibrary(cb->cb_UtilityBase);
-      }
-      CloseLibrary(cb->cb_GfxBase);
-    }
-    CloseLibrary(cb->cb_IntuitionBase);
-  }
-  return(FALSE);
-}
-
-
 int PRIVATE CountNodes(struct List *l)
 {
   struct Node *n;
@@ -90,19 +31,25 @@
 }
 
 
-void PUBLIC FreeEditList(reg (a6) struct ClassBase *cb,reg (a0) struct EditGData *ed)
+LIB_LH1(VOID, FreeEditList,
+  LIB_LHA(struct EditGData *, ed, A0),
+  struct ClassBase *, cb, 7, pTextEdit)
 {
+  LIBFUNC_INIT
+
   struct MinNode *mln;
   struct EditLine *el;
   long   count;
 
-  while(mln = (APTR)RemHead((struct List *)&ed->ed_List))
+  while((mln = (APTR)RemHead((struct List *)&ed->ed_List)) != 0)
   {
     for(count = 0,el = EDITLINE(mln);el->el_Word;el++,count++);
     FreePooled(ed->ed_Pool,mln,sizeof(struct MinNode)+sizeof(STRPTR)+sizeof(ULONG)+sizeof(struct EditLine)*count);
   }
   ed->ed_Top = ed->ed_List.mlh_Head;
   ed->ed_TextLines = 0;
+
+  LIBFUNC_EXIT
 }
 
 
@@ -159,15 +106,21 @@
 }
 
 
-BOOL PUBLIC PrepareEditText(reg (a6) struct ClassBase *cb,reg (a0) struct EditGData *ed,reg (a1) struct RastPort *rp,reg (a2) STRPTR t)
+LIB_LH3(BOOL, PrepareEditText,
+  LIB_LHA(struct EditGData *, ed, A0),
+  LIB_LHA(struct RastPort *, rp, A1),
+  LIB_LHA(STRPTR, t, A2),
+  struct ClassBase *, cb, 8, pTextEdit)
 {
+  LIBFUNC_INIT
+
   struct EditLine *stack;
   long   size = 256;
   STRPTR s = t;
 
   if (!ed)
-    return(NULL);
-  FreeEditList(cb,ed);
+    return 0;
+  FreeEditList(ed);
 
   if (t && (stack = AllocPooled(ed->ed_Pool,sizeof(struct EditLine)*size)))
   {
@@ -222,7 +175,7 @@
           else                      /* one word is too long */
             count++;
         }
-        if (mln = AllocPooled(ed->ed_Pool,sizeof(struct MinNode)+sizeof(STRPTR)+sizeof(ULONG)+sizeof(struct EditLine)*count))
+        if ((mln = AllocPooled(ed->ed_Pool,sizeof(struct MinNode)+sizeof(STRPTR)+sizeof(ULONG)+sizeof(struct EditLine)*count)) != 0)
         {
           AddTail((struct List *)&ed->ed_List,(struct Node *)mln);
           if (!*s)
@@ -251,7 +204,7 @@
       {
         struct EditLine *temp;
 
-        if (temp = AllocPooled(ed->ed_Pool,sizeof(struct EditLine)*(size+256)))
+        if ((temp = AllocPooled(ed->ed_Pool,sizeof(struct EditLine)*(size+256))) != 0)
         {
           CopyMem(stack,temp,(count-1)*sizeof(struct EditLine));
           FreePooled(ed->ed_Pool,stack,sizeof(struct EditLine)*size);
@@ -266,7 +219,7 @@
     {
       struct MinNode *mln;
 
-      if (mln = AllocPooled(ed->ed_Pool,sizeof(struct MinNode)+sizeof(STRPTR)+sizeof(ULONG)+sizeof(struct EditLine)))
+      if ((mln = AllocPooled(ed->ed_Pool,sizeof(struct MinNode)+sizeof(STRPTR)+sizeof(ULONG)+sizeof(struct EditLine))) != 0)
       {
         AddTail((struct List *)&ed->ed_List,(struct Node *)mln);
         stack = EDITLINE(mln);
@@ -278,6 +231,8 @@
   }
   ed->ed_Top = ed->ed_List.mlh_Head;
   return(TRUE);
+  
+  LIBFUNC_EXIT
 }
 
 
@@ -395,7 +350,7 @@
   struct MinNode *cursor,*mln;
   long   line,top;
 
-  if (cursor = GetEditCursorLine(ed,ed->ed_Pos,&line))
+  if ((cursor = GetEditCursorLine(ed,ed->ed_Pos,&line)) != 0)
   {
     for(top = 0,mln = ed->ed_List.mlh_Head;mln->mln_Succ && mln != ed->ed_Top;mln = mln->mln_Succ,top++);
     if (line < top || line >= top+ed->ed_Lines)
@@ -447,7 +402,7 @@
 {
   STRPTR temp;
 
-  if (temp = AllocPooled(ed->ed_Pool,newsize))
+  if ((temp = AllocPooled(ed->ed_Pool,newsize)) != 0)
   {
     CopyMem(ed->ed_Text,temp,min(ed->ed_Size,newsize));
     if (ed->ed_Text)
@@ -456,5 +411,3 @@
     ed->ed_Text = temp;
   }
 }
-
-


Property changes on: trunk/libs/textedit/TextEdit.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/textedit/TextEdit_includes.h
===================================================================
--- trunk/libs/textedit/TextEdit_includes.h	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TextEdit_includes.h	2008-12-13 06:36:25 UTC (rev 6)
@@ -6,16 +6,22 @@
 #define TEXTEDIT_INCLUDES_H
 
 #define INTUI_V36_NAMES_ONLY
-#define __USE_SYSBASE
 
-#define SysBase cb->cb_SysBase
-#define IntuitionBase cb->cb_IntuitionBase
-#define GfxBase cb->cb_GfxBase
-#define DOSBase cb->cb_DOSBase
-#define UtilityBase cb->cb_UtilityBase
-#define IFFParseBase cb->cb_IFFParseBase
+#if !defined(__AROS__)
+#	define __USE_SYSBASE
+
+#	define SysBase cb->cb_SysBase
+#	define IntuitionBase cb->cb_IntuitionBase
+#	define GfxBase cb->cb_GfxBase
+#	define DOSBase cb->cb_DOSBase
+#	define UtilityBase cb->cb_UtilityBase
+#	define IFFParseBase cb->cb_IFFParseBase
+#endif
+
 #define ConsoleDevice ((struct Library *)cb->cb_Console.io_Device)
 
+#include "SDI_compiler.h"
+
 #include <exec/execbase.h>
 #include <exec/libraries.h>
 #include <exec/nodes.h>
@@ -33,34 +39,30 @@
 #include <gadgets/TextEdit.h>
 #include <dos/dos.h>
 
-#include <clib/exec_protos.h>
-#include <clib/iffparse_protos.h>
-#include <clib/console_protos.h>
-#include <clib/intuition_protos.h>
-#include <clib/graphics_protos.h>
-#include <clib/utility_protos.h>
-#include <clib/dos_protos.h>
+#include <proto/exec.h>
+#include <proto/iffparse.h>
+#include <proto/console.h>
+#include <proto/intuition.h>
+#include <proto/graphics.h>
+#include <proto/utility.h>
+#include <proto/dos.h>
 
-#include <pragmas/exec_pragmas.h>
-#include <pragmas/iffparse_pragmas.h>
-#include <pragmas/console_pragmas.h>
-#include <pragmas/intuition_pragmas.h>
-#include <pragmas/graphics_pragmas.h>
-#include <pragmas/utility_pragmas.h>
-#include <pragmas/dos_pragmas.h>
+#if defined(__SASC)
+#	include <pragmas/exec_pragmas.h>
+#	include <pragmas/iffparse_pragmas.h>
+#	include <pragmas/console_pragmas.h>
+#	include <pragmas/intuition_pragmas.h>
+#	include <pragmas/graphics_pragmas.h>
+#	include <pragmas/utility_pragmas.h>
+#	include <pragmas/dos_pragmas.h>
+#endif
 
 #include <stdlib.h>
 #include <ctype.h>
 #include <string.h>
 #include <math.h>
 
-#define PUBLIC __asm __saveds
-#define PRIVATE __regargs
-#define reg(x) register __ ## x
 
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 #define ID_FTXT  MAKE_ID('F','T','X','T')
 #define ID_CHRS  MAKE_ID('C','H','R','S')
 
@@ -85,21 +87,6 @@
 
 /******************************* internal structures *******************************/
 
-struct EditGData
-{
-  APTR   ed_Pool;
-  STRPTR ed_Text;
-  long   ed_Size,ed_Pos,ed_MarkPos,ed_TextLines;
-  struct MinList ed_List;
-  struct MinNode *ed_Top;
-  UWORD  ed_LineHeight,ed_Spacing,ed_MinSpace,ed_MaxSpace,ed_CharWidth;
-  UWORD  ed_Width,ed_Lines,ed_MaxSpaces,ed_TabSpaces,ed_GadWidth;
-  UBYTE  ed_APen,ed_BPen,ed_BorderH,ed_BorderV;
-  UWORD  ed_Flags;
-  long   ed_FrameType;
-  struct Gadget *ed_Scroller;
-  UBYTE  ed_ClipUnit;
-};
 
 #define EDF_JUSTIFICATION 3 /* the mask        */
 #define EDF_MARK 16
@@ -151,11 +138,17 @@
 
 /** public functions **/
 
-extern Class * PUBLIC GetClass(reg (a6) APTR cb);
-extern ULONG PUBLIC DispatchEditGadget(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg);
-extern void PUBLIC Text2Clipboard(reg (d0) UBYTE clipunit,reg (a0) STRPTR t,reg (d1) long len,reg (a6) struct ClassBase *cb);
-extern STRPTR PUBLIC TextFromClipboard(reg (d0) UBYTE clipunit,reg (a0) APTR pool,reg (a6) struct ClassBase *cb);
-extern void PUBLIC FreeEditList(reg (a6) struct ClassBase *cb,reg (a0) struct EditGData *ed);
-extern BOOL PUBLIC PrepareEditText(reg (a6) struct ClassBase *cb,reg (a0) struct EditGData *ed,reg (a1) struct RastPort *rp,reg (a2) STRPTR t);
 
+#if defined(__AROS__)
+#	include <proto/pTextEdit.h>
+#else
+/* Mazze: ClassBase moved to end of argument list */
+extern Class * PUBLIC GetClass(REG(a6, APTR cb));
+extern void PUBLIC Text2Clipboard(REG(d0, UBYTE clipunit),REG(a0, STRPTR t),REG(d1, long len),REG(a6, struct ClassBase *cb));
+extern STRPTR PUBLIC TextFromClipboard(REG(d0, UBYTE clipunit),REG(a0, APTR pool),REG(a6, struct ClassBase *cb));
+extern IPTR PUBLIC DispatchEditGadget(REG(a0, Class *cl),REG(a2, Object *o),REG(a1, Msg msg));
+extern void PUBLIC FreeEditList(REG(a0, struct EditGData *ed),REG(a6, struct ClassBase *cb));
+extern BOOL PUBLIC PrepareEditText(REG(a0, struct EditGData *ed),REG(a1, struct RastPort *rp),REG(a2, STRPTR t),REG(a6, struct ClassBase *cb));
+#endif
+
 #endif    // TEXTEDIT_H


Property changes on: trunk/libs/textedit/TextEdit_includes.h
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/textedit/TextEdit_lib.c
===================================================================
--- trunk/libs/textedit/TextEdit_lib.c	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TextEdit_lib.c	2008-12-13 06:36:25 UTC (rev 6)
@@ -9,12 +9,72 @@
 #include "TextEdit_includes.h"
 
 
-struct Library * PUBLIC LibInit(reg (a0) BPTR Segment,reg (d0) struct ClassBase *cb,reg (a6) struct ExecBase *ExecBase);
-struct Library * PUBLIC LibOpen(reg (a6) struct ClassBase *cb);
-BPTR PUBLIC LibExpunge(reg (a6) struct ClassBase *cb);
-BPTR PUBLIC LibClose(reg (a6) struct ClassBase *cb);
-LONG PUBLIC LibNull(reg (a6) struct ClassBase *cb);
+struct Library * PUBLIC LibInit(REG(a0, BPTR Segment),REG(d0, struct ClassBase *cb),REG(a6, struct ExecBase *ExecBase));
+struct Library * PUBLIC LibOpen(REG(a6, struct ClassBase *cb));
+BPTR PUBLIC LibExpunge(REG(a6, struct ClassBase *cb));
+BPTR PUBLIC LibClose(REG(a6, struct ClassBase *cb));
+LONG PUBLIC LibNull(REG(a6, struct ClassBase *cb));
 
+
+Class * PUBLIC GetClass(REG(a6, APTR cb))
+{
+  return(((struct ClassBase *)cb)->cb_Class);
+}
+
+
+void PRIVATE TE_Exit(struct ClassBase *cb)
+{
+  if (FreeClass(cb->cb_Class))
+    cb->cb_Class = NULL;
+
+  CloseLibrary(cb->cb_ScrollerBase);
+  cb->cb_ScrollerBase = NULL;
+  CloseLibrary(cb->cb_IFFParseBase);
+  CloseLibrary(cb->cb_DOSBase);
+  CloseLibrary(cb->cb_IntuitionBase);
+  CloseLibrary((struct Library *)cb->cb_GfxBase);
+  CloseLibrary(cb->cb_UtilityBase);
+  CloseDevice(&cb->cb_Console);
+}
+
+
+int PRIVATE TE_Init(struct ClassBase *cb)
+{
+  if (cb->cb_IntuitionBase = OpenLibrary("intuition.library",37))
+  {
+    if (cb->cb_GfxBase = (APTR)OpenLibrary("graphics.library",37))
+    {
+      if (cb->cb_UtilityBase = OpenLibrary("utility.library",37))
+      {
+        if (!OpenDevice("console.device",-1,(struct IORequest *)&cb->cb_Console,0))
+        {
+          Class *cl;
+
+          if (cl = MakeClass("pinc-editgadget",GADGETCLASS,NULL,sizeof(struct EditGData),0))
+          {
+            cl->cl_Dispatcher.h_Entry = (APTR)DispatchEditGadget;
+            cl->cl_Dispatcher.h_Data = cb;
+            cl->cl_UserData = (ULONG)cb;
+            AddClass(cl);
+
+            if (cb->cb_IFFParseBase = OpenLibrary("iffparse.library",37))
+              cb->cb_DOSBase = OpenLibrary("dos.library",37);
+            cb->cb_Class = cl;
+
+            return(TRUE);
+          }
+          CloseDevice(&cb->cb_Console);
+        }
+        CloseLibrary(cb->cb_UtilityBase);
+      }
+      CloseLibrary(cb->cb_GfxBase);
+    }
+    CloseLibrary(cb->cb_IntuitionBase);
+  }
+  return(FALSE);
+}
+
+
 STATIC APTR LibVectors[] =
 {
   LibOpen,
@@ -43,7 +103,7 @@
 };
 
 
-struct Library * PUBLIC LibInit(reg (a0) BPTR segment,reg (d0) struct ClassBase *cb,reg (a6) struct ExecBase *ExecBase)
+struct Library * PUBLIC LibInit(REG(a0, BPTR segment),REG(d0, struct ClassBase *cb),REG(a6, struct ExecBase *ExecBase))
 {
   if(ExecBase->LibNode.lib_Version < 37)
     return(NULL);
@@ -63,7 +123,7 @@
 }
 
 
-struct Library * PUBLIC LibOpen(reg (a6) struct ClassBase *cb)
+struct Library * PUBLIC LibOpen(REG(a6, struct ClassBase *cb))
 {
   cb->cb_LibNode.lib_Flags &= ~LIBF_DELEXP;
   cb->cb_LibNode.lib_OpenCnt++;
@@ -86,7 +146,7 @@
 }
 
 
-BPTR PUBLIC LibExpunge(reg (a6) struct ClassBase *cb)
+BPTR PUBLIC LibExpunge(REG(a6, struct ClassBase *cb))
 {
   if (!cb->cb_LibNode.lib_OpenCnt && cb->cb_LibSegment)
   {
@@ -104,7 +164,7 @@
 }
 
 
-BPTR PUBLIC LibClose(reg (a6) struct ClassBase *cb)
+BPTR PUBLIC LibClose(REG(a6, struct ClassBase *cb))
 {
   if (cb->cb_LibNode.lib_OpenCnt)
     cb->cb_LibNode.lib_OpenCnt--;
@@ -122,9 +182,7 @@
 }
 
 
-LONG PUBLIC LibNull(reg (a6) struct ClassBase *cb)
+LONG PUBLIC LibNull(REG(a6, struct ClassBase *cb))
 {
   return(NULL);
 }
-
-


Property changes on: trunk/libs/textedit/TextEdit_lib.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Added: trunk/libs/textedit/TextEdit_lib_aros.c
===================================================================
--- trunk/libs/textedit/TextEdit_lib_aros.c	2008-12-13 06:21:37 UTC (rev 5)
+++ trunk/libs/textedit/TextEdit_lib_aros.c	2008-12-13 06:36:25 UTC (rev 6)
@@ -0,0 +1,43 @@
+/*
+ * Copyright ?1999-2008 pinc Software. All Rights Reserved.
+ * Licensed under the terms of the MIT License.
+ */
+
+//!	library init functions for AROS.
+
+
+#include "TextEdit_includes.h"
+
+#include <aros/symbolsets.h>
+
+struct IClass *ptexteditvar;
+struct Library *TextEditBase;
+
+int TE_LibInit(struct ClassBase *cb)
+{
+	TextEditBase = (struct Library *)cb;
+	InitSemaphore(&cb->cb_LockSemaphore);
+	return TRUE;
+}
+
+int TE_Init(struct ClassBase *cb)
+{
+	cb->cb_IFFParseBase = IFFParseBase;
+	cb->cb_Class = ptexteditvar;
+	cb->cb_Console.io_Message.mn_Length = sizeof(struct IOStdReq);
+	if (!OpenDevice("console.device",-1,(struct IORequest *)&cb->cb_Console,0))
+	    return TRUE;
+
+	return FALSE;
+}
+
+void TE_Exit(struct ClassBase *cb)
+{
+	CloseLibrary(cb->cb_ScrollerBase);
+	cb->cb_ScrollerBase = NULL;
+	CloseDevice((struct IORequest *)&cb->cb_Console);
+}
+
+ADD2INITLIB(TE_LibInit, 0);
+ADD2OPENLIB(TE_Init, 0);
+ADD2CLOSELIB(TE_Exit, 0);


Property changes on: trunk/libs/textedit/TextEdit_lib_aros.c
___________________________________________________________________

[... truncated: 326 lines follow ...]


From marust at mail.berlios.de  Sat Dec 13 07:49:41 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:49:41 +0100
Subject: [Ignition-commits] r7 - in trunk/libs/gtdrag: . docs examples fd
	include/clib include/libraries include/lvo include/pragmas
	include/proto
Message-ID: <200812130649.mBD6nfo1028501@sheep.berlios.de>

Author: marust
Date: 2008-12-13 07:49:17 +0100 (Sat, 13 Dec 2008)
New Revision: 7
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=7&view=rev

Added:
   trunk/libs/gtdrag/examples/mmakefile.src
   trunk/libs/gtdrag/gtdrag.conf
   trunk/libs/gtdrag/gtdrag_lib_aros.c
   trunk/libs/gtdrag/mmakefile.src
Modified:
   trunk/libs/gtdrag/
   trunk/libs/gtdrag/GTD_Apps.c
   trunk/libs/gtdrag/GTD_Boopsi.c
   trunk/libs/gtdrag/GTD_Drag.c
   trunk/libs/gtdrag/GTD_DragObj.c
   trunk/libs/gtdrag/GTD_DropMsgs.c
   trunk/libs/gtdrag/GTD_Gadgets.c
   trunk/libs/gtdrag/GTD_Highlight.c
   trunk/libs/gtdrag/GTD_Hook.c
   trunk/libs/gtdrag/GTD_IFFHook.c
   trunk/libs/gtdrag/GTD_IMsgs.c
   trunk/libs/gtdrag/GTD_ImageHook.c
   trunk/libs/gtdrag/GTD_Tree.c
   trunk/libs/gtdrag/GTD_TreeHook.c
   trunk/libs/gtdrag/GTD_Windows.c
   trunk/libs/gtdrag/SMakefile
   trunk/libs/gtdrag/docs/gtdrag.doc
   trunk/libs/gtdrag/docs/gtdrag.guide
   trunk/libs/gtdrag/docs/gtdrag.guide.info
   trunk/libs/gtdrag/docs/gtdrag.readme
   trunk/libs/gtdrag/examples/
   trunk/libs/gtdrag/examples/boopsi.c
   trunk/libs/gtdrag/examples/dragtest.c
   trunk/libs/gtdrag/examples/dragtest.info
   trunk/libs/gtdrag/examples/treetest.c
   trunk/libs/gtdrag/fd/gtdrag_lib.fd
   trunk/libs/gtdrag/gtdrag.c
   trunk/libs/gtdrag/gtdrag_includes.h
   trunk/libs/gtdrag/gtdrag_lib.c
   trunk/libs/gtdrag/gtdrag_rev.i
   trunk/libs/gtdrag/gtdrag_romtag.asm
   trunk/libs/gtdrag/include/clib/gtdrag_protos.h
   trunk/libs/gtdrag/include/libraries/gtdrag.h
   trunk/libs/gtdrag/include/libraries/gtdrag.i
   trunk/libs/gtdrag/include/lvo/gtdrag_lib.i
   trunk/libs/gtdrag/include/pragmas/gtdrag_pragmas.h
   trunk/libs/gtdrag/include/proto/gtdrag.h
   trunk/libs/gtdrag/makelib.with
Log:
* AROS/GCC port


Property changes on: trunk/libs/gtdrag
___________________________________________________________________
Name: svn:ignore
   + mmakefile


Modified: trunk/libs/gtdrag/GTD_Apps.c
===================================================================
--- trunk/libs/gtdrag/GTD_Apps.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Apps.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -34,13 +34,16 @@
 }
 
 
-void PUBLIC GTD_RemoveApp(void)
+LIB_LH0(void, GTD_RemoveApp, 
+  struct Library *, library, 12, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragApp *da;
   struct MinNode *n,*s;
 
   ObtainSemaphore(&ListSemaphore);
-  if (da = GetDragApp(NULL))
+  if ((da = GetDragApp(NULL)) != 0)
   {
     for(n = winlist.mlh_Head;n->mln_Succ;n = n->mln_Succ)
     {
@@ -67,11 +70,18 @@
     FreeMem(da, sizeof(struct DragApp));
   }
   ReleaseSemaphore(&ListSemaphore);
+
+  LIBFUNC_EXIT
 }
 
 
-int PUBLIC GTD_AddAppA(reg (a0) STRPTR t,reg (a1) struct TagItem *tag1)
+LIB_LH2(int, GTD_AddAppA, 
+  LIB_LHA(STRPTR, t, A0),
+  LIB_LHA(struct TagItem *, tag1, A1),
+  struct Library *, library, 11, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragApp *da;
 
   if (!FindTagItem(GTDA_NewStyle,tag1))
@@ -80,7 +90,7 @@
 
   if (t && !GetDragApp(NULL))
   {
-    if (da = AllocMem(sizeof(struct DragApp),MEMF_PUBLIC | MEMF_CLEAR))
+    if ((da = AllocMem(sizeof(struct DragApp),MEMF_PUBLIC | MEMF_CLEAR)) != 0)
     {
       da->da_Name = t;
       da->da_Task = FindTask(NULL);
@@ -94,6 +104,6 @@
   }
   ReleaseSemaphore(&ListSemaphore);
   return(FALSE);
+
+  LIBFUNC_EXIT
 }
-
-


Property changes on: trunk/libs/gtdrag/GTD_Apps.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_Boopsi.c
===================================================================
--- trunk/libs/gtdrag/GTD_Boopsi.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Boopsi.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -33,7 +33,7 @@
   gi.gi_Domain.Height = rdg->dg_Gadget->Height;
   gi.gi_DrInfo = GetScreenDrawInfo(gi.gi_Screen);
 
-  if (rp = ObtainGIRPort(&gi))
+  if ((rp = ObtainGIRPort(&gi)) != 0)
   {
     if (mode != GRENDER_DELETE)
     {
@@ -49,8 +49,13 @@
 }
 
 
-ULONG PUBLIC GTD_HandleInput(reg (a0) struct Gadget *gad,reg (a1) struct gpInput *gpi)
+LIB_LH2(ULONG, GTD_HandleInput, 
+  LIB_LHA(struct Gadget *, gad, A0),
+  LIB_LHA(struct gpInput *, gpi, A1),
+  struct Library *, library, 24, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct InputEvent *ie;
   long   x,y;
 
@@ -81,11 +86,18 @@
       IntuiTick(x,y);
   }
   return(GMR_MEACTIVE);  // catches all input events
+
+  LIBFUNC_EXIT
 }
 
 
-BOOL PUBLIC GTD_PrepareDrag(reg (a0) struct Gadget *gad,reg (a1) struct gpInput *gpi)
+LIB_LH2(BOOL, GTD_PrepareDrag, 
+  LIB_LHA(struct Gadget *, gad, A0),
+  LIB_LHA(struct gpInput *, gpi, A1),
+  struct Library *, library, 22, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragGadget *dg;
   struct Window *win;
 
@@ -104,7 +116,7 @@
     GTD_AddAppA("intuition",(struct TagItem *)tags);
   }
 
-  if (dg = AddDragGadget(gad,win,BOOPSI_KIND))
+  if ((dg = AddDragGadget(gad,win,BOOPSI_KIND)) != 0)
   {
     struct DragWindow *dw;
 
@@ -130,12 +142,19 @@
     return(TRUE);
   }
   return(FALSE);
+
+  LIBFUNC_EXIT
 }
 
 
-BOOL PUBLIC GTD_BeginDrag(reg (a0) struct Gadget *gad,reg (a1) struct gpInput *gpi)
+LIB_LH2(BOOL, GTD_BeginDrag, 
+  LIB_LHA(struct Gadget *, gad, A0),
+  LIB_LHA(struct gpInput *, gpi, A1),
+  struct Library *, library, 23, Gtdrag)
 {
-  if (dg = FindDragGadget(gad))
+  AROS_LIBFUNC_INIT
+
+  if ((dg = FindDragGadget(gad)) != 0)
   {
     PrepareDrag(TRUE);
     boopsigad = gad;
@@ -144,14 +163,22 @@
     return(TRUE);
   }
   return(FALSE);
+
+  LIBFUNC_EXIT
 }
 
 
-void PUBLIC GTD_StopDrag(reg (a0) struct Gadget *gad)
+LIB_LH1(void, GTD_StopDrag, 
+  LIB_LHA(struct Gadget *, gad, A0),
+  struct Library *, library, 25, Gtdrag)
 {
+  LIBFUNC_INIT
+
   if (gad != boopsigad || !gdo)
     return;
 
   FreeDragObj(gdo);
   EndDrag();
+  
+  AROS_LIBFUNC_EXIT
 }


Property changes on: trunk/libs/gtdrag/GTD_Boopsi.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_Drag.c
===================================================================
--- trunk/libs/gtdrag/GTD_Drag.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Drag.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -27,7 +27,7 @@
   adg = dg = NULL;  gdo = NULL;  boopsigad = NULL;
   mx = ~0L;
 
-  for(sdg = (APTR)gadlist.mlh_Head;ndg = (APTR)sdg->dg_Node.mln_Succ;sdg = ndg)
+  for(sdg = (APTR)gadlist.mlh_Head;(ndg = (APTR)sdg->dg_Node.mln_Succ) != 0;sdg = ndg)
   {
     if (sdg->dg_Flags & DGF_ONTHEFLY)     // remove temporary BOOPSI-gadgets
     {
@@ -67,7 +67,7 @@
     x = mousex+dg->dg_Window->LeftEdge;
     y = mousey+dg->dg_Window->TopEdge;
 
-    if (adg = GetAcceptorDragGadget(x,y))
+    if ((adg = GetAcceptorDragGadget(x,y)) != 0)
     {
       adg->dg_Flags |= DGF_LIKECURRENT;
 
@@ -87,5 +87,3 @@
   if (adg && UpdateHighlighting(IDCMP_INTUITICKS,mousex,mousey,adg))
     UpdateDragObj(gdo,mousex,mousey);
 }
-
-


Property changes on: trunk/libs/gtdrag/GTD_Drag.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_DragObj.c
===================================================================
--- trunk/libs/gtdrag/GTD_DragObj.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_DragObj.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -8,10 +8,12 @@
 
 #include "gtdrag_includes.h"
 
-#include <cybergraphics/cybergraphics.h>
-#include <clib/cybergraphics_protos.h>
-#include <pragmas/cybergraphics_pragmas.h>
+#include <cybergraphx/cybergraphics.h>
+#include <proto/cybergraphics.h>
 
+#if defined(__SASC)
+#	include <pragmas/cybergraphics_pragmas.h>
+#endif
 
 #define LOCKLAYERS
 
@@ -27,7 +29,7 @@
     UpdateDragObj(gdo,0,-9999);
 
 #ifdef LOCKLAYERS
-  LockLayer(NULL,gdo->do_DragGadget->dg_Window->RPort->Layer);
+  LockLayer(0,gdo->do_DragGadget->dg_Window->RPort->Layer);
   UnlockLayers(&gdo->do_Screen->LayerInfo);
 #endif
 
@@ -325,4 +327,3 @@
   gdo->do_X = x;
   gdo->do_Y = y;
 }
-


Property changes on: trunk/libs/gtdrag/GTD_DragObj.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_DropMsgs.c
===================================================================
--- trunk/libs/gtdrag/GTD_DropMsgs.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_DropMsgs.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -9,8 +9,14 @@
 #include "gtdrag_includes.h"
 
 
-STRPTR PUBLIC GTD_GetString(reg (a0) struct ObjectDescription *od,reg (a1) STRPTR t,reg (d0) LONG len)
+LIB_LH3(STRPTR, GTD_GetString, 
+  LIB_LHA(struct ObjectDescription *, od, A0),
+  LIB_LHA(STRPTR, t, D1),
+  LIB_LHA(LONG, len, D0),
+  struct Library *, library, 21, Gtdrag)
 {
+  LIBFUNC_INIT
+
   if (!od || !od->od_Object || !t || !len)
     return(NULL);
 
@@ -33,6 +39,8 @@
       return(NULL);
   }
   return(t);
+
+  LIBFUNC_EXIT
 }
 
 
@@ -43,7 +51,7 @@
   if (!msg || msg->Class != IDCMP_OBJECTDROP)
     return;
 
-  if (dm = msg->IAddress)
+  if ((dm = msg->IAddress) != 0)
     FreeMem(dm,sizeof(struct DropMessage));
 
   FreeMem(msg,sizeof(struct ExtIntuiMessage));
@@ -103,7 +111,7 @@
   if (adg && adg->dg_Type == BOOPSI_KIND && DoCustomMethod(adg->dg_Gadget,GM_OBJECTDROP,&dm,qual))  // send to boopsi-gadget
     return;
 
-  if (imsg = AllocMem(sizeof(struct ExtIntuiMessage),MEMF_CLEAR | MEMF_PUBLIC))
+  if ((imsg = AllocMem(sizeof(struct ExtIntuiMessage),MEMF_CLEAR | MEMF_PUBLIC)) != 0)
   {
     struct DropMessage *gdm;
 
@@ -116,13 +124,12 @@
     CurrentTime(&imsg->Seconds,&imsg->Micros);
     imsg->IDCMPWindow = win;
 
-    if (imsg->IAddress = gdm = AllocMem(sizeof(struct DropMessage),MEMF_PUBLIC))
+    if ((imsg->IAddress = gdm = AllocMem(sizeof(struct DropMessage),MEMF_PUBLIC)) != 0)
     {
       CopyMem(&dm,gdm,sizeof(struct DropMessage));
-      PutMsg(win->UserPort,imsg);
+      PutMsg(win->UserPort,(struct Message *)imsg);
       return;
     }
     FreeMem(imsg,sizeof(struct ExtIntuiMessage));
   }
 }
-


Property changes on: trunk/libs/gtdrag/GTD_DropMsgs.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_Gadgets.c
===================================================================
--- trunk/libs/gtdrag/GTD_Gadgets.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Gadgets.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -101,7 +101,7 @@
   struct DragGadget *sdg;
   APTR   layer = WhichLayer(&gdo->do_Screen->LayerInfo,mx,my);
 
-  if (sdg = WhichDragGadget(layer,mx,my))
+  if ((sdg = WhichDragGadget(layer,mx,my)) != 0)
     return(DragGadgetAcceptsObject(sdg,mx-sdg->dg_Window->LeftEdge,my-sdg->dg_Window->TopEdge) ? sdg : NULL);
 
   /*** BOOPSI gadgets ***/
@@ -124,9 +124,9 @@
           {
             long rc;
 
-            if (rc = DoCustomMethod(gad,GM_OBJECTDRAG,&dg->dg_Object,dg->dg_Gadget,words(x-gad->LeftEdge,y-gad->TopEdge)))
+            if ((rc = DoCustomMethod(gad,GM_OBJECTDRAG,&dg->dg_Object,dg->dg_Gadget,words(x-gad->LeftEdge,y-gad->TopEdge))) != 0)
             {
-              if (sdg = AddDragGadget(gad,win,BOOPSI_KIND))
+              if ((sdg = AddDragGadget(gad,win,BOOPSI_KIND)) != 0)
               {
                 if (rc & GMR_FINAL)
                   sdg->dg_CurrentObject = dg->dg_Object.od_Object;
@@ -168,8 +168,12 @@
 }
 
 
-void PUBLIC GTD_RemoveGadgets(reg (a0) struct Window *win)
+LIB_LH1(void, GTD_RemoveGadgets, 
+  LIB_LHA(struct Window *, win, A0),
+  struct Library *, library, 17, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragGadget *dg,*ndg;
 
   ObtainSemaphore(&ListSemaphore);
@@ -185,6 +189,8 @@
     }
   }
   ReleaseSemaphore(&ListSemaphore);
+
+  LIBFUNC_EXIT
 }
 
 
@@ -201,23 +207,35 @@
 }
 
 
-void PUBLIC GTD_RemoveGadget(reg (a0) struct Gadget *gad)
+LIB_LH1(void, GTD_RemoveGadget, 
+  LIB_LHA(struct Gadget *, gad, A0),
+  struct Library *, library, 16, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragGadget *dg;
 
   ObtainSemaphore(&ListSemaphore);
 
-  if (dg = FindDragGadget(gad))
+  if ((dg = FindDragGadget(gad)) != 0)
   {
     Remove((struct Node *)dg);
     FreeMem(dg,sizeof(struct DragGadget));
   }
   ReleaseSemaphore(&ListSemaphore);
+
+  LIBFUNC_EXIT
 }
 
 
-BOOL PUBLIC GTD_GetAttr(reg (a0) APTR gad,reg (d0) ULONG tag,reg (a1) ULONG *storage)
+LIB_LH3(BOOL, GTD_GetAttr, 
+  LIB_LHA(APTR, gad, A0),
+  LIB_LHA(ULONG, tag, D0),
+  LIB_LHA(ULONG *, storage, A1),
+  struct Library *, library, 19, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragGadget *dg;
 
   if (!storage || !(dg = FindDragGadget(gad)))
@@ -254,11 +272,18 @@
       return(TRUE);
   }
   return(FALSE);
+
+  LIBFUNC_EXIT
 }
 
 
-void PUBLIC GTD_SetAttrsA(reg (a0) APTR gad,reg (a1) struct TagItem *tags)
+LIB_LH2(void, GTD_SetAttrsA, 
+  LIB_LHA(APTR, gad, A0),
+  LIB_LHA(struct TagItem *, tags, A1),
+  struct Library *, library, 18, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct TagItem *tstate,*ti;
   struct DragGadget *dg;
 
@@ -269,7 +294,7 @@
   }
 
   tstate = (struct TagItem *)tags;
-  while(ti = NextTagItem(&tstate))
+  while((ti = NextTagItem(&tstate)) != 0)
   {
     switch(ti->ti_Tag)
     {
@@ -359,6 +384,8 @@
   }
   if (dg->dg_Flags & DGF_TREEVIEW && dg->dg_Object.od_Type == ODT_UNKNOWN)
     dg->dg_Object.od_Type = ODT_TREENODE;
+
+  LIBFUNC_EXIT
 }
 
 
@@ -385,15 +412,24 @@
 }
 
 
-void PUBLIC GTD_AddGadgetA(reg (d0) ULONG type,reg (a0) struct Gadget *gad,reg (a1) struct Window *win,reg (a2) struct TagItem *tags)
+LIB_LH4(void, GTD_AddGadgetA, 
+  LIB_LHA(ULONG, type, D0),
+  LIB_LHA(struct Gadget *, gad, A0),
+  LIB_LHA(struct Window *, win, A1),
+  LIB_LHA(struct TagItem *, tags, A2),
+  struct Library *, library, 15, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragGadget *dg;
 
-  if (dg = AddDragGadget(gad,win,type))
+  if ((dg = AddDragGadget(gad,win,type)) != 0)
   {
     GTD_SetAttrsA(gad,tags);
 
     if (!dg->dg_ItemHeight)
       dg->dg_ItemHeight = win->WScreen->Font->ta_YSize;
   }
+  
+  LIBFUNC_EXIT
 }


Property changes on: trunk/libs/gtdrag/GTD_Gadgets.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_Highlight.c
===================================================================
--- trunk/libs/gtdrag/GTD_Highlight.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Highlight.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -180,7 +180,7 @@
       hw -= 16;
       GT_GetGadgetAttrs(hdg->dg_Gadget,hdg->dg_Window,NULL,GTLV_Labels,&hdg->dg_List,TAG_END);
     }
-    if (hbm = AllocBitMap(hw,hh,hsrp.BitMap->Depth,BMF_CLEAR | BMF_MINPLANES,hsrp.BitMap))
+    if ((hbm = AllocBitMap(hw,hh,hsrp.BitMap->Depth,BMF_CLEAR | BMF_MINPLANES,hsrp.BitMap)) != 0)
     {
       InitRastPort(&hrp);
       hrp.BitMap = hbm;
@@ -213,5 +213,3 @@
     }
   }
 }
-
-


Property changes on: trunk/libs/gtdrag/GTD_Highlight.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_Hook.c
===================================================================
--- trunk/libs/gtdrag/GTD_Hook.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Hook.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -12,8 +12,12 @@
 ULONG  ghostPtrn = 0x44441111;
 
 
-struct Hook * PUBLIC GTD_GetHook(reg (d0) ULONG type)
+LIB_LH1(struct Hook *, GTD_GetHook, 
+  LIB_LHA(ULONG, type, D0),
+  struct Library *, library, 20, Gtdrag)
 {
+  LIBFUNC_INIT
+
   switch(type)
   {
     case GTDH_IMAGE: return(&renderHook);
@@ -21,6 +25,8 @@
     case GTDH_IFFSTREAM: return(&iffstreamHook);
   }
   return(NULL);
+
+  LIBFUNC_EXIT
 }
 
 
@@ -77,5 +83,3 @@
   FillOldExtent(rp,bounds,&extent.te_Extent);
   return(extent.te_Width);
 }
-
-


Property changes on: trunk/libs/gtdrag/GTD_Hook.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_IFFHook.c
===================================================================
--- trunk/libs/gtdrag/GTD_IFFHook.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_IFFHook.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -12,7 +12,7 @@
 #define BUFFERSIZE 2048
 
 
-ULONG PUBLIC IFFStreamHook(reg (a0) struct Hook *h,reg (a1) struct IFFStreamCmd *sc,reg (a2) struct IFFHandle *iff)
+ULONG PUBLIC IFFStreamHook(REG(a0, struct Hook *h), REG(a2, struct IFFHandle *iff), REG(a1, struct IFFStreamCmd *sc))
 {
   struct IFFStreamHookData *is = h->h_Data;
 
@@ -72,6 +72,3 @@
 
   return(0L);
 }
-
-
-


Property changes on: trunk/libs/gtdrag/GTD_IFFHook.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_IMsgs.c
===================================================================
--- trunk/libs/gtdrag/GTD_IMsgs.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_IMsgs.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -76,14 +76,14 @@
   else if (class == IDCMP_MOUSEBUTTONS && dg)
     EndDrag();
 
-  if (gmsg = GT_FilterIMsg(msg))
+  if ((gmsg = GT_FilterIMsg(msg)) != 0)
   {
     da->da_GTMsg = TRUE;
     msg = gmsg;
     if (fakemsg && (class == IDCMP_GADGETUP || class == IDCMP_MOUSEBUTTONS))
     {
       msg = GT_PostFilterIMsg(msg);
-      ReplyMsg(msg);
+      ReplyMsg((struct Message*)msg);
       fakemsg = FALSE;
       msg = NULL;
     }
@@ -92,18 +92,22 @@
 }
 
 
-struct IntuiMessage * PUBLIC GTD_GetIMsg(reg (a0) struct MsgPort *mp)
+LIB_LH1(struct IntuiMessage *, GTD_GetIMsg, 
+  LIB_LHA(struct MsgPort *, mp, A0),
+  struct Library *, library, 5, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct IntuiMessage *msg;
   struct DragApp *da;
 
-  if (da = GetDragApp(NULL))
+  if ((da = GetDragApp(NULL)) != 0)
   {
-    while(msg = (struct IntuiMessage *)GetMsg(mp))
+    while((msg = (struct IntuiMessage *)GetMsg(mp)) != 0)
     {
       msg = HandleIMsg(da,msg);
       if (!da->da_GTMsg)
-        ReplyMsg(msg);
+        ReplyMsg((struct Message *)msg);
       else
         return(msg);
     }
@@ -112,46 +116,65 @@
     return(GT_GetIMsg(mp));
 
   return(NULL);
+
+  LIBFUNC_EXIT
 }
 
 
-struct IntuiMessage * PUBLIC GTD_FilterIMsg(reg (a0) struct IntuiMessage *msg)
+LIB_LH1(struct IntuiMessage *, GTD_FilterIMsg, 
+  LIB_LHA(struct IntuiMessage *, msg, A0),
+  struct Library *, library, 7, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragApp *da;
 
-  if (da = GetDragApp(NULL))
+  if ((da = GetDragApp(NULL)) != 0)
     return(HandleIMsg(da,msg));
 
   return(GT_FilterIMsg(msg));
+
+  LIBFUNC_EXIT
 }
 
 
-void PUBLIC GTD_ReplyIMsg(reg (a0) struct IntuiMessage *msg)
+LIB_LH1(void, GTD_ReplyIMsg, 
+  LIB_LHA(struct IntuiMessage *, msg, A0),
+  struct Library *, library, 6, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragApp *da;
 
-  if (da = GetDragApp(NULL))
+  if ((da = GetDragApp(NULL)) != 0)
   {
     if (da->da_GTMsg)
       msg = GT_PostFilterIMsg(msg);
 
-    ReplyMsg(msg);
+    ReplyMsg((struct Message *)msg);
   }
   else
     GT_ReplyIMsg(msg);
 
-  if (msg = (APTR)GetMsg(dmport))
+  if ((msg = (APTR)GetMsg(dmport)) != 0)
     FreeDropMessage(msg);
+
+  LIBFUNC_EXIT
 }
 
 
-struct IntuiMessage * PUBLIC GTD_PostFilterIMsg(reg (a0) struct IntuiMessage *msg)
+LIB_LH1(struct IntuiMessage *, GTD_PostFilterIMsg, 
+  LIB_LHA(struct IntuiMessage *, msg, A0),
+  struct Library *, library, 8, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct DragApp *da;
 
   if (!(da = GetDragApp(NULL)) || da->da_GTMsg)
     return(GT_PostFilterIMsg(msg));
 
   return(msg);
+
+  LIBFUNC_EXIT
 }
-


Property changes on: trunk/libs/gtdrag/GTD_IMsgs.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_ImageHook.c
===================================================================
--- trunk/libs/gtdrag/GTD_ImageHook.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_ImageHook.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -9,7 +9,7 @@
 #include "gtdrag_includes.h"
 
 
-ULONG PUBLIC RenderHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct ImageNode *in)
+ULONG RenderHook(REG(a0, struct Hook * h), REG(a2, struct ImageNode *in), REG(a1, struct LVDrawMsg *msg))
 {
   struct RastPort *rp;
   struct Rectangle bounds;
@@ -88,6 +88,3 @@
     GhostRect(rp,pens[BLOCKPEN],msg->lvdm_Bounds.MinX, msg->lvdm_Bounds.MinY,msg->lvdm_Bounds.MaxX, msg->lvdm_Bounds.MaxY);
   return(LVCB_OK);
 }
-
-
-


Property changes on: trunk/libs/gtdrag/GTD_ImageHook.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/libs/gtdrag/GTD_Tree.c
===================================================================
--- trunk/libs/gtdrag/GTD_Tree.c	2008-12-13 06:36:25 UTC (rev 6)
+++ trunk/libs/gtdrag/GTD_Tree.c	2008-12-13 06:49:17 UTC (rev 7)
@@ -7,13 +7,14 @@
 
 
 #include "gtdrag_includes.h"
+#include "compatibility.h"
 
 
-#define NewList(l) NewList((struct List *)(l))
-#define RemHead(l) RemHead((struct List *)(l))
-#define AddTail(l,n) AddTail((struct List *)(l),(struct Node *)(n))
-#define AddHead(l,n) AddHead((struct List *)(l),(struct Node *)(n))
-#define FindName(l,s) (APTR)FindName((struct List *)(l),(s))
+#define MyNewList(l) NewList((struct List *)(l))
+#define MyRemHead(l) RemHead((struct List *)(l))
+#define MyAddTail(l,n) AddTail((struct List *)(l),(struct Node *)(n))
+#define MyAddHead(l,n) AddHead((struct List *)(l),(struct Node *)(n))
+#define MyFindName(l,s) (APTR)FindName((struct List *)(l),(s))
 
 
 /** @short adds a TreeNode to a list
@@ -43,13 +44,21 @@
  *  @see FreeTreeNodes()
  */
 
-struct TreeNode * PUBLIC AddTreeNode(reg (a0) APTR pool,reg (a1) struct MinList *tree,reg (a2) STRPTR name,reg (a3) struct Image *im,reg (d0) UWORD flags)
+LIB_LH5(struct TreeNode *, AddTreeNode, 
+  LIB_LHA(APTR, pool, A0),
+  LIB_LHA(struct MinList *, tree, A1),
+  LIB_LHA(STRPTR, name, A2),
+  LIB_LHA(struct Image *, im, A3),
+  LIB_LHA(UWORD, flags, D0),
+  struct Library *, library, 29, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct TreeNode *tn;
 
-  if (tn = AllocPooled(pool,sizeof(struct TreeNode)))
+  if ((tn = AllocPooled(pool,sizeof(struct TreeNode))) != 0)
   {
-    NewList(&tn->tn_Nodes);
+    MyNewList(&tn->tn_Nodes);
     tn->tn_Node.in_Name = name;
     tn->tn_Node.in_Image = im;
     tn->tn_Flags = flags;
@@ -63,9 +72,11 @@
       Insert((struct List *)tree,(struct Node *)tn,(struct Node *)stn->tn_Node.in_Pred);
     }
     else
-      AddTail(tree,tn);
+      MyAddTail(tree,tn);
   }
   return(tn);
+
+  LIBFUNC_EXIT
 }
 
 /** @short frees the tree nodes
@@ -80,17 +91,24 @@
  *  @see AddTreeNode()
  */
 
-void PUBLIC FreeTreeNodes(reg (a0) APTR pool,reg (a1) struct MinList *list)
+LIB_LH2(void, FreeTreeNodes, 
+  LIB_LHA(APTR, pool, A0),
+  LIB_LHA(struct MinList *, list, A1),
+  struct Library *, library, 28, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct TreeNode *tn;
 
-  while(tn = (APTR)RemHead(list))
+  while((tn = (APTR)MyRemHead(list)) != 0)
   {
     if (tn->tn_Flags & TNF_CONTAINER)
       FreeTreeNodes(pool,&tn->tn_Nodes);
 
     FreePooled(pool,tn,sizeof(struct TreeNode));
   }
+
+  LIBFUNC_EXIT
 }
 
 /** @short frees the TreeList contents
@@ -104,10 +122,17 @@
  *  @see FreeTreeNodes()
  */
 
-void PUBLIC FreeTreeList(reg (a0) APTR pool,reg (a1) struct TreeList *tl)
+LIB_LH2(void, FreeTreeList, 
+  LIB_LHA(APTR, pool, A0),
+  LIB_LHA(struct TreeList *, tl, A1),
+  struct Library *, library, 26, Gtdrag)
 {
-  NewList(&tl->tl_View);
+  LIBFUNC_INIT
+
+  MyNewList(&tl->tl_View);
   FreeTreeNodes(pool,&tl->tl_Tree);
+
+  LIBFUNC_EXIT
 }
 
 /** @short closes an open TreeNode
@@ -124,8 +149,13 @@
  *  @see ToggleTreeNode()
  */
 
-void PUBLIC CloseTreeNode(reg (a0) struct MinList *main,reg (a1) struct TreeNode *tn)
+LIB_LH2(void, CloseTreeNode, 
+  LIB_LHA(struct MinList *, main, A0),
+  LIB_LHA(struct TreeNode *, tn, A1),
+  struct Library *, library, 30, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct TreeNode *itn;
 
   if (!main || !tn)
@@ -141,6 +171,8 @@
     if ((itn->tn_Flags & (TNF_CONTAINER | TNF_OPEN)) == (TNF_CONTAINER | TNF_OPEN))
       CloseTreeNode(main,itn);
   }
+
+  LIBFUNC_EXIT
 }
 
 /** @short opens a closed TreeNode
@@ -158,8 +190,13 @@
  *  @see ToggleTreeNode()
  */
 
-LONG PUBLIC OpenTreeNode(reg (a0) struct MinList *main,reg (a1) struct TreeNode *tn)
+LIB_LH2(LONG, OpenTreeNode, 
+  LIB_LHA(struct MinList *, main, A0),
+  LIB_LHA(struct TreeNode *, tn, A1),
+  struct Library *, library, 31, Gtdrag)
 {
+  LIBFUNC_INIT
+
   struct MinNode *insertln;
   struct TreeNode *itn;
   long   count = 0;
@@ -180,6 +217,8 @@
     insertln = insertln->mln_Pred;
   }
   return count;
+
+  LIBFUNC_EXIT
 }
 
 /** @short toggles a TreeNode between closes/open
@@ -197,8 +236,13 @@
  *  @see OpenTreeNode()
  */
 
-LONG PUBLIC ToggleTreeNode(reg (a0) struct MinList *main,reg (a1) struct TreeNode *tn)
+LIB_LH2(LONG, ToggleTreeNode, 
+  LIB_LHA(struct MinList *, main, A0),
+  LIB_LHA(struct TreeNode *, tn, A1),
+  struct Library *, library, 32, Gtdrag)
 {
+  LIBFUNC_INIT
+
   if (!main || !tn)
     return(0);
 
@@ -219,6 +263,8 @@
     tn->tn_Flags = (tn->tn_Flags & ~TNF_REPLACE) | TNF_ADD;
 
   return(0);
+
+  LIBFUNC_EXIT
 }
 
 
@@ -229,7 +275,7 @@
   foreach(list,tn)
   {
     if (flags & TNF_OPEN)
-      AddTail(main,&tn->tn_ViewNode);
+      MyAddTail(main,&tn->tn_ViewNode);
     else
       tn->tn_ViewNode.mln_Succ = NULL;
 
@@ -260,10 +306,16 @@
  *  @param tl a pointer to the TreeList
  */
 
-void PUBLIC InitTreeList(reg (a0) struct TreeList *tl)
+LIB_LH1(void, InitTreeList, 
+  LIB_LHA(struct TreeList *, tl, A0),
+  struct Library *, library, 27, Gtdrag)
 {
-  NewList(&tl->tl_View);
+  LIBFUNC_INIT
+
+  MyNewList(&tl->tl_View);
   FillTreeList(&tl->tl_View,&tl->tl_Tree,0,TNF_OPEN,0);
+
+  LIBFUNC_EXIT
 }
 
 /** @short gets the container of a TreeNode
@@ -275,13 +327,19 @@
  *  @return container the container TreeNode or NULL
  */
 
-struct TreeNode * PUBLIC GetTreeContainer(reg (a0) struct TreeNode *tn)
+LIB_LH1(struct TreeNode *, GetTreeContainer, 
+  LIB_LHA(struct TreeNode *, tn, A0),
+  struct Library *, library, 33, Gtdrag)
 {
+  LIBFUNC_INIT
+
   if (!tn || !tn->tn_Depth)
     return(NULL);
 
   for(;tn->tn_Node.in_Pred;tn = (APTR)tn->tn_Node.in_Pred);
   return((struct TreeNode *)((UBYTE *)tn - sizeof(struct MinNode) - sizeof(struct ImageNode)));
+
+  LIBFUNC_EXIT
 }
 
 /** @short finds the path of a TreeNode
@@ -296,15 +354,21 @@
  *  @return path returns the buffer or NULL for failure
  */
 
-STRPTR PUBLIC GetTreePath(reg (a0) struct TreeNode *tn,reg (a1) STRPTR buffer,reg (d0) LONG len)
+LIB_LH3(STRPTR, GetTreePath, 
+  LIB_LHA(struct TreeNode *, tn, A0),
+  LIB_LHA(STRPTR, buffer, A1),
+  LIB_LHA(LONG, len, D0),

[... truncated: 1694 lines follow ...]


From marust at mail.berlios.de  Sat Dec 13 08:02:31 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 08:02:31 +0100
Subject: [Ignition-commits] r8 - in trunk/libs/gtdrag: docs examples
Message-ID: <200812130702.mBD72V9N029167@sheep.berlios.de>

Author: marust
Date: 2008-12-13 08:02:28 +0100 (Sat, 13 Dec 2008)
New Revision: 8
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=8&view=rev

Modified:
   trunk/libs/gtdrag/docs/gtdrag.guide.info
   trunk/libs/gtdrag/examples/dragtest.info
Log:
* properties for *.info files fixed



Property changes on: trunk/libs/gtdrag/docs/gtdrag.guide.info
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream


Property changes on: trunk/libs/gtdrag/examples/dragtest.info
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:keywords
   - Author Date Id Revision



From marust at mail.berlios.de  Sat Dec 13 08:14:39 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 08:14:39 +0100
Subject: [Ignition-commits] r9 - in trunk/libs: . include
Message-ID: <200812130714.mBD7Edmo029728@sheep.berlios.de>

Author: marust
Date: 2008-12-13 08:14:36 +0100 (Sat, 13 Dec 2008)
New Revision: 9
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=9&view=rev

Added:
   trunk/libs/include/
   trunk/libs/include/SDI_compiler.h
Log:
* The original SDI_Compiler.h from https://sourceforge.net/projects/sditools/
  Separate commit so that we can "diff" against it.

Added: trunk/libs/include/SDI_compiler.h
===================================================================
--- trunk/libs/include/SDI_compiler.h	2008-12-13 07:02:28 UTC (rev 8)
+++ trunk/libs/include/SDI_compiler.h	2008-12-13 07:14:36 UTC (rev 9)
@@ -0,0 +1,228 @@
+#ifndef SDI_COMPILER_H
+#define SDI_COMPILER_H
+
+/* Includeheader
+
+        Name:           SDI_compiler.h
+        Versionstring:  $VER: SDI_compiler.h 1.26 (14.10.2007)
+        Author:         Dirk St?cker & Jens Langner
+        Distribution:   PD
+        Project page:   http://www.sf.net/projects/sditools/
+        Description:    defines to hide compiler stuff
+
+ 1.1   25.06.98 : created from data made by Gunter Nikl
+ 1.2   17.11.99 : added VBCC
+ 1.3   29.02.00 : fixed VBCC REG define
+ 1.4   30.03.00 : fixed SAVEDS for VBCC
+ 1.5   29.07.00 : added #undef statements (needed e.g. for AmiTCP together
+                  with vbcc)
+ 1.6   19.05.01 : added STACKEXT and Dice stuff
+ 1.7   16.06.01 : added MorphOS specials and VARARGS68K
+ 1.8   21.09.02 : added MorphOS register stuff
+ 1.9   26.09.02 : added OFFSET macro. Thanks Frank Wille for suggestion
+ 1.10  18.10.02 : reverted to old MorphOS-method for GCC
+ 1.11  09.11.02 : added REGARGS define to MorphOS section
+ 1.12  18.01.04 : some adaptions for AmigaOS4 compatibility
+ 1.13  17.02.04 : changed ASM macros to be a simple define and added
+                  INTERRUPT, CHIP and FAR
+ 1.14  02.03.04 : added UNUSED which can be used to specify a function parameter
+                  or variable as "unused" which will not cause any compiler warning.
+ 1.15  02.03.04 : added special INLINE define for gcc > 3.0 version
+ 1.17  07.03.04 : changed INLINE definition of gcc <= 2.95.3 to be static aswell.
+ 1.18  21.06.04 : added USED and USED_VAR attribute to allow placing a
+                  __attribute__((used)) to a function and a variable, taking care of
+                  different compiler versions.
+ 1.19  04.07.04 : register specification for variables is not supported on MorphOS,
+                  so we modified the REG() macro accordingly.
+ 1.20  28.02.05 : correct INLINE for VBCC.
+ 1.21  28.02.05 : cleanup __GCC__ case.
+ 1.22  16.05.05 : changed the vbcc/REG() macro.
+                  added missing vbcc/VARARGS68K define.
+                  moved morphos SDI_EmulLib Stuff into compilers.h. I know it's not
+                  compiler specific,  (Guido Mersmann)
+ 1.23  30.04.06 : modified to get it compatible to AROS. (Guido Mersmann)
+ 1.24  06.05.06 : __linearvarargs is only valid for vbcc and PPC, so I moved VARARGS68K
+                  to prevent problems with 68K and i86 targets. (Guido Mersmann)
+ 1.25  21.06.07 : added NEAR to be usable for __near specification for SAS/C
+ 1.26  14.10.07 : added DEPRECATED macro which defaults to __attribute__((deprecated))
+                  for GCC compiles.
+*/
+
+/*
+** This is PD (Public Domain). This means you can do with it whatever you want
+** without any restrictions. I only ask you to tell me improvements, so I may
+** fix the main line of this files as well.
+**
+** To keep confusion level low: When changing this file, please note it in
+** above history list and indicate that the change was not made by myself
+** (e.g.?add your name or nick name).
+**
+** Find the latest version of this file at:
+** http://cvs.sourceforge.net/viewcvs.py/sditools/sditools/headers/
+**
+** Jens Langner <Jens.Langner at light-speed.de> and
+** Dirk St?cker <soft at dstoecker.de>
+*/
+
+/* Some SDI internal header */
+
+#undef ASM
+#undef REG
+#undef LREG
+#undef CONST
+#undef SAVEDS
+#undef INLINE
+#undef REGARGS
+#undef STDARGS
+#undef OFFSET
+#undef INTERRUPT
+#undef CHIP
+#undef FAR
+#undef NEAR
+#undef UNUSED
+#undef USED
+#undef USED_VAR
+#undef DEPRECATED
+
+/* first "exceptions" */
+
+#if defined(__MAXON__)
+  #define STDARGS
+  #define STACKEXT
+  #define REGARGS
+  #define SAVEDS
+  #define INLINE inline
+/*************************************************************************/
+#elif defined(__VBCC__)
+  #define STDARGS
+  #define STACKEXT
+  #define REGARGS
+  #define INLINE static
+  #define OFFSET(p,m) __offsetof(struct p,m)
+
+  #if defined(__PPC__)
+    #define VARARGS68K __linearvarargs
+    #define REG(reg,arg) arg
+  #else
+    #define REG(reg,arg) __reg(#reg) arg
+  #endif
+/*************************************************************************/
+#elif defined(__STORM__)
+  #define STDARGS
+  #define STACKEXT
+  #define REGARGS
+  #define INLINE inline
+/*************************************************************************/
+#elif defined(__SASC)
+  #define ASM __asm
+/*************************************************************************/
+#elif defined(__GNUC__)
+  #define UNUSED __attribute__((unused)) /* for functions, variables and types */
+  #define USED   __attribute__((used))   /* for functions only! */
+  #define DEPRECATED __attribute__((deprecated))
+  #if __GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ > 0)
+    #define USED_VAR USED /* for variables only! */
+    #define INLINE static __inline __attribute__((always_inline))
+  #endif
+  /* we have to distinguish between AmigaOS4 and MorphOS */
+  #if defined(__PPC__)
+    #define REG(reg,arg) arg
+    #define SAVEDS
+    #define STDARGS
+    #define REGARGS
+    #define STACKEXT
+    #if defined(__MORPHOS__)
+      #define VARARGS68K  __attribute__((varargs68k))
+    #endif
+    #define INTERRUPT
+    #define CHIP
+  #else
+    #define REG(reg,arg) arg __asm(#reg)
+    #define LREG(reg,arg) register REG(reg,arg)
+  #endif
+  #define FAR
+  #define NEAR
+#elif defined(_DCC)
+  #define REG(reg,arg) __##reg arg
+  #define STACKEXT __stkcheck
+  #define STDARGS __stkargs
+  #define INLINE static
+#endif
+
+/* then "common" ones */
+
+#if !defined(ASM)
+  #define ASM
+#endif
+#if !defined(REG)
+  #define REG(reg,arg) register __##reg arg
+#endif
+#if !defined(LREG)
+  #define LREG(reg,arg) register arg
+#endif
+#if !defined(CONST)
+  #define CONST const
+#endif
+#if !defined(SAVEDS)
+  #define SAVEDS __saveds
+#endif
+#if !defined(INLINE)
+  #define INLINE static __inline
+#endif
+#if !defined(REGARGS)
+  #define REGARGS __regargs
+#endif
+#if !defined(STDARGS)
+  #define STDARGS __stdargs
+#endif
+#if !defined(STACKEXT)
+  #define STACKEXT __stackext
+#endif
+#if !defined(VARARGS68K)
+  #define VARARGS68K
+#endif
+#if !defined(OFFSET)
+  #define OFFSET(structName, structEntry) \
+    ((char *)(&(((struct structName *)0)->structEntry))-(char *)0)
+#endif
+#if !defined(INTERRUPT)
+  #define INTERRUPT __interrupt
+#endif
+#if !defined(CHIP)
+  #define CHIP __chip
+#endif
+#if !defined(FAR)
+  #define FAR __far
+#endif
+#if !defined(NEAR)
+  #define NEAR __near
+#endif
+#if !defined(UNUSED)
+  #define UNUSED
+#endif
+#if !defined(USED)
+  #define USED
+#endif
+#if !defined(USED_VAR)
+  #define USED_VAR
+#endif
+#if !defined(DEPRECATED)
+  #define DEPRECATED
+#endif
+
+/*************************************************************************/
+
+#ifdef __AROS__
+
+  #undef REG
+  #define REG(reg, arg) arg
+
+  #undef SAVEDS
+  #define SAVEDS
+
+  #undef ASM
+  #define ASM
+
+#endif /* __AROS__ */
+
+#endif /* SDI_COMPILER_H */


Property changes on: trunk/libs/include/SDI_compiler.h
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native



From marust at mail.berlios.de  Sat Dec 13 08:31:06 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 08:31:06 +0100
Subject: [Ignition-commits] r10 - in trunk/libs: . include
Message-ID: <200812130731.mBD7V6em030884@sheep.berlios.de>

Author: marust
Date: 2008-12-13 08:31:02 +0100 (Sat, 13 Dec 2008)
New Revision: 10
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=10&view=rev

Added:
   trunk/libs/compatibility.c
   trunk/libs/include/SDI_endian.h
   trunk/libs/include/compatibility.h
Modified:
   trunk/libs/include/SDI_compiler.h
Log:
* Added Ignition specific defines to SDI_compiler.h
* Created SDI_endian.h with endian conversion macros
* Added compatibility.[ch] with missing SASC functions

Added: trunk/libs/compatibility.c
===================================================================
--- trunk/libs/compatibility.c	2008-12-13 07:14:36 UTC (rev 9)
+++ trunk/libs/compatibility.c	2008-12-13 07:31:02 UTC (rev 10)
@@ -0,0 +1,82 @@
+/* Implementations of missing functions
+ *
+ * FIXME: license
+ */
+
+#include "include/compatibility.h"
+#include "SDI_compiler.h"
+
+#include <strings.h>
+#include <stdlib.h>
+
+
+#if !defined(__SASC)
+
+void swmem(char *dest, char *src, int s)
+{
+	int i;
+	char c;
+
+	for(i=0; i<s; i++) {
+		c = dest[i];
+		dest[i] = src[i];
+		src[i] = c;
+	}
+}
+
+
+void strins(char *to, const char *from)
+{
+	unsigned int toLength;
+	unsigned int fromLength;
+	char *newTo;
+	char *oldTo;
+
+	if (!to || !from)
+		return;
+
+	toLength = strlen(to);
+	fromLength = strlen(from);
+
+	newTo = to + fromLength + toLength;
+	oldTo = to + toLength;
+	toLength++;
+	
+	while(toLength--) {
+		*newTo-- = *oldTo--;
+	}
+
+	while(fromLength--) {
+		*to++ = *from++;
+	}
+}
+
+
+static int dcomp(double *a, double *b)
+{
+	if(*a>*b)
+		return 1;
+	else if(*a==*b)
+		return 0;
+	else
+		return -1;
+}
+
+
+void dqsort(double *x, int n)
+{
+	qsort(x,n,sizeof(double),(void *)(*dcomp));
+}
+
+
+ULONG SafeInit (ULONG nvertmax)
+{
+	return 0;
+}
+
+
+void SafeClose (void)
+{
+}
+
+#endif


Property changes on: trunk/libs/compatibility.c
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native

Modified: trunk/libs/include/SDI_compiler.h
===================================================================
--- trunk/libs/include/SDI_compiler.h	2008-12-13 07:14:36 UTC (rev 9)
+++ trunk/libs/include/SDI_compiler.h	2008-12-13 07:31:02 UTC (rev 10)
@@ -46,6 +46,7 @@
  1.25  21.06.07 : added NEAR to be usable for __near specification for SAS/C
  1.26  14.10.07 : added DEPRECATED macro which defaults to __attribute__((deprecated))
                   for GCC compiles.
+       29.11.08   Added some defines for Ignition and support modules (Mazze)
 */
 
 /*
@@ -223,6 +224,61 @@
   #undef ASM
   #define ASM
 
+  #undef REGARGS
+  #define REGARGS
+
 #endif /* __AROS__ */
 
+/*************************************************************************/
+
+/* Ignition support */
+
+#define PUBLIC ASM SAVEDS
+#define PRIVATE REGARGS
+
+/* IPTR is an integer type which is large enough to store an address.*/
+#if !defined(__AROS__) && !defined(__MORPHOS__)
+  typedef ULONG IPTR;
+#endif
+
+#if defined(__AROS__)
+#  define LIBFUNC_INIT AROS_LIBFUNC_INIT
+#  define LIBFUNC_EXIT AROS_LIBFUNC_EXIT
+#  define LIB_LH0 AROS_LH0
+#  define LIB_LH1 AROS_LH1
+#  define LIB_LH2 AROS_LH2
+#  define LIB_LH3 AROS_LH3
+#  define LIB_LH4 AROS_LH4
+#  define LIB_LH5 AROS_LH5
+#  define LIB_LHA AROS_LHA
+#  define min(a,b) ((a)<(b)?(a):(b))
+#  define max(a,b) ((a)>(b)?(a):(b))
+#  define PI (M_PI)
+
+#  undef CHIP
+#  define CHIP
+
+#  define ALIGNED __attribute__ ((aligned (4)))
+#else
+   // TODO write LIB_... macros
+#  define LIBFUNC_INIT
+#  define LIBFUNC_EXIT
+
+#  define bug kprintf
+#endif
+
+#if defined(__AROS__)
+   /* Platforms which need HookEntry from amiga.lib */
+   //#  define SETHOOK(hookname, funcname) hookname.h_Entry = HookEntry; hookname.h_SubEntry = (HOOKFUNC)funcname
+   // FIXME for now we set funcname to h_Entry. This must later be changed to h_SubEntry (uncomment
+   // the line above)
+#  define SETHOOK(hookname, funcname) hookname.h_Entry = (HOOKFUNC)funcname;
+
+#  define SETDISPATCHER(classname, funcname) classname->cl_Dispatcher.h_Entry = HookEntry; \
+   classname->cl_Dispatcher.h_SubEntry = (HOOKFUNC)funcname
+#else
+#  define SETHOOK(hookname, funcname) hookname.h_Entry = (HOOKFUNC)funcname
+#  define SETDISPATCHER(classname, funcname) classname->cl_Dispatcher.h_Entry = (HOOKFUNC)funcname
+#endif
+
 #endif /* SDI_COMPILER_H */

Added: trunk/libs/include/SDI_endian.h
===================================================================
--- trunk/libs/include/SDI_endian.h	2008-12-13 07:14:36 UTC (rev 9)
+++ trunk/libs/include/SDI_endian.h	2008-12-13 07:31:02 UTC (rev 10)
@@ -0,0 +1,57 @@
+#ifndef SDI_ENDIAN_H
+#define SDI_ENDIAN_H
+
+/* Includeheader
+
+        Name:           SDI_endian.h
+        Versionstring:  $VER: SDI_endian.h 1.0 (06.12.2008)
+        Author:         Matthias Rustler
+        Distribution:   PD
+        Project page:   http://www.sf.net/projects/sditools/
+        Description:    endian check and conversion
+
+ 1.0   06.12.08 : initial version
+*/
+
+
+/*
+    Note that BIG_ENDIAN is always defined, so that you can use it
+    with both preprocessor "#if" and C "if".
+*/
+#if defined(__AROS__)
+  #define SDI_BIG_ENDIAN (AROS_BIG_ENDIAN)
+#else
+  #define SDI_BIG_ENDIAN (1)
+#endif
+
+
+#if defined(__AROS__)
+  #include <aros/macros.h>
+  
+  /* Convert a word or long to big endian and vice versa on the current hardware */
+  #define WORD2BE(w) AROS_WORD2BE(w)
+  #define LONG2BE(l) AROS_LONG2BE(l)
+  #define BE2WORD(w) AROS_BE2WORD(w)
+  #define BE2LONG(l) AROS_BE2LONG(l)
+
+  /* Convert a word or long to little endian and vice versa on the current hardware */
+  #define WORD2LE(w) AROS_WORD2LE(w)
+  #define LONG2LE(l) AROS_LONG2LE(l)
+  #define LE2WORD(w) AROS_LE2WORD(w)
+  #define LE2LONG(l) AROS_LE2LONG(l)
+#else
+  /* Convert a word or long to big endian and vice versa on the current hardware */
+  #define WORD2BE(w) (w)
+  #define LONG2BE(l) (l)
+  #define BE2WORD(w) (w)
+  #define BE2LONG(l) (l)
+
+  /* Convert a word or long to little endian and vice versa on the current hardware */
+  #define WORD2LE(w) (w) (((w >> 8) & 0x00ff) | ((w << 8) & 0xff00))
+  #define LONG2LE(l) (l) (((l >>24) & 0x000000ff) | ((l >> 8) & 0x0000ff00) | ((l << 8) & 0x00ff0000) | ((l <<24) & 0xff000000))
+
+  #define LE2WORD(w) (w) (((w >> 8) & 0x00ff) | ((w << 8) & 0xff00))
+  #define LE2LONG(l) (l) (((l >>24) & 0x000000ff) | ((l >> 8) & 0x0000ff00) | ((l << 8) & 0x00ff0000) | ((l <<24) & 0xff000000))
+#endif
+
+#endif /* SDI_ENDIAN_H */


Property changes on: trunk/libs/include/SDI_endian.h
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native

Added: trunk/libs/include/compatibility.h
===================================================================
--- trunk/libs/include/compatibility.h	2008-12-13 07:14:36 UTC (rev 9)
+++ trunk/libs/include/compatibility.h	2008-12-13 07:31:02 UTC (rev 10)
@@ -0,0 +1,14 @@
+/* Missing SASC/C functions
+ *
+ * FIXME: license
+ *
+ */
+
+#ifndef COMPATIBILITY_H
+#define COMPATIBILITY_H
+
+void swmem(char *dest, char *src, int s);
+void strins(char *to,const char *from);
+void dqsort(double *x, int n);
+
+#endif


Property changes on: trunk/libs/include/compatibility.h
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native



From marust at mail.berlios.de  Sat Dec 13 10:22:05 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 10:22:05 +0100
Subject: [Ignition-commits] r11 - trunk/locale
Message-ID: <200812130922.mBD9M5l6005861@sheep.berlios.de>

Author: marust
Date: 2008-12-13 10:22:04 +0100 (Sat, 13 Dec 2008)
New Revision: 11
ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=11&view=rev

Modified:
   trunk/locale/ignition.cd
Log:
* AROS mmakefile.src added
* Added some space characters to english.ct to get rid of FlexCat warnings


Property changes on: trunk/locale/ignition.cd
___________________________________________________________________
Name: svn:eol-style
   + native



From marust at mail.berlios.de  Sat Dec 13 10:30:58 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 10:30:58 +0100
Subject: [Ignition-commits] r12 - trunk/add-ons
Message-ID: <200812130930.mBD9Uwb7006476@sheep.berlios.de>

Author: marust
Date: 2008-12-13 10:30:41 +0100 (Sat, 13 Dec 2008)
New Revision: 12
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=12&view=rev

Modified:
   trunk/add-ons/
   trunk/add-ons/Makefile
   trunk/add-ons/SCOPTIONS
   trunk/add-ons/area_diagram.c
   trunk/add-ons/area_diagram.gcdescr
   trunk/add-ons/ascii.c
   trunk/add-ons/ascii.iodescr
   trunk/add-ons/button.c
   trunk/add-ons/button.gcdescr
   trunk/add-ons/cell.h
   trunk/add-ons/checkbox.c
   trunk/add-ons/checkbox.gcdescr
   trunk/add-ons/circle_diagram.c
   trunk/add-ons/circle_diagram.gcdescr
   trunk/add-ons/column_diagram.c
   trunk/add-ons/column_diagram.gcdescr
   trunk/add-ons/csv.c
   trunk/add-ons/csv.iodescr
   trunk/add-ons/frame.c
   trunk/add-ons/frame.gcdescr
   trunk/add-ons/gclass.c
   trunk/add-ons/gclass.fd
   trunk/add-ons/gclass.h
   trunk/add-ons/gclass_functable.c
   trunk/add-ons/gclass_makelib.with
   trunk/add-ons/gclass_pragmas.h
   trunk/add-ons/gclass_protos.h
   trunk/add-ons/gradient.c
   trunk/add-ons/gradient.gcdescr
   trunk/add-ons/iotype.c
   trunk/add-ons/iotype.h
   trunk/add-ons/line.c
   trunk/add-ons/line.gcdescr
   trunk/add-ons/line_diagram.c
   trunk/add-ons/line_diagram.gcdescr
   trunk/add-ons/polygon.gcdescr
   trunk/add-ons/rectangle.c
   trunk/add-ons/rectangle.gcdescr
   trunk/add-ons/text.c
   trunk/add-ons/text.gcdescr
   trunk/add-ons/turbocalc.c
   trunk/add-ons/turbocalc.h
   trunk/add-ons/turbocalc.iodescr
Log:
* svn:eol-style set to native so that these files aren't destroyed when they
  are edited on different platforms.


Property changes on: trunk/add-ons
___________________________________________________________________
Name: svn:ignore
   + mmakefile



Property changes on: trunk/add-ons/Makefile
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/SCOPTIONS
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/area_diagram.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/area_diagram.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/ascii.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/ascii.iodescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/button.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/button.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/cell.h
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/checkbox.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/checkbox.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/circle_diagram.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/circle_diagram.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/column_diagram.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/column_diagram.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/csv.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/csv.iodescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/frame.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/frame.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass.fd
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass.h
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass_functable.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass_makelib.with
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass_pragmas.h
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gclass_protos.h
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gradient.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/gradient.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/iotype.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/iotype.h
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/line.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/line.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/line_diagram.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/line_diagram.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/polygon.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/rectangle.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/rectangle.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/text.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/text.gcdescr
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/turbocalc.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/turbocalc.h
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/add-ons/turbocalc.iodescr
___________________________________________________________________
Name: svn:eol-style
   + native



From marust at mail.berlios.de  Sat Dec 13 10:40:31 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 10:40:31 +0100
Subject: [Ignition-commits] r13 - trunk/locale
Message-ID: <200812130940.mBD9eVZA006915@sheep.berlios.de>

Author: marust
Date: 2008-12-13 10:40:27 +0100 (Sat, 13 Dec 2008)
New Revision: 13
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=13&view=rev

Added:
   trunk/locale/mmakefile.src
Modified:
   trunk/locale/
   trunk/locale/ignition_english.ct
Log:
(Something went wrong with commit r12)

* AROS mmakefile.src added
* Added some space characters to english.ct to get rid of FlexCat warnings




Property changes on: trunk/locale
___________________________________________________________________
Name: svn:ignore
   + mmakefile


Modified: trunk/locale/ignition_english.ct
===================================================================
--- trunk/locale/ignition_english.ct	2008-12-13 09:30:41 UTC (rev 12)
+++ trunk/locale/ignition_english.ct	2008-12-13 09:40:27 UTC (rev 13)
@@ -267,7 +267,7 @@
 Could not load project \"%s\".
 ;
 MSG_COLOR_CHANGE_UNDO
-Color changed
+Color changed 
 ;
 MSG_SET_PATTERN_UNDO
 pattern set
@@ -651,7 +651,7 @@
 Page color 
 ;
 MSG_ATTACH_NOTE_UNDO
-Attach note
+Attach note 
 ;
 MSG_DELETE_NOTE_UNDO
 Delete note
@@ -2361,7 +2361,7 @@
 Save|Back
 ;
 MSG_INTERACTIVE_MODE_HELP
-interactive
+interactive 
 ;
 MSG_EDIT_MODE_HELP
 edit


Property changes on: trunk/locale/ignition_english.ct
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/locale/mmakefile.src
===================================================================
--- trunk/locale/mmakefile.src	2008-12-13 09:30:41 UTC (rev 12)
+++ trunk/locale/mmakefile.src	2008-12-13 09:40:27 UTC (rev 13)
@@ -0,0 +1,41 @@
+#
+# meta-makefile for Ignition Catalogs for AROS
+#
+
+include $(TOP)/config/make.cfg
+
+
+CATDIR := $(AROS_CONTRIB)/Office/Ignition/Catalogs
+
+SRCS := ignition_english.ct
+OBJS := $(CATDIR)/english/Ignition.catalog
+DIRS := $(CATDIR)/english/
+
+
+#MM
+contrib-ignition-catalogs : create_dirs $(OBJS) ../ignition_strings.h
+
+$(CATDIR)/english/Ignition.catalog : ignition_english.ct ignition.cd
+	@$(ECHO) "Creating Ignition catalog for language english"
+	@$(FLEXCAT) ignition.cd ignition_english.ct CATALOG=$(CATDIR)/english/Ignition.catalog
+
+../ignition_strings.h : ignition.cd
+	@$(ECHO) "Creating Ignition catalog source file ../ignition_strings.h"
+	@$(FLEXCAT) ignition.cd ../ignition_strings.h=$(TOOLDIR)/C_h_orig.sd
+
+create_dirs:
+	$(IF) $(TEST) ! -d $(CATDIR) ; then $(MKDIR) $(CATDIR) ; else $(NOP) ; fi
+	@$(FOR) dir in $(DIRS) ; do \
+	    $(IF) $(TEST) ! -d $$dir ; then $(MKDIR) $$dir ; else $(NOP) ; fi ; \
+	done
+
+
+contrib-ignition-catalogs-clean : FILES := $(BD_OJS) ../ignition_strings.h
+
+#MM
+contrib-ignition-catalogs-clean ::
+	$(RM) $(FILES)
+
+.PHONY: contrib-ignition-catalogs contrib-ignition-catalogs-clean
+
+%common


Property changes on: trunk/locale/mmakefile.src
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native



From axeld at pinc-software.de  Sat Dec 13 10:32:32 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sat, 13 Dec 2008 10:32:32 +0100 CET
Subject: [Ignition-commits]
 =?utf-8?q?r6_-_in_trunk/libs/textedit=3A_=2E_f?=
 =?utf-8?q?d_include/clib_include/gadgets_include/pragmas_include/proto_te?=
 =?utf-8?q?st?=
In-Reply-To: <200812130636.mBD6acrU027940@sheep.berlios.de>
Message-ID: <2305418754-BeMail@zon>

marust at mail.berlios.de wrote:
> ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=6&view=rev

I've now fixed the link to actually point to the ignition repository, I 
didn't notice this before.

> * made struct EditGData public because
>   it's needed as function argument

The PrepareEditText() function is supposed to be private at least, so 
EditGData should not be part of 
gadgets/TextEdit.h.

> +/* Mazze: ClassBase moved to end of argument list */

That should better be part of the commit message than a comment in the 
code :-)

Anyway, the rest looks nice. I'll hope to be able to actually test this 
in the next few days, but it's probably not going to happen before the 
19.12.

Bye,
   Axel.



From marust at mail.berlios.de  Sat Dec 13 11:00:55 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 13 Dec 2008 11:00:55 +0100
Subject: [Ignition-commits] r14 - in trunk: docs misc misc/Masons Icons rexx
Message-ID: <200812131000.mBDA0tEP008477@sheep.berlios.de>

Author: marust
Date: 2008-12-13 11:00:37 +0100 (Sat, 13 Dec 2008)
New Revision: 14
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=14&view=rev

Added:
   trunk/docs/preferences_structure.ods
Modified:
   trunk/docs/Befehle.guide
   trunk/docs/Befehle.guide.info
   trunk/docs/Grafik-System
   trunk/docs/LiesMich.guide
   trunk/docs/LiesMich.guide.info
   trunk/docs/Merker
   trunk/docs/Read Me.html
   trunk/docs/Read Me.html.info
   trunk/docs/WDTs
   trunk/misc/Masons Icons/arexx.info
   trunk/misc/Masons Icons/def_arexx.info
   trunk/misc/Masons Icons/def_guide.info
   trunk/misc/Masons Icons/def_igs.info
   trunk/misc/Masons Icons/dokumente.info
   trunk/misc/Masons Icons/help.info
   trunk/misc/Masons Icons/icons16.info
   trunk/misc/Masons Icons/icons32.info
   trunk/misc/Masons Icons/ignition-DeInstall.info
   trunk/misc/Masons Icons/ignition-Installation.info
   trunk/misc/Masons Icons/ignition.info
   trunk/misc/ignition-DeInstall
   trunk/misc/ignition-DeInstall.info
   trunk/misc/ignition-Installation
   trunk/misc/ignition-Installation.info
   trunk/rexx/context.ign
   trunk/rexx/coords.ign
   trunk/rexx/getsetcell.ign
   trunk/rexx/request.ign
   trunk/rexx/test.rexx
Log:
* Added documentation about preferences files to docs
  (Sorry for the OpenOffice format, next release will be in Ignition format ;-) )
* Property fixes


Property changes on: trunk/docs/Befehle.guide
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/docs/Befehle.guide.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/docs/Grafik-System
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/docs/LiesMich.guide
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/docs/LiesMich.guide.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/docs/Merker
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/docs/Read Me.html
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/docs/Read Me.html.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/docs/WDTs
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/docs/preferences_structure.ods
===================================================================
(Binary files differ)


Property changes on: trunk/docs/preferences_structure.ods
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/arexx.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/def_arexx.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/def_guide.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/def_igs.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/dokumente.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/help.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/icons16.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/icons32.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/ignition-DeInstall.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/ignition-Installation.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/Masons Icons/ignition.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/ignition-DeInstall
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/misc/ignition-DeInstall.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/misc/ignition-Installation
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/misc/ignition-Installation.info
___________________________________________________________________
Name: mime-type
   + application/octet-stream


Property changes on: trunk/rexx/context.ign
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/rexx/coords.ign
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/rexx/getsetcell.ign
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/rexx/request.ign
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/rexx/test.rexx
___________________________________________________________________
Name: svn:eol-style
   + native



From mrustler at gmx.de  Sat Dec 13 11:14:06 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Sat, 13 Dec 2008 11:14:06 +0100
Subject: [Ignition-commits] r6 - in trunk/libs/textedit: .
	fd	include/clib include/gadgets include/pragmas include/proto test
In-Reply-To: <2305418754-BeMail@zon>
References: <2305418754-BeMail@zon>
Message-ID: <1229163246.9819.1.camel@bellodello>

Am Samstag, den 13.12.2008, 10:32 +0100 schrieb Axel D?rfler:
> marust at mail.berlios.de wrote:
> > ViewCVS: http://svn.berlios.de/viewcvs/haiku?rev=6&view=rev
> 
> I've now fixed the link to actually point to the ignition repository, I 
> didn't notice this before.
> 
> > * made struct EditGData public because
> >   it's needed as function argument
> 
> The PrepareEditText() function is supposed to be private at least, so 
> EditGData should not be part of 
> gadgets/TextEdit.h.

Mmmm, but ignition/gadgets.h re-defines this structure.

Regards,
Matthias




From axeld at pinc-software.de  Sat Dec 13 12:12:41 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sat, 13 Dec 2008 12:12:41 +0100 CET
Subject: [Ignition-commits]
 =?utf-8?q?r6_-_in_trunk/libs/textedit=3A_=2E_f?=
 =?utf-8?q?d_include/clib_include/gadgets_include/pragmas_include/proto_te?=
 =?utf-8?q?st?=
In-Reply-To: <1229163246.9819.1.camel@bellodello>
Message-ID: <8314552993-BeMail@zon>

Matthias Rustler <mrustler at gmx.de> wrote:
> Am Samstag, den 13.12.2008, 10:32 +0100 schrieb Axel D?rfler:
> > > * made struct EditGData public because
> > >   it's needed as function argument
> > The PrepareEditText() function is supposed to be private at least, 
> > so 
> > EditGData should not be part of 
> > gadgets/TextEdit.h.
> Mmmm, but ignition/gadgets.h re-defines this structure.

So we should introduce a shared header, then, I think (ignition 
redefining this structure could be counted as a bug, I think :-)).

Bye,
   Axel.



From axeld at pinc-software.de  Sat Dec 13 12:14:15 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sat, 13 Dec 2008 12:14:15 +0100 CET
Subject: [Ignition-commits] r13 - trunk/locale
In-Reply-To: <200812130940.mBD9eVZA006915@sheep.berlios.de>
Message-ID: <8408047364-BeMail@zon>

marust at mail.berlios.de wrote:
> * Added some space characters to english.ct to get rid of FlexCat 
> warnings

What kind of warnings? I'm usually using an editor that cuts all 
extraneous whitespace automatically.

Bye,
   Axel.



From axeld at pinc-software.de  Sat Dec 13 12:15:58 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sat, 13 Dec 2008 12:15:58 +0100 CET
Subject: [Ignition-commits] r12 - trunk/add-ons
In-Reply-To: <200812130930.mBD9Uwb7006476@sheep.berlios.de>
Message-ID: <8511773707-BeMail@zon>

marust at mail.berlios.de wrote:
> Log:
> * svn:eol-style set to native so that these files aren't destroyed 
> when they
>   are edited on different platforms.

They shouldn't get destroyed then; depending on the editor, they might 
just get different line endings which most compilers should deal with 
(only macros are problematic).
In any case, this shouldn't hurt, though :-)

Bye,
   Axel.



From axeld at pinc-software.de  Sat Dec 13 12:19:12 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sat, 13 Dec 2008 12:19:12 +0100 CET
Subject: [Ignition-commits] r10 - in trunk/libs: . include
In-Reply-To: <200812130731.mBD7V6em030884@sheep.berlios.de>
Message-ID: <8705342061-BeMail@zon>

marust at mail.berlios.de wrote:
> +ULONG SafeInit (ULONG nvertmax)
> +{
> +	return 0;
> +}
> +
> +
> +void SafeClose (void)
> +{
> +}

Those are actually part of lib safeclip.o, and not SAS/C specific. I 
hope the area functions are safe to use under AROS/MorphOS/AmigaOS4 (on 
AmigaOS up to 3 they ignore the rastport clipping, easily trashing 
memory), then we could exclude those at least for them.

Bye,
   Axel.



From axeld at pinc-software.de  Sat Dec 13 12:20:21 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sat, 13 Dec 2008 12:20:21 +0100 CET
Subject: [Ignition-commits] r14 - in trunk: docs misc misc/Masons Icons
 rexx
In-Reply-To: <200812131000.mBDA0tEP008477@sheep.berlios.de>
Message-ID: <8774604474-BeMail@zon>

marust at mail.berlios.de wrote:
> Log:
> * Added documentation about preferences files to docs
>   (Sorry for the OpenOffice format, next release will be in Ignition 
> format ;-) )

I wouldn't mind an OO reader for ignition, though ;-)

Bye,
   Axel.



From mrustler at gmx.de  Sat Dec 13 13:09:12 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Sat, 13 Dec 2008 13:09:12 +0100
Subject: [Ignition-commits] r13 - trunk/locale
In-Reply-To: <8408047364-BeMail@zon>
References: <8408047364-BeMail@zon>
Message-ID: <1229170152.19079.3.camel@bellodello>

Am Samstag, den 13.12.2008, 12:14 +0100 schrieb Axel D?rfler:
> marust at mail.berlios.de wrote:
> > * Added some space characters to english.ct to get rid of FlexCat 
> > warnings
> 
> What kind of warnings? I'm usually using an editor that cuts all 
> extraneous whitespace automatically.
> 
> Bye,
>    Axel.

FlexCat warned me that the original strings had trailing spaces, but the
translated strings didn't. Perhaps I did it the wrong way and had better
removed the spaces from the original file.

Regards,
Matthias




From mrustler at gmx.de  Sat Dec 13 13:12:10 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Sat, 13 Dec 2008 13:12:10 +0100
Subject: [Ignition-commits] r12 - trunk/add-ons
In-Reply-To: <8511773707-BeMail@zon>
References: <8511773707-BeMail@zon>
Message-ID: <1229170330.19079.6.camel@bellodello>

Am Samstag, den 13.12.2008, 12:15 +0100 schrieb Axel D?rfler:
> marust at mail.berlios.de wrote:
> > Log:
> > * svn:eol-style set to native so that these files aren't destroyed 
> > when they
> >   are edited on different platforms.
> 
> They shouldn't get destroyed then; depending on the editor, they might 
> just get different line endings which most compilers should deal with 
> (only macros are problematic).
> In any case, this shouldn't hurt, though :-)
> 
> Bye,

OK, "destroyed" was a bit to dramatic. But on AROS we had several time
the problem that some files were edited on Windows and our build tools
stopped with errors.

Regards,
Matthias




From axeld at pinc-software.de  Sun Dec 14 01:41:26 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sun, 14 Dec 2008 01:41:26 +0100 CET
Subject: [Ignition-commits] r13 - trunk/locale
In-Reply-To: <1229170152.19079.3.camel@bellodello>
Message-ID: <56839403809-BeMail@zon>

Matthias Rustler <mrustler at gmx.de> wrote:
> Am Samstag, den 13.12.2008, 12:14 +0100 schrieb Axel D?rfler:
> > marust at mail.berlios.de wrote:
> > > * Added some space characters to english.ct to get rid of FlexCat 
> > > warnings
> > What kind of warnings? I'm usually using an editor that cuts all 
> > extraneous whitespace automatically.
> FlexCat warned me that the original strings had trailing spaces, but 
> the
> translated strings didn't. Perhaps I did it the wrong way and had 
> better
> removed the spaces from the original file.

Sounds like it :-)

Bye,
   Axel.



From mrustler at gmx.de  Sun Dec 14 11:18:38 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Sun, 14 Dec 2008 11:18:38 +0100
Subject: [Ignition-commits] r13 - trunk/locale
In-Reply-To: <56839403809-BeMail@zon>
References: <56839403809-BeMail@zon>
Message-ID: <1229249918.10926.10.camel@bellodello>

Am Sonntag, den 14.12.2008, 01:41 +0100 schrieb Axel D?rfler:
> Matthias Rustler <mrustler at gmx.de> wrote:
> > Am Samstag, den 13.12.2008, 12:14 +0100 schrieb Axel D?rfler:
> > > marust at mail.berlios.de wrote:
> > > > * Added some space characters to english.ct to get rid of FlexCat 
> > > > warnings
> > > What kind of warnings? I'm usually using an editor that cuts all 
> > > extraneous whitespace automatically.
> > FlexCat warned me that the original strings had trailing spaces, but 
> > the
> > translated strings didn't. Perhaps I did it the wrong way and had 
> > better
> > removed the spaces from the original file.
> 
> Sounds like it :-)

It seems that the spaces are intended:

----------

strcpy(t, GetString(&gLocaleInfo, MSG_COLOR_CHANGE_UNDO));
if (apen)
  strcat(t, apen->cp_Node.ln_Name);
else
  strcat(t, "-");
strcat(t,"/");
if (bpen)
  strcat(t,bpen->cp_Node.ln_Name);
else
  strcat(t,"-");

----------

strcpy(t,GetString(&gLocaleInfo, MSG_ATTACH_NOTE_UNDO));
strcat(t,"\"");
strncat(t,note,222);

---------
								sprintf(helpText, GetString(&gLocaleInfo, MSG_STATUS_MODE_HELP),
page->pg_Mappe->mp_Flags & MPF_SCRIPTS ? GetString(&gLocaleInfo,
MSG_INTERACTIVE_MODE_HELP) : GetString(&gLocaleInfo,
MSG_EDIT_MODE_HELP));

With:
MSG_STATUS_MODE_HELP  (//)
Statuszeile: %sModus


Regards,
Matthias









From mrustler at gmx.de  Sun Dec 14 11:40:51 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Sun, 14 Dec 2008 11:40:51 +0100
Subject: [Ignition-commits] r10 - in trunk/libs: . include
In-Reply-To: <8705342061-BeMail@zon>
References: <8705342061-BeMail@zon>
Message-ID: <1229251251.10926.17.camel@bellodello>

Am Samstag, den 13.12.2008, 12:19 +0100 schrieb Axel D?rfler:
> marust at mail.berlios.de wrote:
> > +ULONG SafeInit (ULONG nvertmax)
> > +{
> > +	return 0;
> > +}
> > +
> > +
> > +void SafeClose (void)
> > +{
> > +}
> 
> Those are actually part of lib safeclip.o, and not SAS/C specific. I 
> hope the area functions are safe to use under AROS/MorphOS/AmigaOS4 (on 
> AmigaOS up to 3 they ignore the rastport clipping, easily trashing 
> memory), then we could exclude those at least for them.

I ran a test with a simple-refresh window under AROS. I set one
coordinate outside the window. The graphics was corrupt, but rendering
stopped at window borders.

But this is probably only because AROS implements Area functions with
simple line drawing. This can change when there is ever a 68k version of
AROS which accesses the custom chips directly.

I now have embedded the Safe..() functions in a "HAVE_SAFECLIP" macro.


Regards,
Matthias




From axeld at pinc-software.de  Sun Dec 14 12:34:46 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sun, 14 Dec 2008 12:34:46 +0100 CET
Subject: [Ignition-commits] r13 - trunk/locale
In-Reply-To: <1229249918.10926.10.camel@bellodello>
Message-ID: <10907883708-BeMail@zon>

Matthias Rustler <mrustler at gmx.de> wrote:
> > Sounds like it :-)
> It seems that the spaces are intended:

OMG :-)
That should be solved differently, of course, but for now, it looks 
like your changes were at the right place. Thanks for looking into it.

Bye,
   Axel.



From axeld at pinc-software.de  Sun Dec 14 12:36:29 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sun, 14 Dec 2008 12:36:29 +0100 CET
Subject: [Ignition-commits] r10 - in trunk/libs: . include
In-Reply-To: <1229251251.10926.17.camel@bellodello>
Message-ID: <11010432409-BeMail@zon>

Matthias Rustler <mrustler at gmx.de> wrote:
> Am Samstag, den 13.12.2008, 12:19 +0100 schrieb Axel D?rfler:
> > Those are actually part of lib safeclip.o, and not SAS/C specific. 
> > I 
> > hope the area functions are safe to use under AROS/MorphOS/AmigaOS4 
> > (on 
> > AmigaOS up to 3 they ignore the rastport clipping, easily trashing 
> > memory), then we could exclude those at least for them.
> I ran a test with a simple-refresh window under AROS. I set one
> coordinate outside the window. The graphics was corrupt, but 
> rendering
> stopped at window borders.
> 
> But this is probably only because AROS implements Area functions with
> simple line drawing. This can change when there is ever a 68k version 
> of
> AROS which accesses the custom chips directly.
> 
> I now have embedded the Safe..() functions in a "HAVE_SAFECLIP" 
> macro.

Okay, great. Unfortunately, the source code for the library doesn't 
seem to be available, so unless all platforms support this correctly, 
we would have to write our own (ie. steal it from somewhere else), 
anyway.

Bye,
   Axel.



From marust at mail.berlios.de  Sun Dec 14 23:42:01 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sun, 14 Dec 2008 23:42:01 +0100
Subject: [Ignition-commits] r15 - in trunk: . distribution
	distribution/full/misc help/deutsch help/english libs
Message-ID: <200812142242.mBEMg1J7032658@sheep.berlios.de>

Author: marust
Date: 2008-12-14 23:41:08 +0100 (Sun, 14 Dec 2008)
New Revision: 15
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=15&view=rev

Added:
   trunk/locale.c
   trunk/mmakefile.src
   trunk/wdt.h
Modified:
   trunk/
   trunk/History
   trunk/LICENSE
   trunk/Makefile
   trunk/README
   trunk/SCOPTIONS
   trunk/boopsi.c
   trunk/calc.c
   trunk/calc.h
   trunk/cell.c
   trunk/classes.c
   trunk/classes.h
   trunk/clip.c
   trunk/cmd.c
   trunk/color.c
   trunk/database.c
   trunk/debug.c
   trunk/debug.h
   trunk/diagram.c
   trunk/distribution/README
   trunk/distribution/full/misc/ignition-DeInstall
   trunk/distribution/make-full
   trunk/distribution/makefile-full
   trunk/edit.c
   trunk/font.c
   trunk/font.h
   trunk/funcs.h
   trunk/functions.c
   trunk/gadgets.c
   trunk/gadgets.h
   trunk/graphic.c
   trunk/graphic.h
   trunk/handleprefs.c
   trunk/handlewindows.c
   trunk/help/deutsch/ignition.guide
   trunk/help/deutsch/ignition.in.guide
   trunk/help/english/ignition.guide
   trunk/help/english/ignition.in.guide
   trunk/hooks.c
   trunk/ignition.c
   trunk/images.c
   trunk/images.h
   trunk/initwindows.c
   trunk/io.c
   trunk/io.h
   trunk/libs/compatibility.c
   trunk/lock.c
   trunk/menu.c
   trunk/objects.c
   trunk/pointer.c
   trunk/popper.c
   trunk/prefs.c
   trunk/prefs.h
   trunk/prefsgadgets.c
   trunk/prefsio.c
   trunk/printer.c
   trunk/project.c
   trunk/reference.c
   trunk/rexx.c
   trunk/screen.c
   trunk/search.c
   trunk/support.c
   trunk/table.c
   trunk/table.h
   trunk/types.h
   trunk/undo.c
   trunk/version.h
   trunk/windefs.h
   trunk/windows.c
   trunk/windows.h
Log:
* AROS and GCC port of Ignition
* A lot of warnings removed
* Renamed macros NewList, AddHead etc. to MyNewList, MyAddHead etc.
  because of name collision.



Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   + mmakefile



Property changes on: trunk/History
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/LICENSE
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/Makefile
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/README
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native


Property changes on: trunk/SCOPTIONS
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/boopsi.c
===================================================================
--- trunk/boopsi.c	2008-12-13 10:00:37 UTC (rev 14)
+++ trunk/boopsi.c	2008-12-14 22:41:08 UTC (rev 15)
@@ -9,6 +9,7 @@
 #include "funcs.h"
 
 #include <graphics/rpattr.h>
+#include <intuition/gadgetclass.h>
 //#include <datatypes/pictureclass.h>
 
 #if !defined(PDTM_WRITEPIXELARRAY)
@@ -36,15 +37,15 @@
 #define IM(o) ((struct Image *)o)
 
 
-extern ULONG PUBLIC RenderHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct ImageNode *in);
-extern ULONG PUBLIC PopUpHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct Node *n);
-extern ULONG PUBLIC FormelHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct Node *n);
-extern ULONG PUBLIC gLinkHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct gLink *gl);
-extern ULONG PUBLIC LinkHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct Link *l);
-extern ULONG PUBLIC FormatHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct Node *n);
-extern ULONG PUBLIC SelectHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct Node *n);
-extern ULONG PUBLIC ColorHook(reg (a1) struct LVDrawMsg *msg,reg (a2) struct colorPen *cp);
-extern void PUBLIC fillHookFunc(reg (a0) struct Hook *h, reg (a2) struct RastPort *rastp, reg (a1) struct Rectangle *rect);
+extern ULONG PUBLIC RenderHook(REG(a0, struct Hook *h),REG(a2, struct ImageNode *in),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC PopUpHook(REG(a0, struct Hook *h),REG(a2, struct Node *n),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC FormelHook(REG(a0, struct Hook *h),REG(a2, struct Node *n),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC gLinkHook(REG(a0, struct Hook *h),REG(a2, struct gLink *gl),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC LinkHook(REG(a0, struct Hook *h),REG(a2, struct Link *l),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC FormatHook(REG(a0, struct Hook *h),REG(a2, struct Node *n),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC SelectHook(REG(a0, struct Hook *h),REG(a2, struct Node *n),REG(a1, struct LVDrawMsg *msg));
+extern ULONG PUBLIC ColorHook(REG(a0, struct Hook *h),REG(a2, struct colorPen *cp),REG(a1, struct LVDrawMsg *msg));
+extern void PUBLIC fillHookFunc(REG(a0, struct Hook *h), REG(a2, struct RastPort *rastp), REG(a1, struct Rectangle *rect));
 
 
 /********************************** Page-Gadget **********************************/
@@ -81,22 +82,22 @@
 }
 
 
-ULONG PUBLIC
-DispatchPageGadget(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchPageGadget(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
 	struct PageGData *pd = INST_DATA(cl, o);
-	ULONG retval = 0;
+	IPTR retval = 0;
 	long i;
 
 	switch (msg->MethodID) {
 		case OM_NEW:
-			if (retval = DoSuperMethodA(cl, o, msg)) {
+			if ((retval = DoSuperMethodA(cl, o, msg)) != 0) {
 				struct Gadget *gad;
 
 				pd = INST_DATA(cl, retval);
 				pd->pd_Active = GetTagData(PAGEGA_Active, 0L, ((struct opSet *)msg)->ops_AttrList);
-				pd->pd_Pages = (struct Gadget **)GetTagData(PAGEGA_Pages, NULL, ((struct opSet *)msg)->ops_AttrList);
-				pd->pd_Refresh = (APTR)GetTagData(PAGEGA_RefreshFunc, NULL, ((struct opSet *)msg)->ops_AttrList);
+				pd->pd_Pages = (struct Gadget **)GetTagData(PAGEGA_Pages, 0, ((struct opSet *)msg)->ops_AttrList);
+				pd->pd_Refresh = (APTR)GetTagData(PAGEGA_RefreshFunc, 0, ((struct opSet *)msg)->ops_AttrList);
 				
 				// Count pages and gadgets in the pages
 				for (i = 0; pd->pd_Pages[i]; i++);
@@ -129,7 +130,7 @@
 				struct RastPort *rp;
 
 				tstate = ((struct opSet *)msg)->ops_AttrList;
-				while (ti = NextTagItem(&tstate)) {
+				while ((ti = NextTagItem(&tstate)) != 0) {
 					switch (ti->ti_Tag) {
 						case PAGEGA_Active:
 							i = ti->ti_Data;
@@ -218,7 +219,7 @@
 	if (all) {  // draw the whole gadget
 		APTR obj;
 
-		if (obj = NewObject(NULL, "frameiclass", IA_Width, gad->Width, IA_Height, gad->Height - h, IA_EdgesOnly, TRUE, TAG_END)) {
+		if ((obj = NewObject(NULL, "frameiclass", IA_Width, gad->Width, IA_Height, gad->Height - h, IA_EdgesOnly, TRUE, TAG_END)) != 0) {
 			DrawImage(rp, obj, gad->LeftEdge, gad->TopEdge + h);
 			DisposeObject(obj);
 		}
@@ -349,10 +350,10 @@
 }
 
 
-ULONG PUBLIC
-DispatchIndexGadget(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchIndexGadget(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
-	ULONG retval = 0;
+	IPTR retval = 0;
 	struct IndexGData *id;
 	long i;
 
@@ -360,9 +361,9 @@
 
 	switch(msg->MethodID) {
 		case OM_NEW:
-			if (!GetTagData(GA_DrawInfo,NULL,((struct opSet *)msg)->ops_AttrList))
+			if (!GetTagData(GA_DrawInfo, 0, ((struct opSet *)msg)->ops_AttrList))
 				break;
-			if (retval = DoSuperMethodA(cl, o, msg)) {
+			if ((retval = DoSuperMethodA(cl, o, msg)) != 0) {
 				id = INST_DATA(cl,retval);
 				id->id_Active = id->id_Current = id->id_NewCurrent = GetTagData(IGA_Active,0L,((struct opSet *)msg)->ops_AttrList);
 				id->id_Labels = (STRPTR *)GetTagData(IGA_Labels,0L,((struct opSet *)msg)->ops_AttrList);
@@ -390,7 +391,7 @@
 				struct TagItem *tstate,*ti;
 
 				tstate = ((struct opSet *)msg)->ops_AttrList;
-				while (ti = NextTagItem(&tstate)) {
+				while ((ti = NextTagItem(&tstate)) != 0) {
 					switch (ti->ti_Tag) {
 						case IGA_Active:
 							id->id_Active = id->id_NewCurrent = ti->ti_Data;
@@ -483,7 +484,6 @@
 	return retval;
 }
 
-
 /********************************** Frames-Gadget **********************************/
 
 
@@ -581,10 +581,10 @@
 
 	if (all) {
 		// draw the whole gadget
-		if (img = NewObject(NULL,"frameiclass",
+		if ((img = NewObject(NULL,"frameiclass",
 				IA_Width,  stdframe_width,
 				IA_Height, stdframe_height,
-				TAG_END)) {
+				TAG_END)) != 0) {
 			for (x = 0, y = 0; y < stdframe_rows; x++) {
 				if (x >= stdframe_cols)
 					x = 0,y++;
@@ -597,24 +597,30 @@
 		}
 	}
 	if (stdframe_new != stdframe_active) {
-		if (stdframe_active != ~0L)
-			EraseFatRect(rp,x = gad->LeftEdge+(stdframe_width+3)*(stdframe_active % stdframe_cols)-2,y = gad->TopEdge+(stdframe_height+3)*(stdframe_active/stdframe_cols)-2,x+stdframe_width+3,y+stdframe_height+3);
+		if (stdframe_active != ~0L) {
+			x = gad->LeftEdge + (stdframe_width + 3) * (stdframe_active % stdframe_cols) - 2;
+			y = gad->TopEdge + (stdframe_height + 3) * (stdframe_active / stdframe_cols) - 2;
+			EraseFatRect(rp, x, y, x + stdframe_width + 3, y + stdframe_height + 3);
+		}
 		SetAPen(rp,3);  stdframe_active = stdframe_new;
-		if (stdframe_active != ~0L)
-			DrawFatRect(rp,x = gad->LeftEdge+(stdframe_width+3)*(stdframe_active % stdframe_cols)-2,y = gad->TopEdge+(stdframe_height+3)*(stdframe_active/stdframe_cols)-2,x+stdframe_width+3,y+stdframe_height+3);
+		if (stdframe_active != ~0L)	{
+			x = gad->LeftEdge + (stdframe_width + 3) * (stdframe_active % stdframe_cols) - 2;
+			y = gad->TopEdge + (stdframe_height + 3) * (stdframe_active / stdframe_cols) - 2;
+			DrawFatRect(rp ,x ,y ,x + stdframe_width + 3, y + stdframe_height + 3);
+		}
 	}
 }
 
 
-ULONG PUBLIC
-DispatchFramesGadget(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchFramesGadget(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
-	ULONG retval = 0;
+	IPTR retval = 0;
 	long x, y;
 
 	switch (msg->MethodID) {
 		case OM_NEW:
-			if (retval = DoSuperMethodA(cl,o,msg))
+			if ((retval = DoSuperMethodA(cl,o,msg)) != 0)
 				SetAttrs((Object *)retval,GA_RelVerify,TRUE,TAG_END);
 			break;
 		case GM_DOMAIN:
@@ -686,8 +692,8 @@
 /********************************** PopUp-Image **********************************/
 
 
-ULONG PUBLIC
-DispatchPopUpImage(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchPopUpImage(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
 	if (msg->MethodID == IM_DRAW || msg->MethodID == IM_DRAWFRAME) {
 		/*struct impDraw *imp = (struct impDraw *)msg;
@@ -718,8 +724,8 @@
 /********************************** Bitmap-Image **********************************/
 
 
-ULONG PUBLIC
-DispatchBitmapImage(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchBitmapImage(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
 	struct BitmapIData *bd;
 
@@ -730,10 +736,10 @@
 		{
 			Object *this;
 
-			if (this = (Object *)DoSuperMethodA(cl, o, msg)) {
+			if ((this = (Object *)DoSuperMethodA(cl, o, msg))) {
 				bd = INST_DATA(cl,this);
-				bd->bd_Bitmap = (struct BitMap *)GetTagData(BIA_Bitmap,NULL,((struct opSet *)msg)->ops_AttrList);
-				bd->bd_SelectedBitmap = (struct BitMap *)GetTagData(BIA_SelectedBitmap,NULL,((struct opSet *)msg)->ops_AttrList);
+				bd->bd_Bitmap = (struct BitMap *)GetTagData(BIA_Bitmap, 0, ((struct opSet *)msg)->ops_AttrList);
+				bd->bd_SelectedBitmap = (struct BitMap *)GetTagData(BIA_SelectedBitmap, 0, ((struct opSet *)msg)->ops_AttrList);
 			}
 			return (ULONG)this;
 		}
@@ -789,7 +795,7 @@
 ULONG
 GetBestPictureModeID(ULONG width, ULONG height, ULONG depth)
 {
-	ULONG mode_id = NULL;
+	ULONG mode_id = 0;
 
 	mode_id = BestModeID(BIDTAG_NominalWidth,	width,
 						 BIDTAG_NominalHeight,	height,
@@ -849,11 +855,11 @@
 
 			TRACE(("loading true color image...\n"));
 
-			if (pic = NewObject(NULL, "picture.datatype",
+			if ((pic = NewObject(NULL, "picture.datatype",
 					DTA_ObjName,	pd->pd_Name ? pd->pd_Name : (STRPTR)"image", PDTA_Screen,  scr,
 					PDTA_Remap,		TRUE,
 					DTA_Name,		"picture",
-					TAG_END))
+					TAG_END)) != 0)
 			{
 				ULONG tags[] = {LBMI_WIDTH, 0, LBMI_HEIGHT, 0, LBMI_PIXFMT, 0, LBMI_BYTESPERROW, 0, LBMI_BASEADDRESS, 0, TAG_END};
 				ULONG mod, format, w, h, data;
@@ -871,7 +877,7 @@
 				tags[1] = (ULONG)&w;  tags[3] = (ULONG)&h;
 				tags[5] = (ULONG)&format;  tags[7] = (ULONG)&mod;  tags[9] = (ULONG)&data;
 
-				if (handle = LockBitMapTagList(bm, (struct TagItem *)tags)) {
+				if ((handle = LockBitMapTagList(bm, (struct TagItem *)tags)) != 0) {
 					if (format == PIXFMT_RGB24)
 						format = PBPAFMT_RGB;
 					else if (format == PIXFMT_RGBA32)
@@ -886,7 +892,7 @@
 			bm = NULL;
 		} else {
 			/* clut/standard bitmap */
-			if (bm = AllocBitMap(im->Width, im->Height, pd->pd_Depth, BMF_MINPLANES, pd->pd_BitMap))
+			if ((bm = AllocBitMap(im->Width, im->Height, pd->pd_Depth, BMF_MINPLANES, pd->pd_BitMap)) != 0)
 				BltBitMap(pd->pd_BitMap, 0, 0, bm, 0, 0, im->Width, im->Height, 0xc0, 0xff, NULL);
 
 			TRACE(("setting CLUT8 picture data...\n"));
@@ -954,14 +960,14 @@
 
 		cols = 1 << depth;
 
-		if (pd->pd_ColorMap = AllocVec(sizeof(struct ColorRegister) * cols, MEMF_PUBLIC)) {
+		if ((pd->pd_ColorMap = AllocVec(sizeof(struct ColorRegister) * cols, MEMF_PUBLIC)) != 0) {
 			for (i = 0;i < cols;i++) {
 				pd->pd_ColorMap[i].red =	cregs[i * 3 + 0];
 				pd->pd_ColorMap[i].green = cregs[i * 3 + 1];
 				pd->pd_ColorMap[i].blue =  cregs[i * 3 + 2];
 			}
 
-			if (pd->pd_ColorRegs = AllocVec(sizeof(LONG) * 3 * cols, MEMF_PUBLIC)) {
+			if ((pd->pd_ColorRegs = AllocVec(sizeof(LONG) * 3 * cols, MEMF_PUBLIC)) != 0) {
 				CopyMem(cregs, pd->pd_ColorRegs, sizeof(LONG) * 3 * cols);
 
 				pd->pd_NumColors = cols;
@@ -970,7 +976,7 @@
 				im->Width = width;
 				im->Height = height;
 
-				if (pd->pd_SourceBitMap = AllocBitMap(width, height, depth, 0, NULL)) {
+				if ((pd->pd_SourceBitMap = AllocBitMap(width, height, depth, 0, NULL))) {
 					BltBitMap(&bm, 0, 0, pd->pd_SourceBitMap, 0, 0, width, height, 0xc0, 0xff, NULL);
 					return TRUE;
 				}
@@ -996,9 +1002,9 @@
 						PDTA_BitMapHeader,		&bmh,
 						TAG_DONE) > 4) {
 		if (bm && cregs && cmap && bmh) {
-			if (pd->pd_ColorMap = AllocVec(sizeof(struct ColorRegister) * cols, MEMF_PUBLIC)) {
+			if ((pd->pd_ColorMap = AllocVec(sizeof(struct ColorRegister) * cols, MEMF_PUBLIC)) != 0) {
 				CopyMem(cmap, pd->pd_ColorMap, sizeof(struct ColorRegister) * cols);
-				if (pd->pd_ColorRegs = AllocVec(sizeof(LONG) * 3 * cols, MEMF_PUBLIC)) {
+				if ((pd->pd_ColorRegs = AllocVec(sizeof(LONG) * 3 * cols, MEMF_PUBLIC)) != 0) {
 					CopyMem(cregs, pd->pd_ColorRegs, sizeof(LONG) * 3 * cols);
 
 					pd->pd_NumColors = cols;
@@ -1007,7 +1013,7 @@
 					im->Width = bmh->bmh_Width;
 					im->Height = bmh->bmh_Height;
 
-					if (pd->pd_SourceBitMap = AllocBitMap(bmh->bmh_Width, bmh->bmh_Height, bmh->bmh_Depth, BMF_MINPLANES, bm)) {
+					if ((pd->pd_SourceBitMap = AllocBitMap(bmh->bmh_Width, bmh->bmh_Height, bmh->bmh_Depth, BMF_MINPLANES, bm)) != 0) {
 						BltBitMap(bm, 0, 0, pd->pd_SourceBitMap, 0, 0, im->Width, im->Height, 0xc0, 0xff, NULL);
 						return TRUE;
 					}
@@ -1030,7 +1036,7 @@
 	};
 	Object *obj;
 
-	if (obj = NewDTObjectA(pd->pd_Name, (struct TagItem *)tags)) {
+	if ((obj = NewDTObjectA(pd->pd_Name, (struct TagItem *)tags)) != 0) {
 		if (DoMethod(obj, DTM_PROCLAYOUT, NULL, 1) && CopyFromPictureObject(pd, obj, im)) {
 			DisposeDTObject(obj);
 			SetPictureScreen(pd, im, pd->pd_Screen);
@@ -1042,24 +1048,24 @@
 }
 
 
-ULONG PUBLIC
-DispatchPictureImage(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchPictureImage(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
 	struct PictureIData *pd;
-	ULONG  retval = 0;
+	IPTR   retval = 0;
 
 	pd = INST_DATA(cl, o);
 
 	switch (msg->MethodID) {
 		case OM_NEW:
-			if (retval = DoSuperMethodA(cl, o, msg)) {
+			if ((retval = DoSuperMethodA(cl, o, msg)) != 0) {
 				pd = INST_DATA(cl, retval);
-				pd->pd_Screen = (struct Screen *)GetTagData(PDTA_Screen, NULL, ((struct opSet *)msg)->ops_AttrList);
+				pd->pd_Screen = (struct Screen *)GetTagData(PDTA_Screen, 0, ((struct opSet *)msg)->ops_AttrList);
 
 				IM(retval)->Height = 5;
 				IM(retval)->Width = 5;
 
-				if (pd->pd_Name = AllocString((STRPTR)GetTagData(DTA_Name, NULL, ((struct opSet *)msg)->ops_AttrList))) {
+				if ((pd->pd_Name = AllocString((STRPTR)GetTagData(DTA_Name, 0, ((struct opSet *)msg)->ops_AttrList))) != 0) {
 					if (!GetTagData(PIA_DelayLoad, FALSE, ((struct opSet *)msg)->ops_AttrList)) {
 						if (LoadPictureObject(pd, (struct Image *)retval))
 							break;
@@ -1069,8 +1075,8 @@
 					struct Image *im;
 					LONG *cregs;
 
-					if (im = (APTR)GetTagData(PIA_FromImage, NULL, ((struct opSet *)msg)->ops_AttrList)) {
-						if (cregs = (APTR)GetTagData(PIA_WithColors, NULL, ((struct opSet *)msg)->ops_AttrList)) {
+					if ((im = (APTR)GetTagData(PIA_FromImage, 0, ((struct opSet *)msg)->ops_AttrList)) != 0) {
+						if ((cregs = (APTR)GetTagData(PIA_WithColors, 0, ((struct opSet *)msg)->ops_AttrList)) != 0) {
 							if (CopyFromPictureImage(pd, im, cregs, (struct Image *)retval)) {
 								SetPictureScreen(pd, (struct Image *)retval, pd->pd_Screen);
 								break;
@@ -1079,7 +1085,7 @@
 					}
 				}
 				DoSuperMethod(cl, (Object *)retval, OM_DISPOSE);
-				retval = NULL;
+				retval = 0;
 			}
 			break;
 		case OM_DISPOSE:
@@ -1099,7 +1105,7 @@
 			struct TagItem *ti;
 
 			retval = DoSuperMethodA(cl, o, msg);
-			if (ti = FindTagItem(PDTA_Screen, ((struct opSet *)msg)->ops_AttrList)) {
+			if ((ti = FindTagItem(PDTA_Screen, ((struct opSet *)msg)->ops_AttrList)) != 0) {
 				if (pd->pd_SourceBitMap)
 					SetPictureScreen(pd, (struct Image *)o, (struct Screen *)ti->ti_Data);
 				else if (pd->pd_Name) {
@@ -1143,10 +1149,10 @@
 /********************************** Button-Class **********************************/
 
 
-ULONG PUBLIC
-DispatchButton(reg (a0) Class *cl, reg (a2) Object *o, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchButton(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
-	ULONG  rc;
+	IPTR  rc;
 
 	switch(msg->MethodID) {
 		case GM_GOACTIVE:
@@ -1226,7 +1232,7 @@
 	struct TagItem *ti;
 	ULONG pen = cd->cd_Pen;
 
-	while (ti = NextTagItem(&tstate)) {
+	while ((ti = NextTagItem(&tstate))) {
 		switch (ti->ti_Tag) {
 			case CGA_Color:
 				cd->cd_Color = ti->ti_Data;
@@ -1248,17 +1254,17 @@
 }
 
 
-ULONG PUBLIC
-DispatchColorButton(reg (a0) Class *cl, reg (a2) struct Gadget *gad, reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchColorButton(REG(a0, Class *cl), REG(a2, struct Gadget *gad), REG(a1, Msg msg))
 {
 	struct ColorGData *cd;
-	ULONG rc = 0L;
+	IPTR rc = 0L;
 
 	cd = INST_DATA(cl,gad);
 
 	switch (msg->MethodID) {
 		case OM_NEW:
-			if (rc = DoSuperMethodA(cl, (Object *)gad, msg)) {
+			if ((rc = DoSuperMethodA(cl, (Object *)gad, msg)) != 0) {
 				cd = INST_DATA(cl, rc);
 				SetAttrs((APTR)rc, GA_RelVerify, TRUE, TAG_END);
 				SetColorButton((struct Gadget *)rc, NULL, cd, ((struct opSet *)msg)->ops_AttrList);
@@ -1308,10 +1314,9 @@
 /********************************** Icon-Obj **********************************/
 
 
-ULONG PUBLIC
-DispatchIconObj(reg (a0) Class *cl,reg (a2) Object *o,reg (a1) Msg msg)
+IPTR PUBLIC
+DispatchIconObj(REG(a0, Class *cl), REG(a2, Object *o), REG(a1, Msg msg))
 {
-
 	switch (msg->MethodID) {
 		case GM_GOACTIVE:
 		case GM_HANDLEINPUT:
@@ -1359,46 +1364,44 @@
 void
 InitAppClasses(void)
 {
-	fillHook.h_Entry = (ULONG (*)())fillHookFunc;
-	renderHook.h_Entry = (ULONG (*)())RenderHook;
-	formelHook.h_Entry = (ULONG (*)())FormelHook;
-	formatHook.h_Entry = (ULONG (*)())FormatHook;
-	glinkHook.h_Entry = (ULONG (*)())gLinkHook;
-	linkHook.h_Entry = (ULONG (*)())LinkHook;
-	colorHook.h_Entry = (ULONG (*)())ColorHook;
-	selectHook.h_Entry = (ULONG (*)())SelectHook;
-	popUpHook.h_Entry = (ULONG (*)())PopUpHook;
-	fileHook.h_Entry = (ULONG (*)())HandleFileTypeIDCMP;
+	SETHOOK(fillHook, fillHookFunc);
+	SETHOOK(renderHook, RenderHook);
+	SETHOOK(formelHook, FormelHook);
+	SETHOOK(formatHook, FormatHook);
+	SETHOOK(glinkHook, gLinkHook);
+	SETHOOK(linkHook, LinkHook);
+	SETHOOK(colorHook, ColorHook);
+	SETHOOK(selectHook, SelectHook);
+	SETHOOK(popUpHook, PopUpHook);
+	SETHOOK(fileHook, HandleFileTypeIDCMP);
 
 	CopyMem(GTD_GetHook(GTDH_TREE),&treeHook,sizeof(struct Hook));
 
-	if (buttonclass = MakeClass(NULL,"buttongclass",NULL,0,0))
-		buttonclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchButton;
+	if ((buttonclass = MakeClass(NULL, "buttongclass", NULL, 0, 0)) != 0)
+		SETDISPATCHER(buttonclass, DispatchButton);
 
-	if (colorgclass = MakeClass(NULL,"buttongclass",NULL,sizeof(struct ColorGData),0))
-		colorgclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchColorButton;
+	if ((colorgclass = MakeClass(NULL, "buttongclass", NULL, sizeof(struct ColorGData), 0)) != 0)
+		SETDISPATCHER(colorgclass, DispatchColorButton);
 
-	if (iconobjclass = MakeClass(NULL,"frbuttonclass",NULL,0,0))
-		iconobjclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchIconObj;
+	if ((iconobjclass = MakeClass(NULL, "frbuttonclass", NULL, 0, 0)) != 0)
+		SETDISPATCHER(iconobjclass, DispatchIconObj);
 
-	if (pagegclass = MakeClass(NULL,"gadgetclass",NULL,sizeof(struct PageGData),0))
-		pagegclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchPageGadget;
+	if ((pagegclass = MakeClass(NULL, "gadgetclass", NULL, sizeof(struct PageGData), 0)) != 0)
+		SETDISPATCHER(pagegclass, DispatchPageGadget);
 
-	if (indexgclass = MakeClass(NULL,"gadgetclass",NULL,sizeof(struct IndexGData),0))
-		indexgclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchIndexGadget;
+	if ((indexgclass = MakeClass(NULL, "gadgetclass", NULL, sizeof(struct IndexGData), 0)) != 0)
+		SETDISPATCHER(indexgclass, DispatchIndexGadget);
 
-	if (framesgclass = MakeClass(NULL,"gadgetclass",NULL,0,0))
-		framesgclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchFramesGadget;
+	if ((framesgclass = MakeClass(NULL, "gadgetclass", NULL, 0, 0)) != 0)
+		SETDISPATCHER(framesgclass, DispatchFramesGadget);
 
-	if (pictureiclass = MakeClass(NULL,"imageclass",NULL,sizeof(struct PictureIData),0)) {
-		pictureiclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchPictureImage;
-		pictureiclass->cl_UserData = (ULONG)OpenLibrary("datatypes/picture.datatype",39);
+	if ((pictureiclass = MakeClass(NULL, "imageclass", NULL, sizeof(struct PictureIData), 0)) != 0) {
+		SETDISPATCHER(pictureiclass, DispatchPictureImage);
+		pictureiclass->cl_UserData = (IPTR)OpenLibrary("datatypes/picture.datatype",39);
 	}
-	if (bitmapiclass = MakeClass(NULL,"imageclass",NULL,sizeof(struct BitmapIData),0))
-		bitmapiclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchBitmapImage;
+	if ((bitmapiclass = MakeClass(NULL, "imageclass", NULL, sizeof(struct BitmapIData), 0)) != 0)
+		SETDISPATCHER(bitmapiclass, DispatchBitmapImage);
 
-	if (popupiclass = MakeClass(NULL,"imageclass",NULL,0,0))
-		popupiclass->cl_Dispatcher.h_Entry = (ULONG (*)())DispatchPopUpImage;
+	if ((popupiclass = MakeClass(NULL, "imageclass", NULL, 0, 0)) != 0)
+		SETDISPATCHER(popupiclass, DispatchPopUpImage);
 }
-
-


Property changes on: trunk/boopsi.c
___________________________________________________________________
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Modified: trunk/calc.c
===================================================================
--- trunk/calc.c	2008-12-13 10:00:37 UTC (rev 14)
+++ trunk/calc.c	2008-12-14 22:41:08 UTC (rev 15)
@@ -19,7 +19,12 @@
 STRPTR tf_format, gTextBuffer, itaPoint;
 UWORD calcerr, calcflags = CF_REQUESTER;
 long mday[] = {0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334};
-struct FormatVorlage empty_fv = {NULL, NULL, FVT_NONE, 0, NULL, NULL, 0, 0, 0, 0};
+#if defined(__AROS__) && !(AROS_FLAVOUR & AROS_FLAVOUR_BINCOMPAT)
+#warning FIXME when V1 ABI is out
+struct FormatVorlage empty_fv = {{NULL, NULL, NULL, FVT_NONE, 0}, NULL, 0, 0, 0, 0};
+#else
+struct FormatVorlage empty_fv = {{NULL, NULL, FVT_NONE, 0, NULL}, NULL, 0, 0, 0, 0};
+#endif
 struct MinList flangs;
 APTR tree_stack;
 ULONG tree_size;
@@ -38,7 +43,7 @@
     char   c,intext;
     long   i,l;
 
-    for (i = 0, intext = FALSE, l = 0; c = *(st + i); i++)
+    for (i = 0, intext = FALSE, l = 0; (c = *(st + i)) != 0; i++)
     {
         if (c == intext)
             intext = 0;
@@ -50,7 +55,7 @@
     if (!(t = AllocPooled(pool, strlen(st) - l + 1)))
         return NULL;
 
-    for (i = 0,l = 0,intext = FALSE;c = *(st+i);*(t+l++) = *(st+i++))
+    for (i = 0, l = 0, intext = FALSE; (c = *(st+i)) != 0; *(t+l++) = *(st+i++))
     {
         if (c == intext)
             intext = 0;
@@ -79,7 +84,7 @@
         // enlarge buffer
         STRPTR t;
 
-        if (t = AllocPooled(pool, gTextBufferLength + 256))
+        if ((t = AllocPooled(pool, gTextBufferLength + 256)) != 0)
         {
             strcpy(t, gTextBuffer);
             FreePooled(pool, gTextBuffer, gTextBufferLength);
@@ -141,7 +146,7 @@
  */
 
 STRPTR PUBLIC
-AbsCoord2String(reg (d0) BOOL abscol, reg (d1) long col, reg (d2) BOOL absrow, reg (d3) long row)
+AbsCoord2String(REG(d0, BOOL abscol), REG(d1, long col), REG(d2, BOOL absrow), REG(d3, long row))
 {
     static char t[16];
 
@@ -197,23 +202,25 @@
     /*if (!t->t_Mappe)*/
     {
         if (t->t_Page)
-            page = (struct Page *)FindName(&calcpage->pg_Mappe->mp_Pages,t->t_Page);
+            page = (struct Page *)MyFindName(&calcpage->pg_Mappe->mp_Pages, t->t_Page);
         if (!page)
             page = (struct Page *)FindListNumber(&calcpage->pg_Mappe->mp_Pages,t->t_NumPage-1);
     }
-    /*else
+#if 0
+    else
     {
         D(bug("not implemented\n"));
-        /*if (mp = (struct Mappe *)FindName(&calcpage->pg_Mappe->mp_Projects,t->t_Mappe))
+        /*if (mp = (struct Mappe *)MyFindName(&calcpage->pg_Mappe->mp_Projects,t->t_Mappe))
         {
             if (t->t_NumPage == -1)
-                page = (struct Page *)FindName(&mp->mp_Pages,t->t_Page);
+                page = (struct Page *)MyFindName(&mp->mp_Pages,t->t_Page);
             else
                 page = (struct Page *)FindListNumber(&mp->mp_Pages,t->t_NumPage);
         }*/
         /*if (mp = (struct Mappe *)FindListNumber(&calcpage->pg_Mappe->mp_Projects,t->t_Mappe-1))
             page = (struct Page *)FindListNumber(&mp->mp_Pages,t->t_Page-1);*/
-    }*/
+    }
+#endif
     return page;
 }
 
@@ -223,7 +230,7 @@
 {
     struct Page *page;
 
-    if (page = GetExtCalcPage(t))
+    if ((page = GetExtCalcPage(t)) != 0)
         return GetTableField(page,t->t_Col,t->t_Row);
 
     return NULL;
@@ -320,7 +327,7 @@
     {
         APTR temp;
 
-        if (temp = AllocPooled(pool,(grc_count + 2) * sizeof(ULONG)))
+        if ((temp = AllocPooled(pool, (grc_count + 2) * sizeof(ULONG))) != 0)
         {
             if (grc_base)
             {
@@ -357,9 +364,9 @@
             if (tl->t_Op == OP_EXTCELL && tr->t_Op == OP_EXTCELL && !stricmp(tl->t_Page,tr->t_Page))
             {
                 if (tl->t_Col > tr->t_Col)
-                    swmem(&tl->t_Col,&tr->t_Col,sizeof(LONG));
+                    swmem((UBYTE *)&tl->t_Col, (UBYTE *)&tr->t_Col, sizeof(LONG));
                 if (tl->t_Row > tr->t_Row)
-                    swmem(&tl->t_Row,&tr->t_Row,sizeof(LONG));
+                    swmem((UBYTE *)&tl->t_Row, (UBYTE *)&tr->t_Row, sizeof(LONG));
 
                 tp.tp_Col = tl->t_Col;
                 tp.tp_Row = tl->t_Row;
@@ -430,7 +437,7 @@
     if (t->t_Op == OP_NAME)
     {
         calcpage = rxpage;
-        if (nm = GetName(t->t_Text))
+        if ((nm = GetName(t->t_Text)) != 0)
             t = nm->nm_Root;
     }
     if (t->t_Op == OP_CELL)
@@ -446,12 +453,12 @@
     {
         if ((tl->t_AbsCol ? 0 : tf_col)+tl->t_Col > (tr->t_AbsCol ? 0 : tf_col)+tr->t_Col)
         {
-            swmem(&tl->t_Col,&tr->t_Col,sizeof(LONG));
-            swmem(&tl->t_AbsCol,&tr->t_AbsCol,sizeof(BOOL));
+            swmem((UBYTE *)&tl->t_Col, (UBYTE *)&tr->t_Col, sizeof(LONG));
+            swmem(&tl->t_AbsCol, &tr->t_AbsCol, sizeof(BOOL));
         }
         if ((tl->t_AbsRow ? 0 : tf_row)+tl->t_Row > (tr->t_AbsRow ? 0 : tf_row)+tr->t_Row)
         {
-            swmem(&tl->t_Row,&tr->t_Row,sizeof(LONG));
+            swmem((UBYTE *)&tl->t_Row,(UBYTE *)&tr->t_Row,sizeof(LONG));
             swmem(&tl->t_AbsRow,&tr->t_AbsRow,sizeof(BOOL));
         }
         tp->tp_Col = tl->t_Col+(tl->t_AbsCol ? 0 : tf_col);
@@ -640,7 +647,7 @@
         {
             if (t[len] == '.' && fi->fi_Node.ln_Type == FIT_REFERENCE)
             {
-                *db = (APTR)FindName(&mp->mp_Databases,fi->fi_Special);
+                *db = (APTR)MyFindName(&mp->mp_Databases, fi->fi_Special);
                 return GetNameDatabaseField(mp, db, t + len + 1, sfi, pos);
             }
             else if (!t[len])
@@ -686,7 +693,7 @@
         if (!fi || !fi->fi_Node.ln_Succ)
             return false;
     }
-    else if (t = strchr(t, '.')) /* Der Punkt markiert Felder in Datenbanken - bei normalen Namen ist er unzul?ssig */
+    else if ((t = strchr(t, '.')) != 0) /* Der Punkt markiert Felder in Datenbanken - bei normalen Namen ist er unzul?ssig */
     {
         if (db->db_Node.ln_Type != NMT_DATABASE)
             return false;
@@ -760,7 +767,7 @@
 void
 CalcError(long err)
 {
-    STRPTR t = NULL;
+    CONST_STRPTR t = NULL;
 
     if (!err || !(calcflags & CF_REQUESTER))
         return;
@@ -808,7 +815,7 @@
 
 
 int32 PUBLIC
-CalcTree(reg (a0) struct Result *r,reg (a1) struct Term *t)
+CalcTree(REG(a0, struct Result *r), REG(a1, struct Term *t))
 {
     struct Result r1,r2;
     struct tableField *tf;
@@ -820,9 +827,9 @@
     memset(&r1,0,sizeof(struct Result));  memset(&r2,0,sizeof(struct Result));
     if (t->t_Op != OP_RANGE)
     {
-        if (rc = CalcTree(&r1,t->t_Left))
+        if ((rc = CalcTree(&r1, t->t_Left)) != 0)
             return rc;
-        if (rc = CalcTree(&r2,t->t_Right))
+        if ((rc = CalcTree(&r2, t->t_Right)) != 0)
         {
             FreeString(r1.r_Text);
             return rc;
@@ -903,7 +910,7 @@
             }
             if (r1.r_Type & RT_TEXT && r2.r_Type & RT_TEXT)
             {
-                if (r->r_Text = AllocPooled(pool,(r1.r_Text ? strlen(r1.r_Text) : 0)+(r2.r_Text ? strlen(r2.r_Text) : 0)+1))
+                if ((r->r_Text = AllocPooled(pool,(r1.r_Text ? strlen(r1.r_Text) : 0)+(r2.r_Text ? strlen(r2.r_Text) : 0)+1)) != 0)
                 {
                     if (r1.r_Text)
                         strcpy(r->r_Text,r1.r_Text);
@@ -975,7 +982,7 @@
         case OP_RANGE:
             r1.r_Value = 0.0;
             calcerr = CT_OK;
-            for(tf = NULL;tf = GetRangeCells(t,tf);r1.r_Value += tf->tf_Value);
+            for (tf = NULL; (tf = GetRangeCells(t, tf)) != 0; r1.r_Value += tf->tf_Value);
             rc = calcerr;
             r->r_Value = r1.r_Value;
             r->r_Type = RT_VALUE;
@@ -1040,6 +1047,7 @@
                     case OP_EQLESS: r->r_Value = r1.r_Value <= r2.r_Value;    break;
                     case OP_EQUAL: r->r_Value = r1.r_Value == r2.r_Value;     break;
                     case OP_NOTEQUAL: r->r_Value = r1.r_Value != r2.r_Value;  break;
+                    default: break;
                 }
             }
             else if (r1.r_Type & RT_TEXT && r2.r_Type & RT_TEXT)
@@ -1054,6 +1062,7 @@
                     case OP_EQLESS: r->r_Value = diff <= 0;    break;
                     case OP_EQUAL: r->r_Value = diff == 0;     break;
                     case OP_NOTEQUAL: r->r_Value = diff != 0;  break;
+                    default: break;
                 }
             }
             else
@@ -1104,6 +1113,8 @@
             else
                 rc = CTERR_TYPE;
             break;
+		default:
+			break;
     }
     FreeString(r1.r_Text);  FreeString(r2.r_Text);
     return rc;
@@ -1172,7 +1183,7 @@
 {
     struct Name *cnm;
 
-    if (cnm = AllocPooled(pool,sizeof(struct Name)))
+    if ((cnm = AllocPooled(pool, sizeof(struct Name))) != 0)
     {
         CopyMem(nm,cnm,sizeof(struct Name));
         cnm->nm_Node.ln_Name = AllocString(nm->nm_Node.ln_Name);
@@ -1266,11 +1277,11 @@
 
 
 struct Name *
-AddName(struct MinList *list, STRPTR name, STRPTR content, BYTE type, struct Page *page)
+AddName(struct MinList *list, CONST_STRPTR name, STRPTR content, BYTE type, struct Page *page)
 {
     struct Name *nm;
 
-    if (nm = AllocPooled(pool,sizeof(struct Name)))
+    if ((nm = AllocPooled(pool, sizeof(struct Name))) != 0)
     {
         nm->nm_Node.ln_Name = AllocString(name);
         nm->nm_Node.ln_Type = type & (~NMT_UNDEFINED);
@@ -1289,7 +1300,7 @@
                 UpdateName(nm);
             }
         }
-        AddTail(list, nm);
+        MyAddTail(list, nm);
 
         if ((nm->nm_Node.ln_Type & NMT_DETACHED) == 0)
             AssignUnresolvedReferencesForName(page, nm);
@@ -1317,7 +1328,7 @@
     if (!fv)
         return NULL;
 
-    if (cfv = AllocPooled(pool,sizeof(struct FormatVorlage)))
+    if ((cfv = AllocPooled(pool, sizeof(struct FormatVorlage))) != 0)
     {
         CopyMem(fv,cfv,sizeof(struct FormatVorlage));
         cfv->fv_Node.ln_Name = AllocString(fv->fv_Node.ln_Name);
@@ -1397,7 +1408,7 @@
     struct FormatVorlage *fv;
     double value = 0.0;
 
-	if (fv = AllocPooled(pool, sizeof(struct FormatVorlage)))
+	if ((fv = AllocPooled(pool, sizeof(struct FormatVorlage))) != 0)
     {
         fv->fv_Node.ln_Name = AllocString(t);
         fv->fv_Node.ln_Pri = pri;
@@ -1419,7 +1430,7 @@
 		fv->fv_Preview = AllocString(FitValueInFormat(value, fv, NULL, 0, 0));
         fv->fv_Alignment = align == -1 ? TFA_RIGHT : align;
         fv->fv_NegativePen = pen;
-		AddTail(list, fv);
+		MyAddTail(list, fv);
     }
     return fv;
 }
@@ -1945,7 +1956,7 @@
 
 	index = 0;  zahl = 0.0;  sec = 0.0;  hour = 0;  m = 1;  day = 1;  year = 1;
 
-	while (type = GetFVType(fv, &formatIndex))
+	while ((type = GetFVType(fv, &formatIndex)) != 0)
     {
 		// ignore spaces
 		while (t[index] == ' ')
@@ -1960,7 +1971,7 @@
 				if (length != 0 && !(length == 1 && (t[index] == '-' || t[index] == '+')))
                 {
 					index += length;
-					if (length = nachkommastellen(t + index, &zahl))
+					if ((length = nachkommastellen(t + index, &zahl)) != 0)
 						index += length;
                 }
                 else
@@ -1972,7 +1983,7 @@
 			{
 				bool found = false;
 				int32 length;
-				char *s;
+				const char *s;
 
 				// iterate over the current locale
 				for (m = 0; m < 12; m++)
@@ -2122,7 +2133,7 @@
                     case FVT_SSEC:
                     case FVT_SEC:
 						sec = longValue;
-						if (length = nachkommastellen(t + index, &sec))
+						if ((length = nachkommastellen(t + index, &sec)) != 0)
 							index += length;
                         break;
                     case FVT_SYEAR:
@@ -2176,6 +2187,7 @@
 			day += mday[m - 1];
             if (m > 2 && !(year % 4) && (year % 100 || !(year % 400)))
                 day++;
+			// FIXME: GCC warning: operation on 'year' may be undefined
 			m = (long)--year * 365 + year / 4 - year / 100 + year / 400;
 			*_value = (double)(day + m);
             break;
@@ -2265,7 +2277,7 @@
         tf->tf_Type = TFT_VALUE;
 		if (tf_format && (!tf->tf_Format || !FindLinkName(&mp->mp_CalcFormats, tf->tf_Format)))
         {
-			if (fv = (struct FormatVorlage *)FindLinkName(&mp->mp_CalcFormats, tf_format))
+			if ((fv = (struct FormatVorlage *)FindLinkName(&mp->mp_CalcFormats, tf_format)) != 0)
             {
                 FreeString(tf->tf_Format);
                 tf->tf_Format = AllocString(tf_format);
@@ -2282,7 +2294,7 @@
                     STRPTR t;
                     long   i;
 
-					if (t = AllocString(tf_format))
+					if ((t = AllocString(tf_format)) != 0)
                     {
                         for(i = 0;*(t+i) && !(*(t+i) == '#' && tolower(*(t+i+1)) == 'y');i++);
                         if (*(t+ ++i) == 'y')
@@ -2298,7 +2310,7 @@
 			tf->tf_Text = AllocString(FitValueInFormat(tf->tf_Value, NULL, tf->tf_Format, tf->tf_Komma,
 								tf->tf_Flags & (TFF_SEPARATE | TFF_NEGPARENTHESES)));
 
-			if (fv = (struct FormatVorlage *)FindLinkName(&mp->mp_CalcFormats, tf->tf_Format))
+			if ((fv = (struct FormatVorlage *)FindLinkName(&mp->mp_CalcFormats, tf->tf_Format)) != 0)
             {
                 if (tf->tf_Alignment & TFA_VIRGIN)
                     tf->tf_Alignment = (tf->tf_Alignment & TFA_VCENTER) | fv->fv_Alignment | TFA_VIRGIN;
@@ -2484,14 +2496,14 @@
     char   zahl[32];
     STRPTR s;
 
-    if (k = AllocPooled(pool,sizeof(struct Term)))
+    if ((k = AllocPooled(pool,sizeof(struct Term))) != 0)
     {
         s = *t;
         while(*++s == '.' || *s == ',' || IsAlNum(loc,*s))
             if (*s == ',') *s = '.';
         if (isdigit(**t))
         {
-            stccpy(zahl,*t,(long)(s-*t)+1);
+            stccpy(zahl, *t, (long)((char *)s - *t) + 1);
             k->t_Value = strtod(zahl,NULL);
             k->t_Op = OP_VALUE;
             k->t_Pri = PRI_TOP;
@@ -2530,7 +2542,7 @@
 {
     struct Term *k;
 
-    if (k = AllocPooled(pool,sizeof(struct Term)))
+    if ((k = AllocPooled(pool, sizeof(struct Term))) != 0)
     {
         k->t_Op = OP_NAME;
         k->t_Pri = PRI_TOP;
@@ -2582,7 +2594,7 @@
     struct Term *k;
     long   abs;
 
-    if (k = AllocPooled(pool,sizeof(struct Term)))
+    if ((k = AllocPooled(pool, sizeof(struct Term))) != 0)
     {
         abs = String2Coord(t,&k->t_Col,&k->t_Row);
         k->t_Op = OP_CELL;
@@ -2610,14 +2622,14 @@
     STRPTR buff;
 	long   i, j, size;
 
-    if (buff = AllocPooled(pool,size = strlen(t)+1))
+    if ((buff = AllocPooled(pool,size = strlen(t)+1)) != 0)
     {
-        if (k = AllocPooled(pool,sizeof(struct Term)))
+        if ((k = AllocPooled(pool, sizeof(struct Term))) != 0)
         {
             k->t_Op = OP_FUNC;
             f = FindFunction(name,k);
 
-            NewList((struct List *)&k->t_Args);
+            MyNewList(&k->t_Args);
             strcpy(buff, t);
             for (i = 1,j = 0;i && *t;t++,j++)
             {
@@ -2636,14 +2648,14 @@
                 APTR stack;
                 ULONG size = 1024;
 
-                if (stack = AllocPooled(pool,size))
+                if ((stack = AllocPooled(pool, size)) != 0)
                 {
                     for(i = 0;i < j;i += strlen(buff+i)+1)
                     {
-                        if (fa = AllocPooled(pool,sizeof(struct FuncArg)))
+                        if ((fa = AllocPooled(pool, sizeof(struct FuncArg))) != 0)
                         {
                             fa->fa_Root = createTree(buff+i,&stack,&size);
-                            AddTail((struct List *)&k->t_Args,(struct Node *)fa);
+                            MyAddTail(&k->t_Args, fa);
                         }
                     }
                     if ((calcerr = CheckFuncArgs(f,&k->t_Args)) == CTERR_ARGS)
@@ -2664,7 +2676,7 @@
 {
     struct Term *t;
 
-    if (t = AllocPooled(pool, sizeof(struct Term)))
+    if ((t = AllocPooled(pool, sizeof(struct Term))) != 0)

[... truncated: 16781 lines follow ...]


From axeld at pinc-software.de  Mon Dec 15 00:33:49 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Mon, 15 Dec 2008 00:33:49 +0100 CET
Subject: [Ignition-commits]
 =?utf-8?q?r15_-_in_trunk=3A_=2E_distribution_d?=
 =?utf-8?q?istribution/full/misc_help/deutsch_help/english_libs?=
In-Reply-To: <200812142242.mBEMg1J7032658@sheep.berlios.de>
Message-ID: <54050025233-BeMail@zon>

marust at mail.berlios.de wrote:
> * Renamed macros NewList, AddHead etc. to MyNewList, MyAddHead etc.
>   because of name collision.

Since you probably know more than I do about that: what is this about, 
and why do we have those macros in the first place? :-)

Bye,
   Axel.



From mrustler at gmx.de  Mon Dec 15 01:09:29 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Mon, 15 Dec 2008 01:09:29 +0100
Subject: [Ignition-commits] r15 - in trunk: .
	distribution	distribution/full/misc help/deutsch help/english libs
In-Reply-To: <54050025233-BeMail@zon>
References: <54050025233-BeMail@zon>
Message-ID: <1229299769.8400.25.camel@bellodello>

Am Montag, den 15.12.2008, 00:33 +0100 schrieb Axel D?rfler:
> marust at mail.berlios.de wrote:
> > * Renamed macros NewList, AddHead etc. to MyNewList, MyAddHead etc.
> >   because of name collision.
> 
> Since you probably know more than I do about that: what is this about, 
> and why do we have those macros in the first place? :-)

Before my change it looked like
#define NewList(l) NewList((struct List *)(l))

So we don't need to do the type conversion in the source.

On SAS/C it was possibly to overwrite a function with a macro with the
same name.

But on AROS all library functions are implemented as macros (this is
probably generally the case with GCC on Amiga-like OSses). So I had to
chose another name.


BTW:
When I wrote the commit log I was a bit tired. Other things I did:

I had problems with the headers. Probably circular dependencies. I've
solved this by moving enum WDT to its own file and by adding some
forward declarations.

Endian conversion for the preferences and the mouse pointers.

Changed the argument order for all Hooks and Dispatchers to
Hook* (a0), Object* (a2), Message*(a1)
What I still have to do is to look at all places where such functions
are *called*.

Status
------
Partially working. GUI seems to be complete. Data and formulas can be
entered in cells.
But still a lot of segfaults. (E.g. when trying to save the file)

Next milestone will be diagrams.

There is code similar than
x->link = h->h_Entry
This is evil as this can be this special function from amiga.lib. I
think I have to write a GETHOOKFUNC macro.


Regards,
Matthias




From marust at mail.berlios.de  Mon Dec 15 20:19:42 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Mon, 15 Dec 2008 20:19:42 +0100
Subject: [Ignition-commits] r16 - in trunk: . docs
Message-ID: <200812151919.mBFJJgXd021545@sheep.berlios.de>

Author: marust
Date: 2008-12-15 20:19:35 +0100 (Mon, 15 Dec 2008)
New Revision: 16
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=16&view=rev

Added:
   trunk/docs/ReadMe.html
   trunk/docs/ReadMe.html.info
Removed:
   trunk/docs/Read Me.html
   trunk/docs/Read Me.html.info
Modified:
   trunk/database.c
   trunk/gadgets.h
   trunk/handleprefs.c
   trunk/handlewindows.c
   trunk/hooks.c
   trunk/mmakefile.src
   trunk/popper.c
   trunk/prefs.c
   trunk/types.h
Log:
Some fixes which were sent by AROS core developer Georg Steger to me:

* Added "if ((WORD)imsg.Code < 0) break;"
  When clicked into an empty Listview AROS Gadtools emits a GADGETUP message with CODE == -1.
  This fails where Ignition counts nodes until it reaches imsg.Code. There are probably more places
  where this has to be fixed.
 
* Changed
  ULONG  ASM (*l_HookFunction)(REG(a1, struct LVDrawMsg *), REG(a2, APTR));
  to
  ULONG  ASM (*l_HookFunction)(REG(a0, APTR), REG(a2, APTR), REG(a1, struct LVDrawMsg *));

  Because AROS x86-32 moves all parameters on the stack it fails if parameters are omitted or have
  wrong order.

* "if (pattern != 0xff)" --> "if (pattern != -1)":
  Because pattern is signed it can never be 0xff.

* "helvetica" -> "arial"
  Helvetice font doesn't exist on AROS. The result is wrong layout calculation in some places.

Additionally:
* Renamed Read Me.html to ReadMe.html because copy macro doesn't like spaces in names.
* Copy docs help rexx etc. to target dir

Modified: trunk/database.c
===================================================================
--- trunk/database.c	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/database.c	2008-12-15 19:19:35 UTC (rev 16)
@@ -1466,6 +1466,8 @@
 			switch(i = (gad = imsg.IAddress)->GadgetID)
 			{
 				case 1:  // Database-Liste
+					if ((WORD)imsg.Code < 0)
+						break;
 					for(i = 0,db = (APTR)((struct List *)wd->wd_ExtData[2])->lh_Head;i < imsg.Code;db = (APTR)db->db_Node.ln_Succ,i++);
 					UpdateDatabaseGadgets(mp,db,NULL);
 					break;
@@ -1566,6 +1568,8 @@
 					}
 					break;
 				case 11:  // Felder-Liste
+					if ((WORD)imsg.Code < 0)
+						break;
 					if (db)
 					{
 						for(i = 0,fi = (APTR)db->db_Fields.mlh_Head;i < imsg.Code;fi = (APTR)fi->fi_Node.ln_Succ,i++);
@@ -1773,6 +1777,8 @@
 					}
 					break;
 				case 7:    // field list
+					if ((WORD)imsg.Code < 0)
+						break;
 					if (ma) {
 						for(mf = (APTR)ma->ma_Fields.mlh_Head,i = imsg.Code;i && mf->mf_Node.ln_Succ;mf = (APTR)mf->mf_Node.ln_Succ,i--);
 						UpdateMaskGadgets(ma,mf);

Deleted: trunk/docs/Read Me.html

Deleted: trunk/docs/Read Me.html.info

Copied: trunk/docs/ReadMe.html (from rev 14, trunk/docs/Read Me.html)

Copied: trunk/docs/ReadMe.html.info (from rev 14, trunk/docs/Read Me.html.info)

Modified: trunk/gadgets.h
===================================================================
--- trunk/gadgets.h	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/gadgets.h	2008-12-15 19:19:35 UTC (rev 16)
@@ -163,7 +163,7 @@
 struct Link {
 	struct MinNode l_Node;
 	APTR   l_Link;
-	ULONG  ASM (*l_HookFunction)(REG(a1, struct LVDrawMsg *), REG(a2, APTR));
+	ULONG  ASM (*l_HookFunction)(REG(a0, APTR), REG(a2, APTR), REG(a1, struct LVDrawMsg *));
 };
 
 

Modified: trunk/handleprefs.c
===================================================================
--- trunk/handleprefs.c	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/handleprefs.c	2008-12-15 19:19:35 UTC (rev 16)
@@ -47,6 +47,8 @@
                 DisenablePrefsGadgets(FALSE);
             break;
         case IDCMP_GADGETUP:
+			if ((WORD)imsg.Code < 0)
+				break;
             if ((gad = imsg.IAddress)->GadgetID == 1)
             {
                 for(tn = (APTR)prefstree.tl_View.mlh_Head,i = 0;i < imsg.Code;tn = (APTR)tn->tn_Node.in_Succ,i++);
@@ -2048,6 +2050,8 @@
 				switch (id)
                 {
                     case 1:  // Namen-Liste
+						if ((WORD)imsg.Code < 0)
+							break;
                         for(i = 0,nm = (APTR)((struct List *)wd->wd_ExtData[2])->lh_Head;i < imsg.Code;nm = (APTR)nm->nm_Node.ln_Succ,i++);
                         UpdateNamesGadgets(nm,TRUE);
                         break;

Modified: trunk/handlewindows.c
===================================================================
--- trunk/handlewindows.c	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/handlewindows.c	2008-12-15 19:19:35 UTC (rev 16)
@@ -2138,7 +2138,7 @@
                     if (pages & 2) /* Farbe & Ausrichtung */
                     {
                         SetPageColor(rxpage,apen,bpen);
-                        if (pattern != 0xff)
+						if (pattern != -1)
                             SetCellPattern(rxpage,patcol,pattern);
                         if (alignH || alignV)
                         {

Modified: trunk/hooks.c
===================================================================
--- trunk/hooks.c	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/hooks.c	2008-12-15 19:19:35 UTC (rev 16)
@@ -605,8 +605,7 @@
 ULONG PUBLIC LinkHook(REG(a0, struct Hook *h), REG(a2, struct Link *l), REG(a1, struct LVDrawMsg *msg))
 {
 	if (l->l_HookFunction)
-		return(l->l_HookFunction(msg,l->l_Link));
-
+		return(l->l_HookFunction(0, l->l_Link, msg));
 	return(LVCB_OK);
 }
 

Modified: trunk/mmakefile.src
===================================================================
--- trunk/mmakefile.src	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/mmakefile.src	2008-12-15 19:19:35 UTC (rev 16)
@@ -4,10 +4,13 @@
 
 include $(TOP)/config/make.cfg
 
-#MM- contrib-ignition : contrib-ignition-bin contrib-ignition-icons contrib-ignition-config
+#MM- contrib-ignition : contrib-ignition-bin contrib-ignition-icons contrib-ignition-config \
+#MM  contrib-ignition-help contrib-ignition-rexx contrib-ignition-sheets \
+#MM  contrib-ignition-docs contrib-ignition-files
 
 #MM contrib-ignition-bin : linklibs includes contrib-ignition-textedit \
-#MM contrib-ignition-scroller contrib-ignition-gtdrag contrib-ignition-catalogs
+#MM contrib-ignition-scroller contrib-ignition-gtdrag contrib-ignition-catalogs \
+#MM contrib-ignition-gcdescr
 
 EXE := Ignition
 
@@ -65,5 +68,19 @@
 
 %copy_dir_recursive mmake=contrib-ignition-icons src=icons dst=$(TARGETDIR)/icons
 %copy_dir_recursive mmake=contrib-ignition-config src=config dst=$(TARGETDIR)/config
+%copy_dir_recursive mmake=contrib-ignition-docs src=docs dst=$(TARGETDIR)/docs
+%copy_dir_recursive mmake=contrib-ignition-help src=help dst=$(TARGETDIR)/help
+%copy_dir_recursive mmake=contrib-ignition-rexx src=rexx dst=$(TARGETDIR)/rexx
+%copy_dir_recursive mmake=contrib-ignition-sheets src=sheets dst=$(TARGETDIR)/sheets
 
+#MM
+contrib-ignition-gcdescr :
+FILES := $(wildcard add-ons/*.gcdescr)
+%copy_files_q files=$(FILES) src=. dst=$(TARGETDIR) maketarget=contrib-ignition-gcdescr
+
+#MM
+contrib-ignition-files :
+FILES := ignition.info LICENSE README
+%copy_files_q files=$(FILES) src=. dst=$(TARGETDIR) maketarget=contrib-ignition-files
+
 %common

Modified: trunk/popper.c
===================================================================
--- trunk/popper.c	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/popper.c	2008-12-15 19:19:35 UTC (rev 16)
@@ -309,8 +309,10 @@
 		px = 0;
 
 	if ((bm = AllocBitMap(pw, ph, GetBitMapAttr(rp->BitMap, BMA_DEPTH), BMF_MINPLANES, rp->BitMap)) != 0) {
+#ifndef __AROS__ /* quick fix to avoid deadlock */
 		LockLayers(&scr->LayerInfo);
 		UnlockLayer(win->RPort->Layer);
+#endif
 		BltBitMap(rp->BitMap,px,py,bm,0,0,pw,ph,0xc0,0xff,NULL);
 		EraseRect(rp,px,py,px+pw-1,py+ph-1);
 
@@ -370,8 +372,10 @@
 		}
 		BltBitMapRastPort(bm,0,0,rp,px,py,pw,ph,0xc0);
 		FreeBitMap(bm);
+#ifndef __AROS__ /* quick fix to avoid deadlock */
 		LockLayer(0, win->RPort->Layer);
 		UnlockLayers(&scr->LayerInfo);
+#endif
 	}
 
 	if (noreport)

Modified: trunk/prefs.c
===================================================================
--- trunk/prefs.c	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/prefs.c	2008-12-15 19:19:35 UTC (rev 16)
@@ -281,7 +281,11 @@
 				pd->pd_ToolBar = TRUE;
 				pd->pd_HelpBar = TRUE;
 				pd->pd_ShowAntis = TRUE;
+#ifdef __AROS__
+				pd->pd_AntiAttr.ta_Name = AllocString("arial.font");
+#else
 				pd->pd_AntiAttr.ta_Name = AllocString("helvetica.font");
+#endif	
 				pd->pd_AntiAttr.ta_YSize = 11;
 				UpdateAntiFont(pr);
 			}
@@ -307,7 +311,11 @@
 				strcpy(ps->ps_PubName,"Workbench");
 				ps->ps_BackFill = TRUE;
 				ps->ps_BFColor = 1;
+#ifdef __AROS__
+				ps->ps_TextAttr.ta_Name = AllocString("arial.font");
+#else
 				ps->ps_TextAttr.ta_Name = AllocString("helvetica.font");
+#endif
 				ps->ps_TextAttr.ta_YSize = 11;
 				ps->ps_mmWidth = 340 << 10;
 				ps->ps_mmHeight = 280 << 10;

Modified: trunk/types.h
===================================================================
--- trunk/types.h	2008-12-14 22:41:08 UTC (rev 15)
+++ trunk/types.h	2008-12-15 19:19:35 UTC (rev 16)
@@ -528,9 +528,16 @@
 struct Command {
     struct Command *cmd_Succ;
     struct Command *cmd_Pred;
+#if defined(__AROS__)
+  #warning FIXME when V1 ABI is out
+    char   *cmd_Name;
     UBYTE  cmd_Type;
     BYTE   cmd_Pri;
+#else
+    UBYTE  cmd_Type;
+    BYTE   cmd_Pri;
     char   *cmd_Name;
+#endif
 };
 
 #define CMDT_INTERN 0



From axeld at pinc-software.de  Mon Dec 15 23:17:52 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Mon, 15 Dec 2008 23:17:52 +0100 CET
Subject: [Ignition-commits] r16 - in trunk: . docs
In-Reply-To: <200812151919.mBFJJgXd021545@sheep.berlios.de>
Message-ID: <46260922036-BeMail@zon>

marust at mail.berlios.de wrote:
> * "if (pattern != 0xff)" --> "if (pattern != -1)":
>   Because pattern is signed it can never be 0xff.

The SAS/C compiler apparently was too good to me :-)

Bye,
   Axel.



From marust at mail.berlios.de  Tue Dec 16 20:06:08 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Tue, 16 Dec 2008 20:06:08 +0100
Subject: [Ignition-commits] r17 - in trunk: . add-ons
	libs/gtdrag/include/libraries
Message-ID: <200812161906.mBGJ68Vl009652@sheep.berlios.de>

Author: marust
Date: 2008-12-16 20:05:58 +0100 (Tue, 16 Dec 2008)
New Revision: 17
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=17&view=rev

Modified:
   trunk/add-ons/area_diagram.c
   trunk/add-ons/ascii.c
   trunk/add-ons/button.c
   trunk/add-ons/checkbox.c
   trunk/add-ons/circle_diagram.c
   trunk/add-ons/column_diagram.c
   trunk/add-ons/csv.c
   trunk/add-ons/frame.c
   trunk/add-ons/gclass.c
   trunk/add-ons/gclass.h
   trunk/add-ons/gradient.c
   trunk/add-ons/iotype.c
   trunk/add-ons/iotype.h
   trunk/add-ons/line.c
   trunk/add-ons/line_diagram.c
   trunk/add-ons/rectangle.c
   trunk/add-ons/text.c
   trunk/add-ons/turbocalc.c
   trunk/diagram.c
   trunk/font.c
   trunk/libs/gtdrag/include/libraries/gtdrag.h
Log:
* Replaced remaining __asm and reg( macros by
  ASM and REG( from SDI_compiler.h


Modified: trunk/add-ons/area_diagram.c
===================================================================
--- trunk/add-ons/area_diagram.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/area_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -16,12 +16,6 @@
 
 #include <string.h>
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: area_diagram.gc 0.5 (7.8.2003)";
 
 /** private instance structure **/
@@ -56,8 +50,8 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *rp, reg (a1) struct gClass *gc,
-	reg (a2) struct gDiagram *gd, reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *rp), REG(a1, struct gClass *gc),
+	REG(a2, struct gDiagram *gd), REG(a3, struct gBounds *gb))
 {
     struct gBounds *agb;
 	struct gArea *this_ga = GINST_DATA(gc, gd);
@@ -217,7 +211,7 @@
 
 
 ULONG PUBLIC
-dispatch(reg (a0) struct gClass *gc,reg (a1) struct gDiagram *gd,reg (a2) Msg msg)
+dispatch(REG(a0, struct gClass *gc), REG(a1, struct gDiagram *gd), REG(a2, Msg msg))
 {
   struct gArea *ga = GINST_DATA(gc,gd);
   ULONG  rc;
@@ -280,7 +274,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
 	return TRUE;
@@ -288,7 +282,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_AREA_OUTLINE_GAD, "Fl?che durch einen Rahmen begrenzen");

Modified: trunk/add-ons/ascii.c
===================================================================
--- trunk/add-ons/ascii.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/ascii.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -24,7 +24,7 @@
 
 
 void PUBLIC
-openPrefsGUI(reg (a0) struct Screen *src)
+openPrefsGUI(REG(a0, struct Screen *src))
 {
 }
 
@@ -37,14 +37,14 @@
 
 
 long PUBLIC
-setPrefs(reg (a0) STRPTR t)
+setPrefs(REG(a0, STRPTR t))
 {
 	return TRUE;
 }
 
 
 long PUBLIC
-load(reg (d0) BPTR file,reg (a0) struct Mappe *mp)
+load(REG(d0, BPTR file), REG(a0, struct Mappe *mp))
 {
 	struct Page *page;
 	struct Cell *c;
@@ -67,7 +67,7 @@
 
 
 long PUBLIC
-save(reg (d0) BPTR file,reg (a0) struct Mappe *mp)
+save(REG(d0, BPTR file), REG(a0, struct Mappe *mp))
 {
 	struct Page *page;
 	struct Cell *c;

Modified: trunk/add-ons/button.c
===================================================================
--- trunk/add-ons/button.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/button.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -15,12 +15,6 @@
 #include <string.h>
 
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: button.gc 0.15 (6.8.2003)";
 
 struct gButton {
@@ -52,8 +46,8 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *grp, reg (a1) struct gClass *gc,
-	reg (a2) struct gObject *go, reg (a3) struct gBounds *gbo)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc),
+	REG(a2, struct gObject *go), REG(a3, struct gBounds *gbo))
 {
 	struct gButton *gb = GINST_DATA(gc, go);
 	long bx, by, w, h;
@@ -216,7 +210,7 @@
 
 
 ULONG PUBLIC
-dispatch(reg (a0) struct gClass *gc,reg (a1) struct gObject *go,reg (a2) Msg msg)
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a2, Msg msg))
 {
   struct gButton *gb = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -317,7 +311,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
 	return TRUE;
@@ -325,7 +319,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 

Modified: trunk/add-ons/checkbox.c
===================================================================
--- trunk/add-ons/checkbox.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/checkbox.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -14,12 +14,6 @@
 
 #include <string.h>
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: checkbox.gc 0.3 (6.8.2003)";
 
 struct Checkbox
@@ -63,7 +57,7 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page,reg (d1) ULONG dpi,reg (a0) struct RastPort *grp,reg (a1) struct gClass *gc,reg (a2) struct gObject *go,reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc), REG(a2, struct gObject *go), REG(a3, struct gBounds *gb))
 {
   struct Checkbox *cb = GINST_DATA(gc,go);
   long bx,by,bx2,h;
@@ -248,7 +242,7 @@
 }
 
 
-ULONG PUBLIC dispatch(reg (a0) struct gClass *gc,reg (a1) struct gObject *go,reg (a2) Msg msg)
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
 {
   struct Checkbox *cb = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -357,7 +351,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
 	return TRUE;
@@ -365,7 +359,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 

Modified: trunk/add-ons/circle_diagram.c
===================================================================
--- trunk/add-ons/circle_diagram.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/circle_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -18,12 +18,7 @@
 #include <stdio.h>
 #include <math.h>
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 #define DEGREE_STEPS PI/128
 
 const char *version = "$VER: circle_diagram.gc 0.3 (7.8.2003)";
@@ -117,8 +112,8 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page,reg (d1) ULONG dpi,reg (a0) struct RastPort *rp,reg (a1) struct gClass *gc,
-    reg (a2) struct gDiagram *gd,reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *rp), REG(a1, struct gClass *gc),
+    REG(a2, struct gDiagram *gd), REG(a3, struct gBounds *gb))
 {
     struct gCircle *this_gc = GINST_DATA(gc, gd);
     struct gLink *gl;
@@ -236,7 +231,7 @@
 
 
 ULONG PUBLIC
-dispatch(reg (a0) struct gClass *gc, reg (a1) struct gDiagram *gd, reg (a2) Msg msg)
+dispatch(REG(a0, struct gClass *gc), REG(a1, struct gDiagram *gd), REG(a2, Msg msg))
 {
     struct gCircle *this_gc = GINST_DATA(gc, gd);
     ULONG  rc;
@@ -284,7 +279,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
     return TRUE;
@@ -292,7 +287,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_AREA_OUTLINE_GAD, "Fl???che durch einen Rahmen begrenzen");

Modified: trunk/add-ons/column_diagram.c
===================================================================
--- trunk/add-ons/column_diagram.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/column_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -16,12 +16,7 @@
 
 #include <string.h>
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
-extern void kprintf(STRPTR, ...);
-#define bug kprintf
-
 const char *version = "$VER: column_diagram.gc 0.7 (7.8.2003)";
 
 /** private instance structure **/
@@ -57,8 +52,8 @@
 
  
 void PUBLIC
-draw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *rp, reg (a1) struct gClass *gc,
-	reg (a2) struct gDiagram *gd, reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *rp), REG(a1, struct gClass *gc),
+	REG(a2, struct gDiagram *gd), REG(a3, struct gBounds *gb))
 {
     struct gBounds *agb;
 	struct gBalken *this_gb = GINST_DATA(gc, gd);
@@ -217,7 +212,7 @@
 
 
 ULONG PUBLIC
-dispatch(reg (a0) struct gClass *gc,reg (a1) struct gDiagram *gd,reg (a2) Msg msg)
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gDiagram *gd), REG(a1, Msg msg))
 {
   struct gBalken *gb = GINST_DATA(gc,gd);
   ULONG  rc;
@@ -259,7 +254,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
     return TRUE;
@@ -267,7 +262,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_AREA_OUTLINE_GAD, "Fl?che durch einen Rahmen begrenzen");

Modified: trunk/add-ons/csv.c
===================================================================
--- trunk/add-ons/csv.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/csv.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -31,7 +31,7 @@
 
 
 void PUBLIC
-openPrefsGUI(reg (a0) struct Screen *src)
+openPrefsGUI(REG(a0, struct Screen *src))
 {
 }
 
@@ -66,7 +66,7 @@
 
 
 long PUBLIC
-setPrefs(reg (a0) STRPTR t)
+setPrefs(REG(a0, STRPTR t))
 {
   UBYTE  ok = TRUE;
   STRPTR s;
@@ -108,7 +108,7 @@
 }
 
 
-long PUBLIC load(reg (d0) BPTR file,reg (a0) struct Mappe *mp)
+long PUBLIC load(REG(d0, BPTR file), REG(a0, struct Mappe *mp))
 {
   char   *buffer = NULL,*s,sep;
   struct Page *page;
@@ -215,7 +215,7 @@
 }
 
 
-long PUBLIC save(reg (d0) BPTR dat,reg (a0) struct Mappe *mp)
+long PUBLIC save(REG(d0, BPTR dat), REG(a0, struct Mappe *mp))
 {
   struct Page *page;
   struct Cell *c;

Modified: trunk/add-ons/frame.c
===================================================================
--- trunk/add-ons/frame.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/frame.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -14,8 +14,6 @@
 
 #include <string.h>
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
 extern void kprintf(STRPTR,...);
 #define bug kprintf
@@ -121,7 +119,7 @@
 }
 
 
-void PUBLIC draw(reg (d0) struct Page *page,reg (d1) ULONG dpi,reg (a0) struct RastPort *grp,reg (a1) struct gClass *gc,reg (a2) struct gObject *go,reg (a3) struct gBounds *gb)
+void PUBLIC draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc), REG(a2, struct gObject *go), REG(a3, struct gBounds *gb))
 {
   struct Frame *f = GINST_DATA(gc,go);
   long bx,by;
@@ -184,7 +182,7 @@
 }
 
 
-ULONG PUBLIC dispatch(reg (a0) struct gClass *gc,reg (a1) struct gObject *go,reg (a2) Msg msg)
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a1, Msg msg))
 {
   struct Frame *f = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -247,7 +245,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
 	return TRUE;
@@ -255,7 +253,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 

Modified: trunk/add-ons/gclass.c
===================================================================
--- trunk/add-ons/gclass.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/gclass.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -22,13 +22,7 @@
 
 #include "gclass.h"
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
-extern kprintf(STRPTR,...);
-#define bug kprintf
-
-
 struct __gClass {
 	struct ImageNode gc_Node;   /* name and icon, only for non-diagrams */
 	struct gClass *gc_Super;    /* super class */
@@ -37,9 +31,9 @@
 	ULONG  gc_Flags;
 	struct gInterface *gc_Interface;
 	BPTR   gc_Segment;
-	ULONG  __asm (*gc_Dispatch)(reg (a0) struct gClass *,reg (a1) APTR,reg (a2) Msg);
-	ULONG  __asm (*gc_Draw)(reg (d0) struct Page *,reg (d1) ULONG,reg (a0) struct RastPort *,reg (a1) struct gClass *,reg (a2) struct gObject *,reg (a3) struct gBounds *);
-	ULONG  __asm (*gc_FreeClass)(reg (a0) struct gClass *);
+	ULONG  ASM (*gc_Dispatch)(REG(a0, struct gClass *), REG(a1, APTR), REG(a2, Msg));
+	ULONG  ASM (*gc_Draw)(REG(d0, struct Page *), REG(d1, ULONG), REG(a0, struct RastPort *), REG(a1, struct gClass *), REG(a2, struct gObject *), REG(a3, struct gBounds *));
+	ULONG  ASM (*gc_FreeClass)(REG(a0, struct gClass *));
 	STRPTR gc_ClassName;        /* internal access (filename) */
 };
 
@@ -52,19 +46,19 @@
 
 /* Module functions */
 
-extern ULONG PUBLIC dispatch(reg (a0) struct gClass *gc,reg (a1) APTR obj,reg (a2) Msg msg);
-extern ULONG PUBLIC draw(reg (d0) struct Page *,reg (d0) ULONG,reg (a0) struct RastPort *,reg (a1) struct gClass *,reg (a2) struct gObject *,reg (a3) struct gBounds *);
-extern ULONG PUBLIC freeClass(reg (a0) struct gClass *gc);
-extern ULONG PUBLIC initClass(reg (a0) struct gClass *gc);
+extern ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, APTR obj), REG(a2, Msg msg));
+extern ULONG PUBLIC draw(REG(d0, struct Page *), REG(d0, ULONG), REG(a0) struct RastPort *), REG(a1, struct gClass *), REG(a2, struct gObject *), REG(a3, struct gBounds *));
+extern ULONG PUBLIC freeClass(REG(a0, struct gClass *gc));
+extern ULONG PUBLIC initClass(REG(a0, struct gClass *gc));
 extern struct gInterface interface[];
 extern ULONG instanceSize;
 extern const STRPTR superClass;
 
 
 BOOL PUBLIC
-InitGClass(reg (a6) struct ExecBase *ExecBase, reg (a0) struct __gClass *gc, reg (a1) APTR table, reg (a2) APTR mainpool,
-	reg (a3) APTR gfxbase, reg (d0) APTR mathbase, reg (d1) APTR mathtrans, reg (d2) APTR utilitybase, reg (d3) APTR localebase,
-    reg (d4) long magic)
+InitGClass(REG(a6, struct ExecBase *ExecBase), REG(a0, struct __gClass *gc), REG(a1, APTR table), REG(a2, APTR mainpool),
+	REG(a3, APTR gfxbase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
+    REG(d4, long magic))
 {
 #ifdef IGNITION_LITE_EDITION
 	if (magic != MAKE_ID('I', 'G', 'N', '\0') && magic != MAKE_ID('I', 'G', 'L', '\0'))

Modified: trunk/add-ons/gclass.h
===================================================================
--- trunk/add-ons/gclass.h	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/gclass.h	2008-12-16 19:05:58 UTC (rev 17)
@@ -19,6 +19,8 @@
 #include <proto/utility.h>
 #include <proto/locale.h>
 
+#include "SDI_compiler.h"
+
 extern APTR gcBase;
 
 #ifndef CELL_H
@@ -36,8 +38,8 @@
   ULONG  gc_Flags;
   struct gInterface *gc_Interface;
 /*  BPTR   gc_Segment;
-  ULONG  __asm (*gc_Dispatch)(reg (a0) struct gClass *,reg (a1) APTR,reg (a2) Msg);
-  ULONG  __asm (*gc_Draw)(reg (a0) struct Page *,reg (a1) struct gObject *,reg (a2) struct RastPort *,reg (d0) long,reg (d1) long);
+  ULONG  ASM (*gc_Dispatch)(REG(a0, struct gClass *), REG(a2, APTR), REG(a1, Msg));
+  ULONG  ASM (*gc_Draw)(REG(a0, struct Page *), REG(a1, struct gObject *), REG(a2, struct RastPort *), REG(d0, long), REG(d1, long));
   ULONG  (*gc_FreeClass)(void);
   STRPTR gc_ClassName;        /* interner Zugriff (Dateiname) */*/
 };

Modified: trunk/add-ons/gradient.c
===================================================================
--- trunk/add-ons/gradient.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/gradient.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -13,12 +13,6 @@
 #include "ignition_strings.h"
 
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: gradient.gc 0.3 (7.8.2003)";
 
 struct Gradient {
@@ -48,7 +42,7 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *grp, reg (a1) struct gClass *gc, reg (a2) struct gObject *go, reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc), REG(a2, struct gObject *go), REG(a3, struct gBounds *gb))
 {
     struct Gradient *g = GINST_DATA(gc, go);
     long x = gb->gb_Left,y = gb->gb_Top;
@@ -134,7 +128,7 @@
 
 
 ULONG PUBLIC
-dispatch(reg (a0) struct gClass *gc, reg (a1) struct gObject *go, reg (a2) Msg msg)
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a2, Msg msg))
 {
     struct Gradient *g = GINST_DATA(gc, go);
     ULONG rc = 0L;
@@ -183,7 +177,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
     return TRUE;
@@ -191,7 +185,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_FIRST_COLOR_LABEL, "Erste Farbe:");

Modified: trunk/add-ons/iotype.c
===================================================================
--- trunk/add-ons/iotype.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/iotype.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -20,15 +20,7 @@
 #include <math.h>
 /*#include <mieeedoub.h>*/
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
-#ifdef DEBUG
-  extern kprintf(STRPTR,...);
-# define bug kprintf
-#endif
-
-
 // Must always be in sync with the definition in io.h !!!
 
 struct IOType {
@@ -41,12 +33,12 @@
   STRPTR io_OriginalBytes;
   UBYTE  io_Flags;
   BPTR   io_Segment;
-  long   __asm (*io_Load)(reg (d0) BPTR,reg (a0) struct Mappe *);
-  long   __asm (*io_Save)(reg (d0) BPTR,reg (a0) struct Mappe *);
-  long   __asm (*io_SetPrefs)(reg (a0) STRPTR);
-  STRPTR __asm (*io_GetPrefs)(void);
-  void   __asm (*io_OpenPrefsGUI)(reg (a0) struct Screen *);
-  void   __asm (*io_ClosePrefsGUI)(void);
+  long   ASM (*io_Load)(REG(d0, BPTR), REG(a0, struct Mappe *));
+  long   ASM (*io_Save)(REG(d0, BPTR), REG(a0, struct Mappe *));
+  long   ASM (*io_SetPrefs)(REG(a0, STRPTR));
+  STRPTR ASM (*io_GetPrefs)(void);
+  void   ASM (*io_OpenPrefsGUI)(REG(a0) struct Screen *);
+  void   ASM (*io_ClosePrefsGUI)(void);
   STRPTR io_Short;
   STRPTR io_Prefs;
   STRPTR io_Suffix;
@@ -69,21 +61,21 @@
 
 /* Modul-Funktionen*/
 
-extern LONG PUBLIC load(reg (d0) BPTR dat,reg (a0) struct Mappe *mp);
-extern LONG PUBLIC save(reg (d0) BPTR dat,reg (a0) struct Mappe *mp);
-extern LONG PUBLIC setPrefs(reg (a0) STRPTR);
+extern LONG PUBLIC load(REG(d0, BPTR dat), REG(a0, struct Mappe *mp));
+extern LONG PUBLIC save(REG(d0, BPTR dat), REG(a0, struct Mappe *mp));
+extern LONG PUBLIC setPrefs(REG(a0, STRPTR));
 extern STRPTR PUBLIC getPrefs(void);
 extern UBYTE PUBLIC hasPrefsGUI(void);
-extern void PUBLIC openPrefsGUI(reg (a0) struct Screen *scr);
+extern void PUBLIC openPrefsGUI(REG(a0, struct Screen *scr));
 extern void PUBLIC closePrefsGUI(void);
 
 #define MAKE_ID(a,b,c,d) ((a << 24) | (b << 16) | (c << 8) | d)
 
 
 BOOL PUBLIC
-InitModule(reg (a6) struct ExecBase *execBase,reg (a0) struct IOType *io,reg (a1) APTR table,reg (a2) APTR mainpool,
-	reg (a3) APTR dosBase, reg (d0) APTR mathBase,reg (d1) APTR mathtransBase, reg (d2) long magic,
-	reg (d3) APTR utilityBase, reg (d4) APTR localeBase)
+InitModule(REG(a6, struct ExecBase *execBase), REG(a0, struct IOType *io), REG(a1, APTR table), REG(a2, APTR mainpool),
+	REG(a3, APTR dosBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, long magic),
+	REG(d3, APTR utilityBase), REG(d4, APTR localeBase))
 {
 #ifdef IGNITION_LITE_EDITION
 	if (magic != MAKE_ID('I', 'G', 'N', '\0') && magic != MAKE_ID('I', 'G', 'L', '\0'))

Modified: trunk/add-ons/iotype.h
===================================================================
--- trunk/add-ons/iotype.h	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/iotype.h	2008-12-16 19:05:58 UTC (rev 17)
@@ -30,10 +30,8 @@
 #include "cell.h"
 #endif
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
+#include "SDI_compiler.h"
 
-
 /*** Project related ***/
 
 struct Event

Modified: trunk/add-ons/line.c
===================================================================
--- trunk/add-ons/line.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/line.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -10,13 +10,7 @@
 #include "gclass_protos.h"
 #include "gclass_pragmas.h"
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
-
 const char *version = "$VER: line.gc 0.12 (2.3.2003)";
 
 
@@ -44,7 +38,7 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page,reg (d1) ULONG dpi,reg (a0) struct RastPort *grp,reg (a1) struct gClass *gc,reg (a2) struct gObject *go,reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc), REG(a2, struct gObject *go), REG(a3, struct gBounds *gb))
 {
   struct gLine *gl = GINST_DATA(gc,go);
   struct point2d *p = go->go_Knobs;
@@ -120,7 +114,7 @@
 }
 
 
-ULONG PUBLIC dispatch(reg (a0) struct gClass *gc,reg (a1) struct gObject *go,reg (a2) Msg msg)
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
 {
   struct gLine *gl = GINST_DATA(gc,go);
   ULONG  rc = 0L;
@@ -290,13 +284,13 @@
 }
 
 
-ULONG PUBLIC freeClass(reg (a0) struct gClass *gc)
+ULONG PUBLIC freeClass(REG(a0, struct gClass *gc))
 {
   return(TRUE);
 }
 
 
-ULONG PUBLIC initClass(reg (a0) struct gClass *gc)
+ULONG PUBLIC initClass(REG(a0, struct gClass *gc))
 {
   return(TRUE);
 }

Modified: trunk/add-ons/line_diagram.c
===================================================================
--- trunk/add-ons/line_diagram.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/line_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -17,12 +17,6 @@
 #include <string.h>
 
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: line_diagram.gc 0.3 (7.8.2003)";
 
 /** private instance structure **/
@@ -49,7 +43,7 @@
  
 
 void PUBLIC
-draw(reg (d0) struct Page *page,reg (d1) ULONG dpi,reg (a0) struct RastPort *rp,reg (a1) struct gClass *gc,reg (a2) struct gDiagram *gd,reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *rp), REG(a1, struct gClass *gc), REG(a2, struct gDiagram *gd), REG(a3, struct gBounds *gb))
 {
   struct gBounds *agb;
   /*struct gArea *this_ga = GINST_DATA(gc,gd);*/
@@ -175,7 +169,7 @@
 }
 
 
-ULONG PUBLIC dispatch(reg (a0) struct gClass *gc,reg (a1) struct gDiagram *gd,reg (a2) Msg msg)
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gDiagram *gd), REG(a2, Msg msg))
 {
 //  struct gLine *gl = GINST_DATA(gc,gd);
   ULONG  rc;
@@ -230,7 +224,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
 	return TRUE;
@@ -238,7 +232,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 	//interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_AREA_OUTLINE_GAD, "Fl?che durch einen Rahmen begrenzen");

Modified: trunk/add-ons/rectangle.c
===================================================================
--- trunk/add-ons/rectangle.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/rectangle.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -9,12 +9,6 @@
 #include "gclass_protos.h"
 #include "gclass_pragmas.h"
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
-
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: rectangle.gc 0.6 (2.3.2003)";
 
 struct Rect
@@ -35,8 +29,8 @@
 
 
 void PUBLIC
-draw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *grp, reg (a1) struct gClass *gc,
-	reg (a2) struct gObject *go, reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc),
+	REG(a2, struct gObject *go), REG(a3, struct gBounds *gb))
 {
   struct Rect *r = GINST_DATA(gc, go);
   long x = gb->gb_Left,y = gb->gb_Top;
@@ -103,7 +97,7 @@
 }
 
 
-ULONG PUBLIC dispatch(reg (a0) struct gClass *gc,reg (a1) struct gObject *go,reg (a2) Msg msg)
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
 {
   struct Rect *r = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -151,14 +145,14 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	return TRUE;
 }
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	return TRUE;
 }

Modified: trunk/add-ons/text.c
===================================================================
--- trunk/add-ons/text.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/text.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -14,12 +14,7 @@
 
 #include <string.h>
 
-#define reg(x) register __ ## x
-#define PUBLIC __saveds __asm
 
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: text.gc 0.2 (6.8.2003)";
 
 struct gText {
@@ -43,8 +38,8 @@
  
 
 void PUBLIC
-draw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *grp, reg (a1) struct gClass *gc,
-	reg (a2) struct gObject *go, reg (a3) struct gBounds *gb)
+draw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *grp), REG(a1, struct gClass *gc),
+	REG(a2, struct gObject *go), REG(a3, struct gBounds *gb))
 {	
 	struct gText *gt = GINST_DATA(gc, go);
 	long w, h;
@@ -112,7 +107,7 @@
 
 
 ULONG PUBLIC
-dispatch(reg (a0) struct gClass *gc, reg (a1) struct gObject *go, reg (a2) Msg msg)
+dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
 {
 	struct gText *gt = GINST_DATA(gc, go);
 	ULONG rc = 0L;
@@ -197,7 +192,7 @@
 
 
 ULONG PUBLIC
-freeClass(reg (a0) struct gClass *gc)
+freeClass(REG(a0, struct gClass *gc))
 {
 	CloseCatalog(sCatalog);
 	return TRUE;
@@ -205,7 +200,7 @@
 
 
 ULONG PUBLIC
-initClass(reg (a0) struct gClass *gc)
+initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
 	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_TEXT_COLOR_LABEL, "Textfarbe:");

Modified: trunk/add-ons/turbocalc.c
===================================================================
--- trunk/add-ons/turbocalc.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/add-ons/turbocalc.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -72,7 +72,7 @@
 
 
 long PUBLIC
-load(reg (d0) BPTR dat,reg (a0) struct Mappe *mp)
+load(REG(d0, BPTR dat), REG(a0, struct Mappe *mp))
 {
 	struct Cell *c;
 	struct Page *page;
@@ -322,7 +322,7 @@
 
 
 long PUBLIC
-save(reg (d0) BPTR dat,reg (a0) struct Mappe *mp)
+save(REG(d0, BPTR dat), REG(a0, struct Mappe *mp))
 {
 	return RETURN_WARN;
 }
@@ -335,7 +335,7 @@
 
 
 void PUBLIC
-openPrefsGUI(reg (a0) struct Screen *scr)
+openPrefsGUI(REG(a0, struct Screen *scr))
 {
 }
 
@@ -348,7 +348,7 @@
 
 
 long PUBLIC
-setPrefs(reg (a0) STRPTR t)
+setPrefs(REG(a0, STRPTR t))
 {
 	return TRUE;
 }

Modified: trunk/diagram.c
===================================================================
--- trunk/diagram.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/diagram.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -861,8 +861,8 @@
 
 
 void PUBLIC
-gDiagram3dDraw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *rp, reg (a1) struct gClass *gc,
-	reg (a2) struct gDiagram3d *gd, reg (a3) struct gBounds *gb)
+gDiagram3dDraw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *rp), REG(a1, struct gClass *gc),
+	REG(a2, struct gDiagram3d *gd), REG(a3, struct gBounds *gb))
 {
 	LONG x = gb->gb_Left,y = gb->gb_Top;
 	LONG w = gb->gb_Right-gb->gb_Left;
@@ -1033,8 +1033,8 @@
 
 
 void PUBLIC
-gBalken3dDraw(reg (d0) struct Page *page, reg (d1) ULONG dpi, reg (a0) struct RastPort *rp, reg (a1) struct gClass *gc,
-	reg (a2) struct gDiagram3d *gd, reg (a3) struct gBounds *gb)
+gBalken3dDraw(REG(d0, struct Page *page), REG(d1, ULONG dpi), REG(a0, struct RastPort *rp), REG(a1, struct gClass *gc),
+	REG(a2, struct gDiagram3d *gd), REG(a3, struct gBounds *gb))
 {
 	//struct point3d rectps[] = {{0.0,0.0,0.0},{6.0,0.0,0.0},{6.0,0.0,2.0}};
 	struct point3d boxps[] = {{0.3,3.0,0.5},{0.3,0.0,0.5},{1.3,0.0,0.5},{0.3,0.0,1.5}};

Modified: trunk/font.c
===================================================================
--- trunk/font.c	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/font.c	2008-12-16 19:05:58 UTC (rev 17)
@@ -279,7 +279,7 @@
 
 #if 0
 void PUBLIC
-DrawTextWithWidth(reg (a0) struct RastPort *rp,reg (a1) struct FontInfo *fi,reg (a2) STRPTR t,reg (d0) long x,reg (d1) long y,reg (d2) long width)
+DrawTextWithWidth(REG(a0, struct RastPort *rp), REG(a1, struct FontInfo *fi), REG(a2, STRPTR t), REG(d0, long x), REG(d1, long y), REG(d2, long width))
 {
 	struct FontSize *fs;
 	struct FontChar *fc;

Modified: trunk/libs/gtdrag/include/libraries/gtdrag.h
===================================================================
--- trunk/libs/gtdrag/include/libraries/gtdrag.h	2008-12-15 19:19:35 UTC (rev 16)
+++ trunk/libs/gtdrag/include/libraries/gtdrag.h	2008-12-16 19:05:58 UTC (rev 17)
@@ -19,11 +19,6 @@
 #endif
 
 
-#ifndef reg
-#define reg(x) register __ ## x
-#endif
-
-
 /********************* ObjectDescription structure *********************/
 
 /* the ObjectDescription structure describes the contents of the object



From marust at mail.berlios.de  Tue Dec 16 23:19:17 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Tue, 16 Dec 2008 23:19:17 +0100
Subject: [Ignition-commits] r18 - trunk/add-ons
Message-ID: <200812162219.mBGMJH4t032465@sheep.berlios.de>

Author: marust
Date: 2008-12-16 23:19:05 +0100 (Tue, 16 Dec 2008)
New Revision: 18
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=18&view=rev

Added:
   trunk/add-ons/mmakefile.src
Modified:
   trunk/add-ons/area_diagram.c
   trunk/add-ons/ascii.c
   trunk/add-ons/button.c
   trunk/add-ons/checkbox.c
   trunk/add-ons/circle_diagram.c
   trunk/add-ons/column_diagram.c
   trunk/add-ons/csv.c
   trunk/add-ons/frame.c
   trunk/add-ons/gclass.c
   trunk/add-ons/gclass.h
   trunk/add-ons/gclass_protos.h
   trunk/add-ons/gradient.c
   trunk/add-ons/iotype.c
   trunk/add-ons/iotype.h
   trunk/add-ons/line.c
   trunk/add-ons/line_diagram.c
   trunk/add-ons/rectangle.c
   trunk/add-ons/text.c
   trunk/add-ons/turbocalc.c
Log:
* Attempt to build the add-ons for AROS
  They are almost compiling, but no linking, because
  of the missing Ignition functions.



Modified: trunk/add-ons/area_diagram.c
===================================================================
--- trunk/add-ons/area_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/area_diagram.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -9,8 +9,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
@@ -32,7 +35,7 @@
 struct gInterface interface[] = {
 	{GAA_Frame,	NULL /*"Fl?che durch einen Rahmen begrenzen"*/, GIT_CHECKBOX, NULL, NULL},
 	{GAA_Pseudo3D, NULL /*"Pseudo-3D"*/, GIT_CHECKBOX, NULL, NULL},
-	{NULL}
+	{0}
 };
 
 const STRPTR superClass = "axes";
@@ -195,7 +198,7 @@
 	if (tstate == NULL)
 		return GCPR_NONE;
 
-	while (ti = NextTagItem(&tstate)) {
+	while ((ti = NextTagItem(&tstate)) != 0) {
 		switch (ti->ti_Tag) {
 			case GAA_Frame:
 				if (ga->ga_Frame != ti->ti_Data) {
@@ -211,7 +214,7 @@
 
 
 ULONG PUBLIC
-dispatch(REG(a0, struct gClass *gc), REG(a1, struct gDiagram *gd), REG(a2, Msg msg))
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gDiagram *gd), REG(a1, Msg msg))
 {
   struct gArea *ga = GINST_DATA(gc,gd);
   ULONG  rc;
@@ -219,7 +222,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,gd,msg))
+      if ((rc = gDoSuperMethodA(gc, gd, msg)) != 0)
       {
         ga = GINST_DATA(gc,rc);
         ga->ga_Frame = 1;
@@ -248,7 +251,7 @@
     /*case GCM_HITTEST:
       break;*/
     case GCDM_SETLINKATTR:
-      if (rc = gDoSuperMethodA(gc,gd,msg))  // something has changed
+      if ((rc = gDoSuperMethodA(gc, gd, msg)) != 0) // something has changed
       {
         struct gcpSetLinkAttr *gcps = (APTR)msg;
         ULONG  color = gcps->gcps_Color;
@@ -290,4 +293,3 @@
 
 	return TRUE;
 }
-

Modified: trunk/add-ons/ascii.c
===================================================================
--- trunk/add-ons/ascii.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/ascii.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -11,12 +11,7 @@
 
 const STRPTR __version = "$VER: ascii.io 0.1 (5.3.2001)";
 
-#ifdef DEBUG
-	void kprintf(STRPTR,...);
-#	define bug kprintf
-#endif
 
-
 void PUBLIC
 closePrefsGUI(void)
 {
@@ -51,9 +46,9 @@
 	char t[512];
 	ULONG row = 1;
 
-	if (page = NewPage(mp)) {
+	if ((page = NewPage(mp)) != 0) {
 		while (FGets(file, t, 512)) {
-			if (c = NewCell(page,1,row++)) {
+			if ((c = NewCell(page, 1, row++)) != 0) {
 				if (t[strlen(t)-1] == '\n')
 					t[strlen(t)-1] = 0;
 				c->c_Text = AllocString(t);
@@ -89,9 +84,9 @@
 }
 
 
-void __stdargs
+#if defined(__SASC)
+void STDARGS
 _XCEXIT(long a)
 {
 }
-
-
+#endif

Modified: trunk/add-ons/button.c
===================================================================
--- trunk/add-ons/button.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/button.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -7,8 +7,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
@@ -148,7 +151,7 @@
 
   if (tstate)
   {
-    while(ti = NextTagItem(&tstate))
+    while ((ti = NextTagItem(&tstate)) != 0)
     {
       switch(ti->ti_Tag)
       {
@@ -210,7 +213,7 @@
 
 
 ULONG PUBLIC
-dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a2, Msg msg))
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a1, Msg msg))
 {
   struct gButton *gb = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -218,7 +221,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,go,msg))
+      if ((rc = gDoSuperMethodA(gc, go, msg)) != 0)
       {
         go = (struct gObject *)rc;  gb = GINST_DATA(gc,go);
 
@@ -244,7 +247,7 @@
     {
       struct gObject *cgo;
 
-      if (cgo = (struct gObject *)(rc = gDoSuperMethodA(gc,go,msg)))
+      if ((cgo = (struct gObject *)(rc = gDoSuperMethodA(gc, go, msg))) != 0)
       {
         struct gButton *cgb = GINST_DATA(gc,cgo);
 

Modified: trunk/add-ons/checkbox.c
===================================================================
--- trunk/add-ons/checkbox.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/checkbox.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -7,8 +7,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
@@ -31,7 +34,7 @@
 #define GCA_CheckPen  GOA_TagUser + 4
 #define GCA_PlaceText GOA_TagUser + 5
 
-static char *sPlaceTextLabels[3];
+static CONST_STRPTR sPlaceTextLabels[3];
 #define PLACE_TEXT_RIGHT 0
 #define PLACE_TEXT_LEFT 1
 
@@ -47,7 +50,7 @@
 	{GOA_Text,     NULL,GIT_FORMULA,NULL,NULL},
 	{GOA_Command,  NULL,GIT_TEXT,NULL,NULL},
 	{GCA_PlaceText, "Textplazierung:", GIT_CYCLE, &sPlaceTextLabels, "placetext"},
-	{NULL}
+	{0}
 };
 
 const STRPTR superClass = "root";
@@ -168,7 +171,7 @@
 
   if (tstate)
   {
-    while(ti = NextTagItem(&tstate))
+    while ((ti = NextTagItem(&tstate)) != 0)
     {
       switch(ti->ti_Tag)
       {
@@ -242,7 +245,7 @@
 }
 
 
-ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a1, Msg msg))
 {
   struct Checkbox *cb = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -250,7 +253,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,go,msg))
+      if ((rc = gDoSuperMethodA(gc, go, msg)) != 0)
       {
         go = (struct gObject *)rc;  cb = GINST_DATA(gc,go);
 
@@ -274,7 +277,7 @@
     {
       struct gObject *cgo;
 
-      if (cgo = (struct gObject *)(rc = gDoSuperMethodA(gc,go,msg)))
+      if ((cgo = (struct gObject *)(rc = gDoSuperMethodA(gc, go, msg))) != 0)
       {
         struct Checkbox *ccb = GINST_DATA(gc,cgo);
 

Modified: trunk/add-ons/circle_diagram.c
===================================================================
--- trunk/add-ons/circle_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/circle_diagram.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -9,8 +9,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined (__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
@@ -41,7 +44,7 @@
 	{GCA_Frame, NULL /*"Fl???che durch einen Rahmen begrenzen"*/, GIT_CHECKBOX, NULL, NULL},
 	{GCA_Pseudo3D, NULL /*"Pseudo-3D"*/, GIT_CHECKBOX, NULL, NULL},
 	{GCA_StartAngle, NULL /*"Pseudo-3D"*/, GIT_TEXT, NULL, NULL},
-	{NULL}
+	{0}
 };
 
 const STRPTR superClass = "diagram";
@@ -205,7 +208,7 @@
     if (tstate == NULL)
         return GCPR_NONE;
 
-	while (ti = NextTagItem(&tstate)) {
+	while ((ti = NextTagItem(&tstate)) != 0) {
 		switch (ti->ti_Tag) {
             case GCA_Frame:
 				if (gc->gc_Frame != ti->ti_Data) {
@@ -231,14 +234,14 @@
 
 
 ULONG PUBLIC
-dispatch(REG(a0, struct gClass *gc), REG(a1, struct gDiagram *gd), REG(a2, Msg msg))
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gDiagram *gd), REG(a1, Msg msg))
 {
     struct gCircle *this_gc = GINST_DATA(gc, gd);
     ULONG  rc;
 
 	switch (msg->MethodID) {
         case GCM_NEW:
-			if (rc = gDoSuperMethodA(gc, gd, msg)) {
+			if ((rc = gDoSuperMethodA(gc, gd, msg)) != 0) {
                 this_gc = GINST_DATA(gc, rc);
                 this_gc->gc_Frame = 1;
 
@@ -297,8 +300,9 @@
 	return TRUE;
 }
 
-
-void __stdargs
+#if defined(__SASC)
+void STDARGS
 _XCEXIT(void)
 {
 }
+#endif

Modified: trunk/add-ons/column_diagram.c
===================================================================
--- trunk/add-ons/column_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/column_diagram.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -9,8 +9,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
@@ -34,7 +37,7 @@
 {
 	{GBA_Frame, NULL /*"Fl?che durch einen Rahmen begrenzen"*/, GIT_CHECKBOX, NULL, NULL},
 	{GAA_Pseudo3D, NULL /*"Pseudo-3D"*/, GIT_CHECKBOX, NULL, NULL},
-	{NULL}
+	{0}
 };
 
 const STRPTR superClass = "axes";
@@ -194,7 +197,7 @@
 		return GCPR_NONE;
 
 
-	while (ti = NextTagItem(&tstate))
+	while ((ti = NextTagItem(&tstate)) != 0)
 	{
 		switch(ti->ti_Tag)
 		{
@@ -220,7 +223,7 @@
   switch (msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,gd,msg))
+      if ((rc = gDoSuperMethodA(gc, gd, msg)) != 0)
       {
         gb = GINST_DATA(gc,rc);
         gb->gb_Frame = 1;

Modified: trunk/add-ons/csv.c
===================================================================
--- trunk/add-ons/csv.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/csv.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -74,7 +74,7 @@
   if (!t)
     return(TRUE);
 
-  if (s = strchr(t,'&'))
+  if ((s = strchr(t,'&')) != 0)
   {
     if (*(s+1) == '&')  // ?berschreiben eines Strings der uns nicht geh?rt
       s++;
@@ -157,7 +157,7 @@
   else
     sep = loadprefs;
 
-  if (page = NewPage(mp))
+  if ((page = NewPage(mp)) != 0)
   {
     long col = 1,row = 1,i;
     char *a;
@@ -176,7 +176,7 @@
         col++;
         continue;
       }
-      if (c = NewCell(page,col,row))
+      if ((c = NewCell(page, col, row)) != 0)
       {
         a = s;
         if (*s == '"')   // cell contains special characters
@@ -187,7 +187,7 @@
           for(i = 0;!(*s == '"' && *(s+1) != '"');s++,i++)
             if (*s == '"')
               s++;
-          if (c->c_Text = b = AllocPooled(pool,i+1))
+          if ((c->c_Text = b = AllocPooled(pool, i+1)) != 0)
           {
             s = a;
             for(;!(*s == '"' && *(s+1) != '"');)
@@ -266,8 +266,8 @@
 }
 
 
-void __stdargs _XCEXIT(long a)
+#if defined(__SASC)
+void STDARGS _XCEXIT(long a)
 {
 }
-
-
+#endif

Modified: trunk/add-ons/frame.c
===================================================================
--- trunk/add-ons/frame.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/frame.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -7,17 +7,17 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
 #include <string.h>
 
 
-extern void kprintf(STRPTR,...);
-#define bug kprintf
-
 const char *version = "$VER: frame.gc 0.3 (7.8.2003)";
 
 #define BORDER_SIZE 1536
@@ -41,7 +41,7 @@
 	{GFA_ShadowPen, NULL /*"Dunkle Kanten:"*/, GIT_PEN, NULL, "darkpen"},
 	{GFA_Recessed, NULL /*"Eingedr?ckt:"*/, GIT_CHECKBOX, NULL, "recessed"},
 	{GFA_Doubled,  NULL /*"Doppelter Rahmen:"*/, GIT_CHECKBOX, NULL, "doubled"},
-	{NULL}
+	{0}
 };
 			
 const STRPTR superClass = "root";
@@ -143,7 +143,7 @@
 
   if (tstate)
   {
-    while(ti = NextTagItem(&tstate))
+    while ((ti = NextTagItem(&tstate)) != 0)
     {
       switch(ti->ti_Tag)
       {
@@ -190,7 +190,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,go,msg))
+      if ((rc = gDoSuperMethodA(gc, go, msg)) != 0)
       {
         go = (struct gObject *)rc;  f = GINST_DATA(gc,go);
 

Modified: trunk/add-ons/gclass.c
===================================================================
--- trunk/add-ons/gclass.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/gclass.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -11,6 +11,7 @@
 #include <exec/memory.h>
 #include <dos/dos.h>
 #include <libraries/gtdrag.h>
+#include <libraries/iffparse.h>
 
 #include <clib/exec_protos.h>
 #include <clib/dos_protos.h>
@@ -31,7 +32,7 @@
 	ULONG  gc_Flags;
 	struct gInterface *gc_Interface;
 	BPTR   gc_Segment;
-	ULONG  ASM (*gc_Dispatch)(REG(a0, struct gClass *), REG(a1, APTR), REG(a2, Msg));
+	ULONG  ASM (*gc_Dispatch)(REG(a0, struct gClass *), REG(a2, APTR), REG(a1, Msg));
 	ULONG  ASM (*gc_Draw)(REG(d0, struct Page *), REG(d1, ULONG), REG(a0, struct RastPort *), REG(a1, struct gClass *), REG(a2, struct gObject *), REG(a3, struct gBounds *));
 	ULONG  ASM (*gc_FreeClass)(REG(a0, struct gClass *));
 	STRPTR gc_ClassName;        /* internal access (filename) */
@@ -39,15 +40,16 @@
 
 struct ExecBase *SysBase;
 struct GfxBase *GfxBase;
-struct Library *UtilityBase, *LocaleBase;
+struct UtilityBase *UtilityBase;
+struct LocaleBase *LocaleBase;
 struct Library *MathIeeeDoubBasBase, *MathIeeeDoubTransBase;
 APTR   pool, gcBase;
 
 
 /* Module functions */
 
-extern ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, APTR obj), REG(a2, Msg msg));
-extern ULONG PUBLIC draw(REG(d0, struct Page *), REG(d0, ULONG), REG(a0) struct RastPort *), REG(a1, struct gClass *), REG(a2, struct gObject *), REG(a3, struct gBounds *));
+extern ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a2, APTR obj), REG(a1, Msg msg));
+extern ULONG PUBLIC draw(REG(d0, struct Page *), REG(d0, ULONG), REG(a0, struct RastPort *), REG(a1, struct gClass *), REG(a2, struct gObject *), REG(a3, struct gBounds *));
 extern ULONG PUBLIC freeClass(REG(a0, struct gClass *gc));
 extern ULONG PUBLIC initClass(REG(a0, struct gClass *gc));
 extern struct gInterface interface[];
@@ -89,4 +91,3 @@
 
 	return TRUE;
 }
-

Modified: trunk/add-ons/gclass.h
===================================================================
--- trunk/add-ons/gclass.h	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/gclass.h	2008-12-16 22:19:05 UTC (rev 18)
@@ -37,11 +37,13 @@
   ULONG  gc_InstSize;
   ULONG  gc_Flags;
   struct gInterface *gc_Interface;
-/*  BPTR   gc_Segment;
+#if 0
+  BPTR   gc_Segment;
   ULONG  ASM (*gc_Dispatch)(REG(a0, struct gClass *), REG(a2, APTR), REG(a1, Msg));
   ULONG  ASM (*gc_Draw)(REG(a0, struct Page *), REG(a1, struct gObject *), REG(a2, struct RastPort *), REG(d0, long), REG(d1, long));
   ULONG  (*gc_FreeClass)(void);
-  STRPTR gc_ClassName;        /* interner Zugriff (Dateiname) */*/
+  STRPTR gc_ClassName;        /* interner Zugriff (Dateiname) */
+#endif
 };
 
 #define GINST_DATA(gc,go) (APTR)((UBYTE *)(go)+((struct gClass *)gc)->gc_InstOffset)
@@ -135,7 +137,7 @@
 struct gInterface
 {
   ULONG  gi_Tag;         /* eigener oder vordefinierter Tag f?r GCM_SET/GCM_GET */
-  STRPTR gi_Label;       /* Bezeichner beim Gadget */
+  CONST_STRPTR gi_Label; /* Bezeichner beim Gadget */
   ULONG  gi_Type;        /* Typ des Gadgets (Checkbox, Cycle, String, ...) */
   APTR   gi_Special;     /* z.B. Auswahl bei Cycle-Gadgets */
   STRPTR gi_Name;        /* f?r REXX/Funktions-Interface */

Modified: trunk/add-ons/gclass_protos.h
===================================================================
--- trunk/add-ons/gclass_protos.h	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/gclass_protos.h	2008-12-16 22:19:05 UTC (rev 18)
@@ -14,6 +14,8 @@
 #include <exec/types.h>
 #endif
 
+struct TablePos;
+
 /**/
 /* memory */
 /**/

Modified: trunk/add-ons/gradient.c
===================================================================
--- trunk/add-ons/gradient.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/gradient.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -7,8 +7,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
@@ -28,7 +31,7 @@
 #define GGA_Direction   (GOA_TagUser + 3)
 
 static struct Catalog *sCatalog;
-static char *sAlignmentLabels[3];
+static CONST_STRPTR sAlignmentLabels[3];
 
 struct gInterface interface[] = {
 	{GGA_FirstPen,    NULL /*"First Colour:"*/, GIT_PEN, NULL, "firstpen"},
@@ -95,7 +98,7 @@
     if (!tstate)
         return GCPR_NONE;
 
-    while (ti = NextTagItem(&tstate))
+    while ((ti = NextTagItem(&tstate)) != 0)
     {
         switch (ti->ti_Tag)
         {
@@ -128,7 +131,7 @@
 
 
 ULONG PUBLIC
-dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a2, Msg msg))
+dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a1, Msg msg))
 {
     struct Gradient *g = GINST_DATA(gc, go);
     ULONG rc = 0L;
@@ -136,7 +139,7 @@
     switch (msg->MethodID)
     {
         case GCM_NEW:
-            if (rc = gDoSuperMethodA(gc, go, msg))
+            if ((rc = gDoSuperMethodA(gc, go, msg)) != 0)
             {
                 go = (struct gObject *)rc;  g = GINST_DATA(gc, go);
 
@@ -201,9 +204,9 @@
 
 /** this file is linked without startup code (SAS/C specific) */
 
-void __stdargs
+#if defined(__SASC)
+void STDARGS
 _XCEXIT(void)
 {
 }
-
-
+#endif

Modified: trunk/add-ons/iotype.c
===================================================================
--- trunk/add-ons/iotype.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/iotype.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -4,23 +4,31 @@
  * Licensed under the terms of the MIT License.
  */
 
+#define __DOS_STDLIBBASE__
 
 #include <exec/types.h>
 #include <exec/lists.h>
 #include <exec/nodes.h>
 #include <exec/memory.h>
 #include <dos/dos.h>
+#include <intuition/screens.h>
 
-#include <clib/exec_protos.h>
-#include <clib/dos_protos.h>
-#include <pragmas/exec_pragmas.h>
-#include <pragmas/dos_pragmas.h>
+#include <proto/exec.h>
+#include <proto/dos.h>
 
+#if defined(__SASC)
+#	include <pragmas/exec_pragmas.h>
+#	include <pragmas/dos_pragmas.h>
+#endif
+
 #include <string.h>
 #include <math.h>
 /*#include <mieeedoub.h>*/
 
+struct Mappe;
 
+#include "SDI_compiler.h"
+
 // Must always be in sync with the definition in io.h !!!
 
 struct IOType {
@@ -37,7 +45,7 @@
   long   ASM (*io_Save)(REG(d0, BPTR), REG(a0, struct Mappe *));
   long   ASM (*io_SetPrefs)(REG(a0, STRPTR));
   STRPTR ASM (*io_GetPrefs)(void);
-  void   ASM (*io_OpenPrefsGUI)(REG(a0) struct Screen *);
+  void   ASM (*io_OpenPrefsGUI)(REG(a0, struct Screen *));
   void   ASM (*io_ClosePrefsGUI)(void);
   STRPTR io_Short;
   STRPTR io_Prefs;

Modified: trunk/add-ons/iotype.h
===================================================================
--- trunk/add-ons/iotype.h	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/iotype.h	2008-12-16 22:19:05 UTC (rev 18)
@@ -9,28 +9,35 @@
 ** All Rights Reserved
 */
 
+#include "SDI_compiler.h"
+
+#define __DOS_STDLIBBASE__
+
 #include <exec/types.h>
 #include <exec/lists.h>
 #include <exec/nodes.h>
 #include <exec/memory.h>
 #include <dos/dos.h>
+#include <intuition/screens.h>
 
-#include <clib/exec_protos.h>
-#include <clib/dos_protos.h>
-#include <clib/alib_stdio_protos.h>
-#include <pragmas/exec_pragmas.h>
-#include <pragmas/dos_pragmas.h>
+#include <proto/exec.h>
+#include <proto/dos.h>
 
+#if defined(__SASC)
+#	include <clib/alib_stdio_protos.h>
+#	include <pragmas/exec_pragmas.h>
+#	include <pragmas/dos_pragmas.h>
+#endif
+
 #include <string.h>
 #include <math.h>
 
 #define foreach(l,v) for(v = (APTR)((struct List *)l)->lh_Head;((struct Node *)v)->ln_Succ;v = (APTR)((struct Node *)v)->ln_Succ)
 
 #ifndef CELL_H
-#include "cell.h"
+#	include "cell.h"
 #endif
 
-#include "SDI_compiler.h"
 
 /*** Project related ***/
 
@@ -436,22 +443,24 @@
 void   FreeString(STRPTR);
 STRPTR ita(double d,long komma ,UBYTE flags);
 
-#pragma tagcall ioBase Error 5a 9802
-#pragma libcall ioBase ErrorA 5a 9802
-#pragma libcall ioBase NewPage 54 801
-#pragma libcall ioBase CalculatePageDPI 4e 801
-#pragma libcall ioBase NewCell 48 10803
-#pragma libcall ioBase UpdateCellText 42 9802
-#pragma libcall ioBase SetTableSize 3c 10803
-#pragma libcall ioBase FindColorPen 36 21003
-#pragma libcall ioBase AddPen 30 210804
-#pragma libcall ioBase Coord2String 2a 321004
-#pragma libcall ioBase pixel 24 10803
-#pragma libcall ioBase mm 1e 10803
-#pragma libcall ioBase AllocStringLength 18 0802
-#pragma libcall ioBase AllocString 12 801
-#pragma libcall ioBase FreeString c 801
-#pragma libcall ioBase ita 6 32003
+#if defined(__SASC)
+#	pragma tagcall ioBase Error 5a 9802
+#	pragma libcall ioBase ErrorA 5a 9802
+#	pragma libcall ioBase NewPage 54 801
+#	pragma libcall ioBase CalculatePageDPI 4e 801
+#	pragma libcall ioBase NewCell 48 10803
+#	pragma libcall ioBase UpdateCellText 42 9802
+#	pragma libcall ioBase SetTableSize 3c 10803
+#	pragma libcall ioBase FindColorPen 36 21003
+#	pragma libcall ioBase AddPen 30 210804
+#	pragma libcall ioBase Coord2String 2a 321004
+#	pragma libcall ioBase pixel 24 10803
+#	pragma libcall ioBase mm 1e 10803
+#	pragma libcall ioBase AllocStringLength 18 0802
+#	pragma libcall ioBase AllocString 12 801
+#	pragma libcall ioBase FreeString c 801
+#	pragma libcall ioBase ita 6 32003
+#endif
 
 /********************************* Variables ************************************/
 

Modified: trunk/add-ons/line.c
===================================================================
--- trunk/add-ons/line.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/line.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -8,9 +8,12 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
 
+
 const char *version = "$VER: line.gc 0.12 (2.3.2003)";
 
 
@@ -114,7 +117,7 @@
 }
 
 
-ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a1, Msg msg))
 {
   struct gLine *gl = GINST_DATA(gc,go);
   ULONG  rc = 0L;

Modified: trunk/add-ons/line_diagram.c
===================================================================
--- trunk/add-ons/line_diagram.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/line_diagram.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -9,13 +9,17 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 #define CATCOMP_NUMBERS
 #include "ignition_strings.h"
 
 #include <string.h>
 
+struct gArea;
 
 const char *version = "$VER: line_diagram.gc 0.3 (7.8.2003)";
 
@@ -33,7 +37,7 @@
 struct gInterface interface[] = {
 //  {GAA_Frame,"Fl?che durch einen Rahmen begrenzen",GIT_CHECKBOX,NULL,NULL},
 	{GAA_Pseudo3D,"Pseudo-3D",GIT_CHECKBOX,NULL,NULL},
-	{NULL,     NULL,NULL,NULL,NULL}
+	{0,           NULL,0,NULL,NULL}
 };
 
 const STRPTR superClass = "diagram";
@@ -169,7 +173,7 @@
 }
 
 
-ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gDiagram *gd), REG(a2, Msg msg))
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a2, struct gDiagram *gd), REG(a1, Msg msg))
 {
 //  struct gLine *gl = GINST_DATA(gc,gd);
   ULONG  rc;
@@ -177,7 +181,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,gd,msg))
+      if ((rc = gDoSuperMethodA(gc, gd, msg)) != 0)
       {
         set((struct gDiagram *)rc,NULL /*ga*/,((struct gcpSet *)msg)->gcps_AttrList);
       }
@@ -198,7 +202,7 @@
       }
       break;
     case GCDM_SETLINKATTR:
-      if (rc = gDoSuperMethodA(gc,gd,msg))  // something has changed
+      if ((rc = gDoSuperMethodA(gc, gd, msg)) != 0) // something has changed
       {
         struct gcpSetLinkAttr *gcps = (APTR)msg;
         ULONG  color = gcps->gcps_Color;

Added: trunk/add-ons/mmakefile.src
===================================================================
--- trunk/add-ons/mmakefile.src	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/mmakefile.src	2008-12-16 22:19:05 UTC (rev 18)
@@ -0,0 +1,99 @@
+#
+# meta-makefile for Ignition for AROS
+#
+
+include $(TOP)/config/make.cfg
+
+#MM- contrib-ignition-addons : contrib-ignition-addon-turbocalc
+
+#MM  contrib-ignition-addon-area_diagram : includes linklibs
+#MM  contrib-ignition-addon-button : includes linklibs
+#MM  contrib-ignition-addon-checkbox : includes linklibs
+#MM  contrib-ignition-addon-circle_diagram : includes linklibs
+#MM  contrib-ignition-addon-column_diagram : includes linklibs
+#MM  contrib-ignition-addon-frame : includes linklibs
+#MM  contrib-ignition-addon-gradient : includes linklibs
+#MM  contrib-ignition-addon-line : includes linklibs
+#MM  contrib-ignition-addon-line_diagram : includes linklibs
+#MM  contrib-ignition-addon-rectangle : includes linklibs
+#MM  contrib-ignition-addon-text : includes linklibs
+
+#MM  contrib-ignition-addon-ascii : includes linklibs
+#MM  contrib-ignition-addon-csv : includes linklibs
+#MM  contrib-ignition-addon-turbocalc : includes linklibs
+
+TARGETDIR := $(AROS_CONTRIB)/Office/Ingition/add-ons
+USER_INCLUDES := -I../libs/include -I..
+
+
+#### gclass
+
+%build_module_simple mmake=contrib-ignition-addon-area_diagram \
+	modname=area_diagramm modtype=gc \
+	files="gclass area_diagram" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-button \
+	modname=button modtype=gc \
+	files="gclass button" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-checkbox \
+	modname=checkbox modtype=gc \
+	files="gclass checkbox" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-circle_diagram \
+	modname=circle_diagram modtype=gc \
+	files="gclass circle_diagram" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-column_diagram \
+	modname=column_diagram modtype=gc \
+	files="gclass column_diagram" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-frame \
+	modname=frame modtype=gc \
+	files="gclass frame" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-gradient \
+	modname=gradient modtype=gc \
+	files="gclass gradient" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-line \
+	modname=line modtype=gc \
+	files="gclass gradient" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-rectangle \
+	modname=rectangle modtype=gc \
+	files="gclass rectangle" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-text \
+	modname=text modtype=gc \
+	files="gclass text" moduledir=$(TARGETDIR) \
+	uselibs=
+
+
+#### iotype
+
+%build_module_simple mmake=contrib-ignition-addon-ascii \
+	modname=text modtype=io \
+	files="iotype ascii" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-csv \
+	modname=csv modtype=io \
+	files="iotype csv" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%build_module_simple mmake=contrib-ignition-addon-turbocalc \
+	modname=turbocalc modtype=io \
+	files="iotype turbocalc" moduledir=$(TARGETDIR) \
+	uselibs=
+
+%common


Property changes on: trunk/add-ons/mmakefile.src
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native

Modified: trunk/add-ons/rectangle.c
===================================================================
--- trunk/add-ons/rectangle.c	2008-12-16 19:05:58 UTC (rev 17)
+++ trunk/add-ons/rectangle.c	2008-12-16 22:19:05 UTC (rev 18)
@@ -7,8 +7,11 @@
 
 #include "gclass.h"
 #include "gclass_protos.h"
-#include "gclass_pragmas.h"
 
+#if defined(__SASC)
+#	include "gclass_pragmas.h"
+#endif
+
 const char *version = "$VER: rectangle.gc 0.6 (2.3.2003)";
 
 struct Rect
@@ -21,7 +24,7 @@
   {GOA_FillPen,    NULL,GIT_PEN,NULL,NULL},
   {GOA_OutlinePen, NULL,GIT_PEN,NULL,NULL},
 //  {GOA_Weight,     NULL,GIT_WEIGHT,NULL,NULL},
-  {NULL,           NULL,NULL,NULL,NULL}
+  {0,              NULL,0,NULL,NULL}
 };
 
 const STRPTR superClass = "root";
@@ -65,7 +68,7 @@
 
   if (tstate)
   {
-    while(ti = NextTagItem(&tstate))
+    while ((ti = NextTagItem(&tstate)) != 0)
     {
       switch(ti->ti_Tag)
       {
@@ -97,7 +100,7 @@
 }
 
 
-ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a1, struct gObject *go), REG(a2, Msg msg))
+ULONG PUBLIC dispatch(REG(a0, struct gClass *gc), REG(a2, struct gObject *go), REG(a1, Msg msg))
 {
   struct Rect *r = GINST_DATA(gc,go);
   ULONG rc = 0L;
@@ -105,7 +108,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:

[... truncated: 138 lines follow ...]


From marust at mail.berlios.de  Wed Dec 17 00:11:40 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Wed, 17 Dec 2008 00:11:40 +0100
Subject: [Ignition-commits] r19 - trunk/add-ons
Message-ID: <200812162311.mBGNBeGn010196@sheep.berlios.de>

Author: marust
Date: 2008-12-17 00:11:38 +0100 (Wed, 17 Dec 2008)
New Revision: 19
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=19&view=rev

Modified:
   trunk/add-ons/csv.c
   trunk/add-ons/iotype.h
   trunk/add-ons/turbocalc.c
Log:
* Renamed Error() to ReportError() because dos.library has
  already an Error() function with a different purpose.
* Compiler warning removed.


Modified: trunk/add-ons/csv.c
===================================================================
--- trunk/add-ons/csv.c	2008-12-16 22:19:05 UTC (rev 18)
+++ trunk/add-ons/csv.c	2008-12-16 23:11:38 UTC (rev 19)
@@ -11,10 +11,6 @@
 
 const STRPTR __version = "$VER: csv.io 0.7 (4.3.2001)";
 
-#ifdef DEBUG
-  void kprintf(STRPTR,...);
-# define bug kprintf
-#endif
 
 #define PREFS_GUESS -1L
 #define PREFS_ASK -2L
@@ -102,7 +98,7 @@
     *s = '&';
 
   if (!ok)
-    Error("Fehlerhafte Voreinstellungen.");
+    ReportError("Fehlerhafte Voreinstellungen.");
 
   return(TRUE);
 }
@@ -129,7 +125,7 @@
       return(RETURN_FAIL);
   }
   if (FRead(file,buffer,1,size) != size)
-    Error("Fehler beim Lesen der Datei.");
+    ReportError("Fehler beim Lesen der Datei.");
 
   if (loadprefs == PREFS_GUESS)
   {
@@ -148,11 +144,11 @@
     j = count[0] > count[1] ? 0 : 1;
     k = count[2] > count[3] ? 2 : 3;
     sep = count[j] > count[k] ? separator[j] : separator[k];
-    //Error("Trenner: %d.",count[j] > count);
+    //ReportError("Trenner: %d.",count[j] > count);
   }
   else if (loadprefs == PREFS_ASK)
   {
-    Error("Not yet implemented.");
+    ReportError("Not yet implemented.");
   }
   else
     sep = loadprefs;

Modified: trunk/add-ons/iotype.h
===================================================================
--- trunk/add-ons/iotype.h	2008-12-16 22:19:05 UTC (rev 18)
+++ trunk/add-ons/iotype.h	2008-12-16 23:11:38 UTC (rev 19)
@@ -426,8 +426,8 @@
 
 /***************************** interne Funktionen *******************************/
 
-void   Error(STRPTR fmt,...);
-void   ErrorA(STRPTR fmt,APTR args);
+void   ReportError(STRPTR fmt,...);
+void   ReportErrorA(STRPTR fmt,APTR args);
 struct Page *NewPage(struct Mappe *mp);
 void   CalculatePageDPI(struct Page *page);
 struct Cell *NewCell(struct Page *page,LONG col,LONG row);
@@ -444,8 +444,8 @@
 STRPTR ita(double d,long komma ,UBYTE flags);
 
 #if defined(__SASC)
-#	pragma tagcall ioBase Error 5a 9802
-#	pragma libcall ioBase ErrorA 5a 9802
+#	pragma tagcall ioBase ReportError 5a 9802
+#	pragma libcall ioBase ReportErrorA 5a 9802
 #	pragma libcall ioBase NewPage 54 801
 #	pragma libcall ioBase CalculatePageDPI 4e 801
 #	pragma libcall ioBase NewCell 48 10803

Modified: trunk/add-ons/turbocalc.c
===================================================================
--- trunk/add-ons/turbocalc.c	2008-12-16 22:19:05 UTC (rev 18)
+++ trunk/add-ons/turbocalc.c	2008-12-16 23:11:38 UTC (rev 19)
@@ -132,7 +132,7 @@
 						col = *(UWORD *)cell, row = *(UWORD *)(cell+2), cell += 4;
 					else
 						col = *(ULONG *)cell, row = *(ULONG *)(cell+4), cell += 8;
-					if (c = NewCell(page,col+1,row+1))
+					if ((c = NewCell(page, col + 1,row + 1)) != 0)
 					{
 						b = *cell++;
 						if (b == TCT_TEXT)



From marust at mail.berlios.de  Wed Dec 17 22:50:51 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Wed, 17 Dec 2008 22:50:51 +0100
Subject: [Ignition-commits] r20 - in trunk: . add-ons libs/include
Message-ID: <200812172150.mBHLopLH024783@sheep.berlios.de>

Author: marust
Date: 2008-12-17 22:50:42 +0100 (Wed, 17 Dec 2008)
New Revision: 20
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=20&view=rev

Modified:
   trunk/add-ons/button.c
   trunk/add-ons/gclass.c
   trunk/add-ons/iotype.c
   trunk/add-ons/line.c
   trunk/add-ons/mmakefile.src
   trunk/add-ons/turbocalc.c
   trunk/classes.c
   trunk/io.c
   trunk/libs/include/SDI_compiler.h
   trunk/mmakefile.src
Log:
* Unification of the argument order of the add-on initialisation functions

* Use MKBADDR for a platform independent conversion from BPTR to APTR

* Forgot to copy the *.iodescr (only the *.gcdescr were copied)

* Copy of some sheets for testing purposes (only a temporary solution)

* Removed "bug" macro from SDI_compiler.h because it's defined in debug.h

* Re-added "bug" and "D" macro to turbocalc.c because it doesn't
  include debug.h

* Some compiler warnings removed


Modified: trunk/add-ons/button.c
===================================================================
--- trunk/add-ons/button.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/add-ons/button.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -39,7 +39,7 @@
 	{GOA_Text,     NULL, GIT_FORMULA, NULL, NULL},
 	{GOA_Command,  NULL, GIT_TEXT, NULL, NULL},
 	{GOA_ContinualCommand, NULL, GIT_CHECKBOX, NULL, NULL},
-	{NULL}
+	{0}
 };
 
 const STRPTR superClass = "root";

Modified: trunk/add-ons/gclass.c
===================================================================
--- trunk/add-ons/gclass.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/add-ons/gclass.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -58,8 +58,8 @@
 
 
 BOOL PUBLIC
-InitGClass(REG(a6, struct ExecBase *ExecBase), REG(a0, struct __gClass *gc), REG(a1, APTR table), REG(a2, APTR mainpool),
-	REG(a3, APTR gfxbase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
+InitGClass(REG(a0, struct __gClass *gc), REG(a1, APTR table), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
+	REG(a6, struct ExecBase *ExecBase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
     REG(d4, long magic))
 {
 #ifdef IGNITION_LITE_EDITION

Modified: trunk/add-ons/iotype.c
===================================================================
--- trunk/add-ons/iotype.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/add-ons/iotype.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -81,9 +81,9 @@
 
 
 BOOL PUBLIC
-InitModule(REG(a6, struct ExecBase *execBase), REG(a0, struct IOType *io), REG(a1, APTR table), REG(a2, APTR mainpool),
-	REG(a3, APTR dosBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, long magic),
-	REG(d3, APTR utilityBase), REG(d4, APTR localeBase))
+InitModule(REG(a0, struct IOType *io), REG(a1, APTR table), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
+	REG(a6, struct ExecBase *execBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, APTR utilityBase),
+	REG(d3, APTR localeBase), REG(d4, long magic))
 {
 #ifdef IGNITION_LITE_EDITION
 	if (magic != MAKE_ID('I', 'G', 'N', '\0') && magic != MAKE_ID('I', 'G', 'L', '\0'))

Modified: trunk/add-ons/line.c
===================================================================
--- trunk/add-ons/line.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/add-ons/line.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -78,7 +78,7 @@
 
   if (tstate)
   {
-    while(ti = NextTagItem(&tstate))
+    while ((ti = NextTagItem(&tstate)) != 0)
     {
       switch(ti->ti_Tag)
       {
@@ -125,7 +125,7 @@
   switch(msg->MethodID)
   {
     case GCM_NEW:
-      if (rc = gDoSuperMethodA(gc,go,msg))
+      if ((rc = gDoSuperMethodA(gc,go,msg)) != 0)
       {
         go = (struct gObject *)rc;  gl = GINST_DATA(gc,go);
 

Modified: trunk/add-ons/mmakefile.src
===================================================================
--- trunk/add-ons/mmakefile.src	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/add-ons/mmakefile.src	2008-12-17 21:50:42 UTC (rev 20)
@@ -65,9 +65,14 @@
 
 %build_module_simple mmake=contrib-ignition-addon-line \
 	modname=line modtype=gc \
-	files="gclass gradient" moduledir=$(TARGETDIR) \
+	files="gclass line" moduledir=$(TARGETDIR) \
 	uselibs=
 
+%build_module_simple mmake=contrib-ignition-addon-line_diagram \
+	modname=line_diagram modtype=gc \
+	files="gclass line_diagram" moduledir=$(TARGETDIR) \
+	uselibs=
+
 %build_module_simple mmake=contrib-ignition-addon-rectangle \
 	modname=rectangle modtype=gc \
 	files="gclass rectangle" moduledir=$(TARGETDIR) \

Modified: trunk/add-ons/turbocalc.c
===================================================================
--- trunk/add-ons/turbocalc.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/add-ons/turbocalc.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -14,7 +14,12 @@
 
 const STRPTR __version = "$VER: turbocalc.io 0.2 (4.3.2001)";
 
+/*extern sprintf(STRPTR,STRPTR,...);*/
+extern kprintf(STRPTR,...);
 
+#define bug kprintf
+#define D(x) ;
+
 STRPTR
 MapTCFuncs(UBYTE n)
 {

Modified: trunk/classes.c
===================================================================
--- trunk/classes.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/classes.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -1377,9 +1377,6 @@
 BOOL
 LoadGClass(struct gClass *gc)
 {
-#if defined(__AROS__)
-	return FALSE;
-#else
 	BOOL ASM (*initGCSegment)(REG(a0, APTR), REG(a1, APTR), REG(a2, APTR), REG(a3, APTR), REG(a6, APTR),
 		REG(d0, APTR), REG(d1, APTR), REG(d2, APTR), REG(d3, APTR), REG(d4, long));
 	BPTR dir,olddir,segment;
@@ -1392,7 +1389,7 @@
 		olddir = CurrentDir(dir);
 		if ((segment = LoadSeg(gc->gc_ClassName)) != 0)
 		{
-			initGCSegment = ((segment + 1) << 2);
+			initGCSegment = MKBADDR(segment);
 			if (initGCSegment(gc, (UBYTE *)gClassFuncTable + gClassFuncTableSize, pool, GfxBase, SysBase, MathIeeeDoubBasBase,
 					MathIeeeDoubTransBase, UtilityBase, LocaleBase,
 #ifdef IGNITION_LITE_EDITION
@@ -1421,7 +1418,6 @@
 		return FALSE;
 	}
 	return TRUE;
-#endif
 }
 
 
@@ -1543,5 +1539,3 @@
 
 	gEmbedDiagramInterface[0].gi_Label = GetString(&gLocaleInfo, MSG_DIAGRAM_PREFS_GAD);
 }
-
-

Modified: trunk/io.c
===================================================================
--- trunk/io.c	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/io.c	2008-12-17 21:50:42 UTC (rev 20)
@@ -2439,10 +2439,8 @@
 void
 InitIOType(struct IOType *io)
 {
-#if defined(__AROS__)
-	return;
-#else
-	BOOL * ASM (*initIOSegment)(REG(a0, APTR), REG(a1, APTR *), REG(a2, APTR), REG(a3, APTR), REG(a6, APTR), REG(d0, APTR), REG(d1, APTR), REG(d3, APTR), REG(d4, APTR), REG(d2, long));
+	BOOL * ASM (*initIOSegment)(REG(a0, APTR), REG(a1, APTR *), REG(a2, APTR), REG(a3, APTR), REG(a6, APTR),
+		REG(d0, APTR), REG(d1, APTR), REG(d2, APTR), REG(d3, APTR), REG(d4, long));
 	BPTR dir,olddir,segment;
 
 	if (io->io_Segment || !io->io_Filename)
@@ -2453,7 +2451,7 @@
 		olddir = CurrentDir(dir);
 		if ((segment = LoadSeg(io->io_Filename)) != 0)
 		{
-			initIOSegment = ((segment+1) << 2);
+			initIOSegment = MKBADDR(segment);
 			if (initIOSegment(io, (APTR)((UBYTE *)io_functable + sizeof(io_functable)), pool, DOSBase,
 					SysBase, MathIeeeDoubBasBase, MathIeeeDoubTransBase, UtilityBase, LocaleBase, MAKE_ID('I','G','N',0)))
 				io->io_Segment = segment;
@@ -2465,7 +2463,6 @@
 		CurrentDir(olddir);
 		UnLock(dir);
 	}
-#endif
 }
 
 

Modified: trunk/libs/include/SDI_compiler.h
===================================================================
--- trunk/libs/include/SDI_compiler.h	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/libs/include/SDI_compiler.h	2008-12-17 21:50:42 UTC (rev 20)
@@ -263,8 +263,6 @@
    // TODO write LIB_... macros
 #  define LIBFUNC_INIT
 #  define LIBFUNC_EXIT
-
-#  define bug kprintf
 #endif
 
 #if defined(__AROS__)

Modified: trunk/mmakefile.src
===================================================================
--- trunk/mmakefile.src	2008-12-16 23:11:38 UTC (rev 19)
+++ trunk/mmakefile.src	2008-12-17 21:50:42 UTC (rev 20)
@@ -10,7 +10,7 @@
 
 #MM contrib-ignition-bin : linklibs includes contrib-ignition-textedit \
 #MM contrib-ignition-scroller contrib-ignition-gtdrag contrib-ignition-catalogs \
-#MM contrib-ignition-gcdescr
+#MM contrib-ignition-descr
 
 EXE := Ignition
 
@@ -64,23 +64,23 @@
 	libs/compatibility
 
 %build_prog mmake=contrib-ignition-bin progname=$(EXE) files=$(FILES) \
-    targetdir=$(TARGETDIR) uselibs="amiga arossupport arosc rexxsyslib m"
+    targetdir=$(TARGETDIR) uselibs="amiga arossupport arosc rexxsyslib m mathieeedoubbas mathieeedoubtrans"
 
 %copy_dir_recursive mmake=contrib-ignition-icons src=icons dst=$(TARGETDIR)/icons
 %copy_dir_recursive mmake=contrib-ignition-config src=config dst=$(TARGETDIR)/config
 %copy_dir_recursive mmake=contrib-ignition-docs src=docs dst=$(TARGETDIR)/docs
 %copy_dir_recursive mmake=contrib-ignition-help src=help dst=$(TARGETDIR)/help
 %copy_dir_recursive mmake=contrib-ignition-rexx src=rexx dst=$(TARGETDIR)/rexx
-%copy_dir_recursive mmake=contrib-ignition-sheets src=sheets dst=$(TARGETDIR)/sheets
+%copy_dir_recursive mmake=contrib-ignition-sheets src=distribution/full/sheets dst=$(TARGETDIR)/sheets
 
 #MM
-contrib-ignition-gcdescr :
-FILES := $(wildcard add-ons/*.gcdescr)
-%copy_files_q files=$(FILES) src=. dst=$(TARGETDIR) maketarget=contrib-ignition-gcdescr
+contrib-ignition-descr :
+DESCFILES := $(wildcard add-ons/*.gcdescr) $(wildcard add-ons/*.iodescr)
+%copy_files_q files=$(DESCFILES) src=$(TOP)/$(CURDIR) dst=$(TARGETDIR) maketarget=contrib-ignition-descr
 
 #MM
 contrib-ignition-files :
-FILES := ignition.info LICENSE README
-%copy_files_q files=$(FILES) src=. dst=$(TARGETDIR) maketarget=contrib-ignition-files
+CPYFILES := ignition.info LICENSE README
+%copy_files_q files=$(CPYFILES) src=. dst=$(TARGETDIR) maketarget=contrib-ignition-files
 
 %common



From mrustler at gmx.de  Thu Dec 18 01:37:38 2008
From: mrustler at gmx.de (Matthias Rustler)
Date: Thu, 18 Dec 2008 01:37:38 +0100
Subject: [Ignition-commits] r20 - in trunk: . add-ons libs/include
In-Reply-To: <200812172150.mBHLopLH024783@sheep.berlios.de>
References: <200812172150.mBHLopLH024783@sheep.berlios.de>
Message-ID: <1229560658.11550.13.camel@bellodello>

Am Mittwoch, den 17.12.2008, 22:50 +0100 schrieb marust at mail.berlios.de:
> Author: marust

>  		olddir = CurrentDir(dir);
>  		if ((segment = LoadSeg(gc->gc_ClassName)) != 0)
>  		{
> -			initGCSegment = ((segment + 1) << 2);
> +			initGCSegment = MKBADDR(segment);

This was probably wrong. This +1 means an address 4 bytes obove segment
is called, right? What is at address segment?

Regards,
Matthias




From axeld at pinc-software.de  Thu Dec 18 10:35:36 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Thu, 18 Dec 2008 10:35:36 +0100 CET
Subject: [Ignition-commits] r20 - in trunk: . add-ons libs/include
In-Reply-To: <1229560658.11550.13.camel@bellodello>
Message-ID: <1005028803-BeMail@zon>

Matthias Rustler <mrustler at gmx.de> wrote:
> Am Mittwoch, den 17.12.2008, 22:50 +0100 schrieb 
> marust at mail.berlios.de:
> > Author: marust
> >  		olddir = CurrentDir(dir);
> >  		if ((segment = LoadSeg(gc->gc_ClassName)) != 0)
> >  		{
> > -			initGCSegment = ((segment + 1) << 2);
> > +			initGCSegment = MKBADDR(segment);
> This was probably wrong. This +1 means an address 4 bytes obove 
> segment
> is called, right? What is at address segment?

I think it's been 10 years that I wrote that, and I actually have no 
idea anymore.
Maybe it's some LoadSeg() specific thing, I don't know.
I still wouldn't mind to add an ELF reader to ignition, though, and 
have it use that for platforms that are incapable of doing so but use 
ELF internally (ie. AROS) :-)

Bye,
   Axel.



From marust at mail.berlios.de  Sat Dec 20 14:14:58 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 20 Dec 2008 14:14:58 +0100
Subject: [Ignition-commits] r21 - trunk/distribution/full/sheets
Message-ID: <200812201314.mBKDEw24028885@sheep.berlios.de>

Author: marust
Date: 2008-12-20 14:14:52 +0100 (Sat, 20 Dec 2008)
New Revision: 21
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=21&view=rev

Added:
   trunk/distribution/full/sheets/HeatherNova.igs
   trunk/distribution/full/sheets/HeatherNova.igs.info
Removed:
   trunk/distribution/full/sheets/heather nova.igs
   trunk/distribution/full/sheets/heather nova.igs.info
Log:
* New attempt to rename two files which contain a space.
  (something went wrong with a previous attempt.)


Copied: trunk/distribution/full/sheets/HeatherNova.igs (from rev 20, trunk/distribution/full/sheets/heather nova.igs)

Copied: trunk/distribution/full/sheets/HeatherNova.igs.info (from rev 20, trunk/distribution/full/sheets/heather nova.igs.info)

Deleted: trunk/distribution/full/sheets/heather nova.igs

Deleted: trunk/distribution/full/sheets/heather nova.igs.info



From marust at mail.berlios.de  Sat Dec 20 18:45:27 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sat, 20 Dec 2008 18:45:27 +0100
Subject: [Ignition-commits] r22 - in trunk: . add-ons
Message-ID: <200812201745.mBKHjRuX000615@sheep.berlios.de>

Author: marust
Date: 2008-12-20 18:45:18 +0100 (Sat, 20 Dec 2008)
New Revision: 22
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=22&view=rev

Added:
   trunk/add-ons/gclass_variadic.c
   trunk/add-ons/iotype_variadic.c
Modified:
   trunk/add-ons/gclass.c
   trunk/add-ons/gclass.h
   trunk/add-ons/gclass_protos.h
   trunk/add-ons/iotype.c
   trunk/add-ons/iotype.h
   trunk/add-ons/mmakefile.src
   trunk/classes.c
   trunk/io.c
   trunk/mmakefile.src
Log:
* Made add-ons class loading working on AROS.
  All core functions are implemented as function pointers.
  These pointers are initialized with the function table
  pointer from the core. Only the variadic functions
  are implemented as real functions. I think we can ommit
  the SASC specific implementation of how the add-ons called
  the core functions at all.
* The address of the module initalisation function is obtained
  as adr = MKBADDR(segment) + sizeof(APTR).
  On i386-AROS BPTR is same type as APTR. The first function
  in the segment is the address which follows after the return
  value of LoadSeg().
  


Modified: trunk/add-ons/gclass.c
===================================================================
--- trunk/add-ons/gclass.c	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/gclass.c	2008-12-20 17:45:18 UTC (rev 22)
@@ -1,6 +1,6 @@
 /* gClass base module for ignition
  *
- * Copyright ???1996-2008 pinc Software. All Rights Reserved.
+ * Copyright ?1996-2008 pinc Software. All Rights Reserved.
  * Licensed under the terms of the MIT License.
  */
 
@@ -13,17 +13,22 @@
 #include <libraries/gtdrag.h>
 #include <libraries/iffparse.h>
 
-#include <clib/exec_protos.h>
-#include <clib/dos_protos.h>
-#include <pragmas/exec_pragmas.h>
-#include <pragmas/dos_pragmas.h>
+#include <proto/exec.h>
+#include <proto/dos.h>
 
+#if defined(__SASC)
+#	include <pragmas/exec_pragmas.h>
+#	include <pragmas/dos_pragmas.h>
+#elif defined(__AROS__)
+#	include <aros/symbolsets.h>
+#endif
+
 #include <string.h>
 #include <math.h>
 
 #include "gclass.h"
+#include "gclass_protos.h"
 
-
 struct __gClass {
 	struct ImageNode gc_Node;   /* name and icon, only for non-diagrams */
 	struct gClass *gc_Super;    /* super class */
@@ -56,9 +61,16 @@
 extern ULONG instanceSize;
 extern const STRPTR superClass;
 
+#ifdef __AROS__
+// ensure that InitGClass becomes 1st function in segment
+BOOL PUBLIC
+InitGClass(REG(a0, struct __gClass *gc), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
+	REG(a6, struct ExecBase *ExecBase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
+    REG(d4, long magic)) __attribute__((section(".aros.startup")));
+#endif
 
 BOOL PUBLIC
-InitGClass(REG(a0, struct __gClass *gc), REG(a1, APTR table), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
+InitGClass(REG(a0, struct __gClass *gc), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
 	REG(a6, struct ExecBase *ExecBase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
     REG(d4, long magic))
 {
@@ -86,6 +98,43 @@
     gcBase = table;
     pool = mainpool;
 
+	// Initialize function pointers
+	AllocStringLength = table[-1].func;
+	AllocString = table[-2].func;
+	FreeString = table[-3].func;
+	gDoMethodA = table[-4].func;
+	gDoSuperMethodA = table[-5].func;
+	SetHighColor = table[-6].func;
+	SetColors = table[-7].func;
+	FindColorPen = table[-8].func;
+	DrawRect = table[-9].func;
+	DrawLine = table[-10].func;
+	gAreaMove = table[-11].func;
+	gAreaDraw = table[-12].func;
+	gAreaEnd = table[-13].func;
+	GetDPI = table[-14].func;
+	GetOffset = table[-15].func;
+	FreeFontInfo = table[-16].func;
+	SetFontInfoA = table[-17].func;
+	CopyFontInfo = table[-18].func;
+	NewFontInfoA = table[-19].func;
+	DrawText = table[-20].func;
+	OutlineLength = table[-21].func;
+	OutlineHeight = table[-22].func;
+	pixel = table[-23].func;
+	mm = table[-24].func;
+	CreateTerm = table[-25].func;
+	DeleteTerm = table[-26].func;
+	CopyTerm = table[-27].func;
+	CalcTerm = table[-28].func;
+	gInsertRemoveCellsTablePos = table[-29].func;
+	gInsertRemoveCellsTerm = table[-30].func;
+	TintColor = table[-31].func;
+	gSuperDraw = table[-32].func;
+	gGetLink = table[-33].func;
+	SetLowColor = table[-34].func;
+	SetOutlineColor = table[-35].func;
+
 	if (!initClass(gc))
 		return FALSE;
 

Modified: trunk/add-ons/gclass.h
===================================================================
--- trunk/add-ons/gclass.h	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/gclass.h	2008-12-20 17:45:18 UTC (rev 22)
@@ -27,6 +27,11 @@
 #include "cell.h"
 #endif
 
+typedef struct {
+	UWORD jsr;
+	APTR func;
+} TableEntry;
+
 /*** class ***/
 
 struct gClass

Modified: trunk/add-ons/gclass_protos.h
===================================================================
--- trunk/add-ons/gclass_protos.h	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/gclass_protos.h	2008-12-20 17:45:18 UTC (rev 22)
@@ -14,60 +14,62 @@
 #include <exec/types.h>
 #endif
 
-struct TablePos;
+#include "gclass.h"
 
 /**/
 /* memory */
 /**/
-STRPTR AllocStringLength(STRPTR string,long len);
-STRPTR AllocString(STRPTR string);
-void FreeString(STRPTR string);
+STRPTR (*AllocStringLength)(STRPTR string,long len);
+STRPTR (*AllocString)(STRPTR string);
+void (*FreeString)(STRPTR string);
 /**/
 /* method calling */
 /**/
-ULONG gDoMethodA(APTR go,Msg msg);
-ULONG gDoMethod(APTR go,LONG data,...);
-ULONG gDoSuperMethodA(struct gClass *gc,APTR go,Msg msg);
-ULONG gDoSuperMethod(struct gClass *gc,APTR go,LONG data,...);
+ULONG (*gDoMethodA)(APTR go,Msg msg);
+ULONG (*gDoSuperMethodA)(struct gClass *gc,APTR go,Msg msg);
 /**/
 /* graphics */
 /**/
-void SetHighColor(struct RastPort *rp,ULONG color);
-void SetColors(struct RastPort *rp,ULONG apenID,ULONG bpenID);
-ULONG FindColorPen(UBYTE red,UBYTE green,UBYTE blue);
-void DrawRect(struct RastPort *rp,long x,long y,long w,long h);
-void DrawLine(struct RastPort *rp,ULONG dpi,long x1,long y1,long x2,long y2,ULONG points,UWORD flags);
-void gAreaMove(LONG x,LONG y);
-void gAreaDraw(LONG x,LONG y);
-void gAreaEnd(struct RastPort *rp);
-ULONG GetDPI(struct Page *page);
-LONG GetOffset(struct Page *page,BOOL horiz);
+void (*SetHighColor)(struct RastPort *rp,ULONG color);
+void (*SetColors)(struct RastPort *rp,ULONG apenID,ULONG bpenID);
+ULONG (*FindColorPen)(UBYTE red,UBYTE green,UBYTE blue);
+void (*DrawRect)(struct RastPort *rp,long x,long y,long w,long h);
+void (*DrawLine)(struct RastPort *rp,ULONG dpi,long x1,long y1,long x2,long y2,ULONG points,UWORD flags);
+void (*gAreaMove)(LONG x,LONG y);
+void (*gAreaDraw)(LONG x,LONG y);
+void (*gAreaEnd)(struct RastPort *rp);
+ULONG (*GetDPI)(struct Page *page);
+LONG (*GetOffset)(struct Page *page,BOOL horiz);
 /**/
 /* fonts */
 /**/
-void FreeFontInfo(struct FontInfo *fi);
-struct FontInfo *SetFontInfoA(struct FontInfo *fi,ULONG dpi,struct TagItem *ti);
-struct FontInfo *SetFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag1,...);
-struct FontInfo *CopyFontInfo(struct FontInfo *fi);
-struct FontInfo *NewFontInfoA(struct FontInfo *fi,ULONG dpi,struct TagItem *ti);
-void DrawText(struct RastPort *rp,struct FontInfo *fi,STRPTR t,long x,long y);
+void (*FreeFontInfo)(struct FontInfo *fi);
+struct FontInfo * (*SetFontInfoA)(struct FontInfo *fi,ULONG dpi,struct TagItem *ti);
+struct FontInfo * (*CopyFontInfo)(struct FontInfo *fi);
+struct FontInfo * (*NewFontInfoA)(struct FontInfo *fi,ULONG dpi,struct TagItem *ti);
+void (*DrawText)(struct RastPort *rp,struct FontInfo *fi,STRPTR t,long x,long y);
 /**/
 /* misc*/
 /**/
-ULONG OutlineLength(struct FontInfo *fi,STRPTR text,long len);
-ULONG OutlineHeight(struct FontInfo *fi,STRPTR text,long len);
-long pixel(struct Page *page,long mm,BOOL width);
-long mm(struct Page *page,long pixel,BOOL width);
-struct Term *CreateTerm(struct Page *page,STRPTR text);
-void DeleteTerm(struct Term *term);
-struct Term *CopyTerm(struct Term *term);
-STRPTR CalcTerm(struct Page *page,STRPTR text,struct Term *term,STRPTR format);
-void gInsertRemoveCellsTerm(struct gcpInReCells *gcpc,struct Page *page,STRPTR *term,struct Term *t);
-void gInsertRemoveCellsTablePos(struct gcpInReCells *gcpc,struct Page *page,STRPTR *term,struct TablePos *tp);
-ULONG TintColor(ULONG id,float tint);
-void gSuperDraw(struct Page *page,ULONG dpi,struct RastPort *rp,struct gClass *gc,struct gObject *go,struct gBounds *gb);
-struct gLink *gGetLink(struct gDiagram *gd,long col,long row);
-void SetLowColor(struct RastPort *rp,ULONG color);
-void SetOutlineColor(struct RastPort *rp,ULONG color);
+ULONG (*OutlineLength)(struct FontInfo *fi,STRPTR text,long len);
+ULONG (*OutlineHeight)(struct FontInfo *fi,STRPTR text,long len);
+long (*pixel)(struct Page *page,long mm,BOOL width);
+long (*mm)(struct Page *page,long pixel,BOOL width);
+struct Term * (*CreateTerm)(struct Page *page,STRPTR text);
+void (*DeleteTerm)(struct Term *term);
+struct Term * (*CopyTerm)(struct Term *term);
+STRPTR (*CalcTerm)(struct Page *page,STRPTR text,struct Term *term,STRPTR format);
+void (*gInsertRemoveCellsTerm)(struct gcpInReCells *gcpc,struct Page *page,STRPTR *term,struct Term *t);
+void (*gInsertRemoveCellsTablePos)(struct gcpInReCells *gcpc,struct Page *page,STRPTR *term,struct TablePos *tp);
+ULONG (*TintColor)(ULONG id,float tint);
+void (*gSuperDraw)(struct Page *page,ULONG dpi,struct RastPort *rp,struct gClass *gc,struct gObject *go,struct gBounds *gb);
+struct gLink * (*gGetLink)(struct gDiagram *gd,long col,long row);
+void (*SetLowColor)(struct RastPort *rp,ULONG color);
+void (*SetOutlineColor)(struct RastPort *rp,ULONG color);
 
+/* variadic functions must be real functions */
+ULONG gDoMethod(APTR go,LONG data,...);
+ULONG gDoSuperMethod(struct gClass *gc,APTR go,LONG data,...);
+struct FontInfo *SetFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag1,...);
+
 #endif  /* CLIB_GCLASS_PROTOS_H */

Added: trunk/add-ons/gclass_variadic.c
===================================================================
--- trunk/add-ons/gclass_variadic.c	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/gclass_variadic.c	2008-12-20 17:45:18 UTC (rev 22)
@@ -0,0 +1,22 @@
+/* Implementation of variadic "library" functions
+ *
+ * Copyright ?1996-2008 pinc Software. All Rights Reserved.
+ * Licensed under the terms of the MIT License.
+ */
+
+#include "gclass_protos.h"
+
+ULONG gDoMethod(APTR go, LONG data, ...)
+{
+	return gDoMethodA(go, &data);
+}
+
+ULONG gDoSuperMethod(struct gClass *gc, APTR go, LONG data, ...)
+{
+	return gDoSuperMethod(gc, go, &data);
+}
+
+struct FontInfo *SetFontInfo(struct FontInfo *fi, ULONG dpi, ULONG tag1, ...)
+{
+	return SetFontInfoA(fi, dpi, &tag1);
+}


Property changes on: trunk/add-ons/gclass_variadic.c
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native

Modified: trunk/add-ons/iotype.c
===================================================================
--- trunk/add-ons/iotype.c	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/iotype.c	2008-12-20 17:45:18 UTC (rev 22)
@@ -27,6 +27,7 @@
 
 struct Mappe;
 
+#include "iotype.h"
 #include "SDI_compiler.h"
 
 // Must always be in sync with the definition in io.h !!!
@@ -79,9 +80,16 @@
 
 #define MAKE_ID(a,b,c,d) ((a << 24) | (b << 16) | (c << 8) | d)
 
+#ifdef __AROS__
+// ensure that InitModule becomes 1st function in segment
+BOOL PUBLIC
+InitModule(REG(a0, struct IOType *io), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
+	REG(a6, struct ExecBase *execBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, APTR utilityBase),
+	REG(d3, APTR localeBase), REG(d4, long magic)) __attribute__((section(".aros.startup")));
+#endif
 
 BOOL PUBLIC
-InitModule(REG(a0, struct IOType *io), REG(a1, APTR table), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
+InitModule(REG(a0, struct IOType *io), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
 	REG(a6, struct ExecBase *execBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, APTR utilityBase),
 	REG(d3, APTR localeBase), REG(d4, long magic))
 {
@@ -110,6 +118,23 @@
 	ioBase = table;
 	pool = mainpool;
 
+	// Initialize function table
+	ReportErrorA = table[-15].func;
+	NewPage = table[-14].func;
+	CalculatePageDPI = table[-13].func;
+	NewCell = table[-12].func;
+	UpdateCellText = table[-11].func;
+	SetTableSize = table[-10].func;
+	FindColorPen = table[-9].func;
+	AddPen = table[-8].func;
+	Coord2String = table[-7].func;
+	pixel = table[-6].func;
+	mm = table[-5].func;
+	AllocStringLength = table[-4].func;
+	AllocString = table[-3].func;
+	FreeString = table[-2].func;
+	ita = table[-1].func;
+
 	setPrefs(io->io_Prefs);
 
 	return TRUE;

Modified: trunk/add-ons/iotype.h
===================================================================
--- trunk/add-ons/iotype.h	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/iotype.h	2008-12-20 17:45:18 UTC (rev 22)
@@ -38,6 +38,10 @@
 #	include "cell.h"
 #endif
 
+typedef struct {
+	UWORD jsr;
+	APTR func;
+} TableEntry;
 
 /*** Project related ***/
 
@@ -426,23 +430,25 @@
 
 /***************************** interne Funktionen *******************************/
 
-void   ReportError(STRPTR fmt,...);
-void   ReportErrorA(STRPTR fmt,APTR args);
-struct Page *NewPage(struct Mappe *mp);
-void   CalculatePageDPI(struct Page *page);
-struct Cell *NewCell(struct Page *page,LONG col,LONG row);
-void   UpdateCellText(struct Page *,struct Cell *);
-void   SetTableSize(struct Page *,LONG,LONG);
-STRPTR Coord2String(BOOL,LONG,BOOL,LONG);
-LONG   pixel(struct Page *,LONG,BOOL);
-LONG   mm(struct Page *,LONG,BOOL);
-ULONG  FindColorPen(UBYTE r,UBYTE g,UBYTE b);
-struct colorPen *AddPen(STRPTR name,UBYTE r,UBYTE g,UBYTE b);
-STRPTR AllocStringLength(STRPTR,LONG);
-STRPTR AllocString(STRPTR);
-void   FreeString(STRPTR);
-STRPTR ita(double d,long komma ,UBYTE flags);
+void   (*ReportErrorA)(STRPTR fmt,APTR args);
+struct Page * (*NewPage)(struct Mappe *mp);
+void   (*CalculatePageDPI)(struct Page *page);
+struct Cell * (*NewCell)(struct Page *page,LONG col,LONG row);
+void   (*UpdateCellText)(struct Page *,struct Cell *);
+void   (*SetTableSize)(struct Page *,LONG,LONG);
+STRPTR (*Coord2String)(BOOL,LONG,BOOL,LONG);
+LONG   (*pixel)(struct Page *,LONG,BOOL);
+LONG   (*mm)(struct Page *,LONG,BOOL);
+ULONG  (*FindColorPen)(UBYTE r,UBYTE g,UBYTE b);
+struct colorPen * (*AddPen)(STRPTR name,UBYTE r,UBYTE g,UBYTE b);
+STRPTR (*AllocStringLength)(STRPTR,LONG);
+STRPTR (*AllocString)(STRPTR);
+void   (*FreeString)(STRPTR);
+STRPTR (*ita)(double d,long komma ,UBYTE flags);
 
+// variadic functions must be real functions
+void   ReportError(STRPTR fmt, ...);
+
 #if defined(__SASC)
 #	pragma tagcall ioBase ReportError 5a 9802
 #	pragma libcall ioBase ReportErrorA 5a 9802

Added: trunk/add-ons/iotype_variadic.c
===================================================================
--- trunk/add-ons/iotype_variadic.c	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/iotype_variadic.c	2008-12-20 17:45:18 UTC (rev 22)
@@ -0,0 +1,12 @@
+/* Implementation of variadic "library" functions
+ *
+ * Copyright ?1996-2008 pinc Software. All Rights Reserved.
+ * Licensed under the terms of the MIT License.
+ */
+
+#include "iotype.h"
+
+void ReportError(STRPTR fmt, ...)
+{
+	ReportErrorA(fmt, &fmt + 1);
+}


Property changes on: trunk/add-ons/iotype_variadic.c
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native

Modified: trunk/add-ons/mmakefile.src
===================================================================
--- trunk/add-ons/mmakefile.src	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/add-ons/mmakefile.src	2008-12-20 17:45:18 UTC (rev 22)
@@ -4,7 +4,21 @@
 
 include $(TOP)/config/make.cfg
 
-#MM- contrib-ignition-addons : contrib-ignition-addon-turbocalc
+#MM- contrib-ignition-addons : \
+#MM  contrib-ignition-addon-area_diagram \
+#MM  contrib-ignition-addon-button \
+#MM  contrib-ignition-addon-checkbox \
+#MM  contrib-ignition-addon-circle_diagram \
+#MM  contrib-ignition-addon-column_diagram \
+#MM  contrib-ignition-addon-frame \
+#MM  contrib-ignition-addon-gradient \
+#MM  contrib-ignition-addon-line \
+#MM  contrib-ignition-addon-line_diagram \
+#MM  contrib-ignition-addon-rectangle \
+#MM  contrib-ignition-addon-text \
+#MM  contrib-ignition-addon-ascii \
+#MM  contrib-ignition-addon-csv \
+#MM  contrib-ignition-addon-turbocalc
 
 #MM  contrib-ignition-addon-area_diagram : includes linklibs
 #MM  contrib-ignition-addon-button : includes linklibs
@@ -22,66 +36,66 @@
 #MM  contrib-ignition-addon-csv : includes linklibs
 #MM  contrib-ignition-addon-turbocalc : includes linklibs
 
-TARGETDIR := $(AROS_CONTRIB)/Office/Ingition/add-ons
+TARGETDIR := $(AROS_CONTRIB)/Office/Ignition/add-ons
 USER_INCLUDES := -I../libs/include -I..
 
 
 #### gclass
 
 %build_module_simple mmake=contrib-ignition-addon-area_diagram \
-	modname=area_diagramm modtype=gc \
-	files="gclass area_diagram" moduledir=$(TARGETDIR) \
-	uselibs=
+	modname=area_diagram modtype=gc \
+	files="gclass gclass_variadic area_diagram" moduledir=$(TARGETDIR) \
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-button \
 	modname=button modtype=gc \
 	files="gclass button" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-checkbox \
 	modname=checkbox modtype=gc \
-	files="gclass checkbox" moduledir=$(TARGETDIR) \
-	uselibs=
+	files="gclass gclass_variadic checkbox" moduledir=$(TARGETDIR) \
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-circle_diagram \
 	modname=circle_diagram modtype=gc \
 	files="gclass circle_diagram" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-column_diagram \
 	modname=column_diagram modtype=gc \
-	files="gclass column_diagram" moduledir=$(TARGETDIR) \
-	uselibs=
+	files="gclass gclass_variadic column_diagram" moduledir=$(TARGETDIR) \
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-frame \
 	modname=frame modtype=gc \
 	files="gclass frame" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-gradient \
 	modname=gradient modtype=gc \
 	files="gclass gradient" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-line \
 	modname=line modtype=gc \
 	files="gclass line" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-line_diagram \
 	modname=line_diagram modtype=gc \
-	files="gclass line_diagram" moduledir=$(TARGETDIR) \
-	uselibs=
+	files="gclass gclass_variadic line_diagram" moduledir=$(TARGETDIR) \
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-rectangle \
 	modname=rectangle modtype=gc \
 	files="gclass rectangle" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-text \
 	modname=text modtype=gc \
 	files="gclass text" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 
 #### iotype
@@ -89,16 +103,16 @@
 %build_module_simple mmake=contrib-ignition-addon-ascii \
 	modname=text modtype=io \
 	files="iotype ascii" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-csv \
 	modname=csv modtype=io \
-	files="iotype csv" moduledir=$(TARGETDIR) \
-	uselibs=
+	files="iotype iotype_variadic csv" moduledir=$(TARGETDIR) \
+	uselibs=rom
 
 %build_module_simple mmake=contrib-ignition-addon-turbocalc \
 	modname=turbocalc modtype=io \
 	files="iotype turbocalc" moduledir=$(TARGETDIR) \
-	uselibs=
+	uselibs=rom
 
 %common

Modified: trunk/classes.c
===================================================================
--- trunk/classes.c	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/classes.c	2008-12-20 17:45:18 UTC (rev 22)
@@ -1389,7 +1389,7 @@
 		olddir = CurrentDir(dir);
 		if ((segment = LoadSeg(gc->gc_ClassName)) != 0)
 		{
-			initGCSegment = MKBADDR(segment);
+			initGCSegment = MKBADDR(segment) + sizeof(APTR);
 			if (initGCSegment(gc, (UBYTE *)gClassFuncTable + gClassFuncTableSize, pool, GfxBase, SysBase, MathIeeeDoubBasBase,
 					MathIeeeDoubTransBase, UtilityBase, LocaleBase,
 #ifdef IGNITION_LITE_EDITION

Modified: trunk/io.c
===================================================================
--- trunk/io.c	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/io.c	2008-12-20 17:45:18 UTC (rev 22)
@@ -2451,7 +2451,7 @@
 		olddir = CurrentDir(dir);
 		if ((segment = LoadSeg(io->io_Filename)) != 0)
 		{
-			initIOSegment = MKBADDR(segment);
+			initIOSegment = MKBADDR(segment) + sizeof(APTR);
 			if (initIOSegment(io, (APTR)((UBYTE *)io_functable + sizeof(io_functable)), pool, DOSBase,
 					SysBase, MathIeeeDoubBasBase, MathIeeeDoubTransBase, UtilityBase, LocaleBase, MAKE_ID('I','G','N',0)))
 				io->io_Segment = segment;

Modified: trunk/mmakefile.src
===================================================================
--- trunk/mmakefile.src	2008-12-20 13:14:52 UTC (rev 21)
+++ trunk/mmakefile.src	2008-12-20 17:45:18 UTC (rev 22)
@@ -10,7 +10,7 @@
 
 #MM contrib-ignition-bin : linklibs includes contrib-ignition-textedit \
 #MM contrib-ignition-scroller contrib-ignition-gtdrag contrib-ignition-catalogs \
-#MM contrib-ignition-descr
+#MM contrib-ignition-descr contrib-ignition-addons
 
 EXE := Ignition
 



From axeld at pinc-software.de  Sun Dec 21 13:58:15 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sun, 21 Dec 2008 13:58:15 +0100 CET
Subject: [Ignition-commits] r21 - trunk/distribution/full/sheets
In-Reply-To: <200812201314.mBKDEw24028885@sheep.berlios.de>
Message-ID: <1378423434-BeMail@zon>

marust at mail.berlios.de wrote:
> Log:
> * New attempt to rename two files which contain a space.
>   (something went wrong with a previous attempt.)

Of course I would rather see a fixed copy tool on the AROS side instead 
(in the long run); spaces in file names is really something so basic 
that it should be supported out of the box.

Bye,
   Axel.



From axeld at pinc-software.de  Sun Dec 21 14:03:33 2008
From: axeld at pinc-software.de (Axel =?utf-8?q?D=C3=B6rfler?=)
Date: Sun, 21 Dec 2008 14:03:33 +0100 CET
Subject: [Ignition-commits] r22 - in trunk: . add-ons
In-Reply-To: <200812201745.mBKHjRuX000615@sheep.berlios.de>
Message-ID: <1696459723-BeMail@zon>

marust at mail.berlios.de wrote:
> Log:
> * Made add-ons class loading working on AROS.
>   All core functions are implemented as function pointers.
>   These pointers are initialized with the function table
>   pointer from the core. Only the variadic functions
>   are implemented as real functions. I think we can ommit
>   the SASC specific implementation of how the add-ons called
>   the core functions at all.

That's a good solution to the problem. As a next step, we could then 
get rid of the typeless table and have named function pointers for less 
future trouble.

Bye,
   Axel.



From marust at mail.berlios.de  Sun Dec 21 15:32:26 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sun, 21 Dec 2008 15:32:26 +0100
Subject: [Ignition-commits] r23 - trunk
Message-ID: <200812211432.mBLEWQur032313@sheep.berlios.de>

Author: marust
Date: 2008-12-21 15:32:24 +0100 (Sun, 21 Dec 2008)
New Revision: 23
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=23&view=rev

Modified:
   trunk/ignition.c
   trunk/rexx.c
Log:
* ignition.c
  Fix for a segfault which happened when a file was loaden
  from the directory where the Ignition binary resides.
  Reason for the crash was that mp->mp_Path was NULL.
* rexx.c/
  Fix for a segfault which happened because the message string
  contained a "%s" but no string argument was given.


Modified: trunk/ignition.c
===================================================================
--- trunk/ignition.c	2008-12-20 17:45:18 UTC (rev 22)
+++ trunk/ignition.c	2008-12-21 14:32:24 UTC (rev 23)
@@ -1379,7 +1379,10 @@
     if (!mp)
         return;
 
-    strcpy(filename,mp->mp_Path);
+	filename[0] = '\0';
+	if (mp->mp_Path)
+		strcpy(filename,mp->mp_Path);
+
     AddPart(filename,mp->mp_Node.ln_Name,512);
 
     if ((s = FindSession(filename)) != 0) {

Modified: trunk/rexx.c
===================================================================
--- trunk/rexx.c	2008-12-20 17:45:18 UTC (rev 22)
+++ trunk/rexx.c	2008-12-21 14:32:24 UTC (rev 23)
@@ -2525,7 +2525,7 @@
 		}
 
 		if (LoadProject(mp, type)) {
-			ErrorRequest(GetString(&gLocaleInfo, MSG_LOAD_PROJECT_ERR));
+			ErrorRequest(GetString(&gLocaleInfo, MSG_LOAD_PROJECT_ERR), mp->mp_Node.ln_Name);
 			return RC_WARN;
 		}
 



From marust at mail.berlios.de  Sun Dec 21 21:47:08 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Sun, 21 Dec 2008 21:47:08 +0100
Subject: [Ignition-commits] r24 - in trunk: . add-ons
Message-ID: <200812212047.mBLKl8wB015437@sheep.berlios.de>

Author: marust
Date: 2008-12-21 21:47:02 +0100 (Sun, 21 Dec 2008)
New Revision: 24
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=24&view=rev

Modified:
   trunk/add-ons/area_diagram.c
   trunk/add-ons/button.c
   trunk/add-ons/checkbox.c
   trunk/add-ons/circle_diagram.c
   trunk/add-ons/column_diagram.c
   trunk/add-ons/frame.c
   trunk/add-ons/gclass_protos.h
   trunk/add-ons/line_diagram.c
   trunk/graphic.c
Log:
* Fix for the problem that the area functions didn't get a rastport.
  The functions libAreaMove and LibAreaDraw have now and additional
  RastPort pointer argument.
* The tempras initialisation of the global RastPort "grp" was wrong.
  (InitTmpRas() is a void function.)


Modified: trunk/add-ons/area_diagram.c
===================================================================
--- trunk/add-ons/area_diagram.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/area_diagram.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -119,8 +119,8 @@
 
 				if (i != 0)
 				{
-					gAreaMove(x, y);
-					gAreaDraw(x + depth, y - depth);
+					gAreaMove(rp, x, y);
+					gAreaDraw(rp, x + depth, y - depth);
 
 					gAreaEnd(rp);
 				}
@@ -129,18 +129,18 @@
 
 				if (i < gd->gd_Cols - 1)
 				{
-					gAreaDraw(x + depth, y - depth);
-					gAreaDraw(x, y);
+					gAreaDraw(rp, x + depth, y - depth);
+					gAreaDraw(rp, x, y);
 				}
 				x += width;
 			}
 
 			// Oberfl?chen bei Vorzeichenwechsel
 			x -= width;
-			gAreaMove(left, zero);
-			gAreaDraw(left + depth, zero - depth);
-			gAreaDraw(x + depth, zero - depth);
-			gAreaDraw(x , zero);
+			gAreaMove(rp, left, zero);
+			gAreaDraw(rp, left + depth, zero - depth);
+			gAreaDraw(rp, x + depth, zero - depth);
+			gAreaDraw(rp, x , zero);
 			gAreaEnd(rp);
 		}
 
@@ -160,14 +160,14 @@
 			if (i == 0)
 			{
 				SetHighColor(rp, color = gl->gl_Color);
-				gAreaMove(x, zero);
+				gAreaMove(rp, x, zero);
 			}
-			gAreaDraw(x, y);
+			gAreaDraw(rp, x, y);
 
 			x += width;
 		}
 		x -= width;
-		gAreaDraw(x, zero);
+		gAreaDraw(rp, x, zero);
 		gAreaEnd(rp);
 
 		// rechte Seite
@@ -178,10 +178,10 @@
 			if (y > zero)
 				zero += offset + 1;
 
-			gAreaMove(x, zero);
-			gAreaDraw(x, y);
-			gAreaDraw(x + depth, y - depth);
-			gAreaDraw(x + depth, zero - depth);
+			gAreaMove(rp, x, zero);
+			gAreaDraw(rp, x, y);
+			gAreaDraw(rp, x + depth, y - depth);
+			gAreaDraw(rp, x + depth, zero - depth);
 			gAreaEnd(rp);
 		}
 	}

Modified: trunk/add-ons/button.c
===================================================================
--- trunk/add-ons/button.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/button.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -90,28 +90,28 @@
 	SetHighColor(grp, gb->gb_ShinePen);//  SetOutlineColor(grp,TintColor(gb->gb_ShinePen,1.25f));
 	if (go->go_Flags & GOF_PRESSED)
 	{
-		gAreaMove(x+width,y+height);
-		gAreaDraw(x+width,y);
-		gAreaDraw(x+width-bx,y+by);
-		gAreaDraw(x+width-bx,y+height-by);
+		gAreaMove(grp, x + width, y + height);
+		gAreaDraw(grp, x + width, y);
+		gAreaDraw(grp, x + width - bx, y + by);
+		gAreaDraw(grp, x + width - bx, y + height - by);
 		gAreaEnd(grp);
-		gAreaMove(x+width,y+height);
-		gAreaDraw(x,y+height);
-		gAreaDraw(x+bx,y+height-by);
-		gAreaDraw(x+width-bx,y+height-by);
+		gAreaMove(grp, x + width, y + height);
+		gAreaDraw(grp, x, y + height);
+		gAreaDraw(grp, x + bx, y + height - by);
+		gAreaDraw(grp, x + width - bx, y + height - by);
 		gAreaEnd(grp);
 	}
 	else
 	{
-		gAreaMove(x,y);
-		gAreaDraw(x,y+height);
-		gAreaDraw(x+bx,y+height-by);
-		gAreaDraw(x+bx,y+by);
+		gAreaMove(grp, x, y);
+		gAreaDraw(grp, x, y + height);
+		gAreaDraw(grp, x + bx, y + height - by);
+		gAreaDraw(grp, x + bx, y + by);
 		gAreaEnd(grp);
-		gAreaMove(x,y);
-		gAreaDraw(x+width,y);
-		gAreaDraw(x+width-bx,y+by);
-		gAreaDraw(x+bx,y+by);
+		gAreaMove(grp, x, y);
+		gAreaDraw(grp, x + width, y);
+		gAreaDraw(grp, x + width - bx, y + by);
+		gAreaDraw(grp, x + bx, y + by);
 		gAreaEnd(grp);
 	}
 

Modified: trunk/add-ons/checkbox.c
===================================================================
--- trunk/add-ons/checkbox.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/checkbox.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -110,15 +110,15 @@
   }
   SetHighColor(grp,cb->cb_ShinePen);
 
-  gAreaMove(x+size,y+size);
-  gAreaDraw(x+size,y);
-  gAreaDraw(x+size-bx,y+by);
-  gAreaDraw(x+size-bx,y+size-by);
+  gAreaMove(grp, x + size, y + size);
+  gAreaDraw(grp, x + size, y);
+  gAreaDraw(grp, x + size - bx, y + by);
+  gAreaDraw(grp, x + size - bx, y + size - by);
   gAreaEnd(grp);
-  gAreaMove(x+size,y+size);
-  gAreaDraw(x,y+size);
-  gAreaDraw(x+bx,y+size-by);
-  gAreaDraw(x+size-bx,y+size-by);
+  gAreaMove(grp, x + size, y + size);
+  gAreaDraw(grp, x, y + size);
+  gAreaDraw(grp, x + bx, y + size - by);
+  gAreaDraw(grp, x + size - bx, y + size - by);
   gAreaEnd(grp);
 
   SetHighColor(grp,TintColor(cb->cb_ShinePen,1.25f));
@@ -139,16 +139,16 @@
 
     SetHighColor(grp,cb->cb_CheckPen);
 
-    gAreaMove(ax+s2-s4,ay+s2+s4-s10);
-    gAreaDraw(ax+s2+s4-s10,ay+s2-s4);
-    gAreaDraw(ax+s2+s4,ay+s2-s4+s10);
-    gAreaDraw(ax+s2-s4+s10,ay+s2+s4);
+    gAreaMove(grp, ax + s2 - s4, ay + s2 + s4 - s10);
+    gAreaDraw(grp, ax + s2 + s4 - s10, ay + s2 - s4);
+    gAreaDraw(grp, ax + s2 + s4, ay + s2 - s4 + s10);
+    gAreaDraw(grp, ax + s2 - s4 + s10, ay + s2 + s4);
     gAreaEnd(grp);
 
-    gAreaMove(ax+s2-s4+s10,ay+s2-s4);
-    gAreaDraw(ax+s2+s4,ay+s2+s4-s10);
-    gAreaDraw(ax+s2+s4-s10,ay+s2+s4);
-    gAreaDraw(ax+s2-s4,ay+s2-s4+s10);
+    gAreaMove(grp, ax + s2 - s4 + s10, ay + s2 - s4);
+    gAreaDraw(grp, ax + s2 + s4, ay + s2 + s4 - s10);
+    gAreaDraw(grp, ax + s2 + s4 - s10, ay + s2 + s4);
+    gAreaDraw(grp, ax + s2 - s4, ay + s2 - s4 + s10);
     gAreaEnd(grp);
 
     //RectFill(grp,x+width/3,y+size/3,x+width/2,y+size/2);

Modified: trunk/add-ons/circle_diagram.c
===================================================================
--- trunk/add-ons/circle_diagram.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/circle_diagram.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -41,7 +41,7 @@
 #define GCA_StartAngle (GOA_TagBase + 302)
 
 struct gInterface interface[] = {
-	{GCA_Frame, NULL /*"Fl???che durch einen Rahmen begrenzen"*/, GIT_CHECKBOX, NULL, NULL},
+	{GCA_Frame, NULL /*"Fl?che durch einen Rahmen begrenzen"*/, GIT_CHECKBOX, NULL, NULL},
 	{GCA_Pseudo3D, NULL /*"Pseudo-3D"*/, GIT_CHECKBOX, NULL, NULL},
 	{GCA_StartAngle, NULL /*"Pseudo-3D"*/, GIT_TEXT, NULL, NULL},
 	{0}
@@ -54,16 +54,16 @@
 
 
 void
-gAreaArcMove(long x, long y, long xradius, long yradius, double degree)
+gAreaArcMove(struct RastPort *rp, long x, long y, long xradius, long yradius, double degree)
 {
-    gAreaDraw((long)(x + sin(degree) * xradius + 0.5), (long)(y + cos(degree) * yradius + 0.5));
+    gAreaDraw(rp, (long)(x + sin(degree) * xradius + 0.5), (long)(y + cos(degree) * yradius + 0.5));
 }
 
 
 void
-gAreaArc(long x, long y, long xradius, long yradius, double degree)
+gAreaArc(struct RastPort *rp, long x, long y, long xradius, long yradius, double degree)
 {
-    gAreaDraw((long)(x + sin(degree) * xradius + 0.5), (long)(y + cos(degree) * yradius + 0.5));
+    gAreaDraw(rp, (long)(x + sin(degree) * xradius + 0.5), (long)(y + cos(degree) * yradius + 0.5));
 }
 
 
@@ -75,14 +75,14 @@
     start = start * PI / 180.0;
     end = end * PI / 180.0;
 
-    gAreaMove(x, y);
+    gAreaMove(rp, x, y);
 
 	for (degree = start; degree < end; degree += DEGREE_STEPS) {
-        gAreaArc(x, y, xradius, yradius, degree);
+        gAreaArc(rp, x, y, xradius, yradius, degree);
     }
 
     if (degree > end)
-        gAreaArc(x, y, xradius, yradius, end);
+        gAreaArc(rp, x, y, xradius, yradius, end);
 
     gAreaEnd(rp);
 }
@@ -96,19 +96,19 @@
     start = start * PI / 180.0;
     end = end * PI / 180.0;
 
-    gAreaArcMove(x, y + height, xradius, yradius, start);
-    gAreaArc(x, y, xradius, yradius, start);
+    gAreaArcMove(rp, x, y + height, xradius, yradius, start);
+    gAreaArc(rp, x, y, xradius, yradius, start);
 
     for (degree = start; degree < end; degree += DEGREE_STEPS)
-        gAreaArc(x, y, xradius, yradius, degree);
+        gAreaArc(rp, x, y, xradius, yradius, degree);
 
     if (degree > end)
-        gAreaArc(x, y, xradius, yradius, end);
+        gAreaArc(rp, x, y, xradius, yradius, end);
 
-    gAreaArc(x, y + height, xradius, yradius, end);
+    gAreaArc(rp, x, y + height, xradius, yradius, end);
 
     for (degree = end; degree > start; degree -= DEGREE_STEPS)
-        gAreaArc(x, y + height, xradius, yradius, degree);
+        gAreaArc(rp, x, y + height, xradius, yradius, degree);
 
     gAreaEnd(rp);
 }
@@ -293,7 +293,7 @@
 initClass(REG(a0, struct gClass *gc))
 {
 	sCatalog = OpenCatalog(NULL, "ignition.catalog", OC_BuiltInLanguage, "deutsch", TAG_END);
-	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_AREA_OUTLINE_GAD, "Fl???che durch einen Rahmen begrenzen");
+	interface[0].gi_Label = GetCatalogStr(sCatalog, MSG_AREA_OUTLINE_GAD, "Fl?che durch einen Rahmen begrenzen");
 	interface[1].gi_Label = GetCatalogStr(sCatalog, MSG_PSEUDO_3D_GAD, "Pseudo-3D");
 	interface[2].gi_Label = GetCatalogStr(sCatalog, /*ToDo!*/MSG_PSEUDO_3D_GAD, "Anfangswinkel:");
 

Modified: trunk/add-ons/column_diagram.c
===================================================================
--- trunk/add-ons/column_diagram.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/column_diagram.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -141,19 +141,19 @@
 				if (y < zero || y > zero + offset + depth)
                 {					 
 					// Kante am Y-Wert
-					gAreaMove(x + innerWidth + o, y);
-					gAreaDraw(x + innerWidth + o + depth, y - depth);
+					gAreaMove(rp, x + innerWidth + o, y);
+					gAreaDraw(rp, x + innerWidth + o + depth, y - depth);
 					
 					// Kante an Achse
 					if (y < zero)  // Werte gr??er NULL
 					{
-						gAreaDraw(x + innerWidth + o + depth, zero - depth);
-						gAreaDraw(x + innerWidth + o, zero);
+						gAreaDraw(rp, x + innerWidth + o + depth, zero - depth);
+						gAreaDraw(rp, x + innerWidth + o, zero);
 					}
 					else  // Werte kleiner NULL
 					{
-						gAreaDraw(x + innerWidth + o + depth, zero + offset + 1);
-						gAreaDraw(x + innerWidth + o, zero + offset + 1);
+						gAreaDraw(rp, x + innerWidth + o + depth, zero + offset + 1);
+						gAreaDraw(rp, x + innerWidth + o, zero + offset + 1);
 					}
 					gAreaEnd(rp);
 				}
@@ -163,9 +163,9 @@
 						// Steigung ist -1
 
 					// da ist nur ein Dreieck sichtbar
-					gAreaMove(x + innerWidth + o, y);
-					gAreaDraw(xAtZero, zero + offset + 1);
-					gAreaDraw(x + innerWidth + o, zero + offset + 1);
+					gAreaMove(rp, x + innerWidth + o, y);
+					gAreaDraw(rp, xAtZero, zero + offset + 1);
+					gAreaDraw(rp, x + innerWidth + o, zero + offset + 1);
 					gAreaEnd(rp);
 				}
 
@@ -174,10 +174,10 @@
 					y = zero;
 
 				SetHighColor(rp, TintColor(gl->gl_Color, 0.7f));
-				gAreaMove(x + o, y);
-				gAreaDraw(x + o + depth, y - depth);
-				gAreaDraw(x + innerWidth + o + depth, y - depth);
-				gAreaDraw(x + innerWidth + o, y);
+				gAreaMove(rp, x + o, y);
+				gAreaDraw(rp, x + o + depth, y - depth);
+				gAreaDraw(rp, x + innerWidth + o + depth, y - depth);
+				gAreaDraw(rp, x + innerWidth + o, y);
 				gAreaEnd(rp);
 			}
 			x += width;

Modified: trunk/add-ons/frame.c
===================================================================
--- trunk/add-ons/frame.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/frame.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -68,28 +68,28 @@
   SetHighColor(grp,f->f_ShinePen);
   if (recessed)
   {
-    gAreaMove(x+width,y+height);
-    gAreaDraw(x+width,y);
-    gAreaDraw(x+width-bx,y+by);
-    gAreaDraw(x+width-bx,y+height-by);
+    gAreaMove(grp, x + width, y + height);
+    gAreaDraw(grp, x + width, y);
+    gAreaDraw(grp, x + width - bx, y + by);
+    gAreaDraw(grp, x + width - bx, y + height - by);
     gAreaEnd(grp);
-    gAreaMove(x+width,y+height);
-    gAreaDraw(x,y+height);
-    gAreaDraw(x+bx,y+height-by);
-    gAreaDraw(x+width-bx,y+height-by);
+    gAreaMove(grp, x + width, y + height);
+    gAreaDraw(grp, x, y + height);
+    gAreaDraw(grp, x + bx, y + height - by);
+    gAreaDraw(grp, x + width - bx, y + height - by);
     gAreaEnd(grp);
   }
   else
   {
-    gAreaMove(x,y);
-    gAreaDraw(x,y+height);
-    gAreaDraw(x+bx,y+height-by);
-    gAreaDraw(x+bx,y+by);
+    gAreaMove(grp, x, y);
+    gAreaDraw(grp, x, y + height);
+    gAreaDraw(grp, x + bx, y + height - by);
+    gAreaDraw(grp, x + bx, y + by);
     gAreaEnd(grp);
-    gAreaMove(x,y);
-    gAreaDraw(x+width,y);
-    gAreaDraw(x+width-bx,y+by);
-    gAreaDraw(x+bx,y+by);
+    gAreaMove(grp, x, y);
+    gAreaDraw(grp, x + width, y);
+    gAreaDraw(grp, x + width - bx, y + by);
+    gAreaDraw(grp, x + bx, y + by);
     gAreaEnd(grp);
   }
 

Modified: trunk/add-ons/gclass_protos.h
===================================================================
--- trunk/add-ons/gclass_protos.h	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/gclass_protos.h	2008-12-21 20:47:02 UTC (rev 24)
@@ -16,6 +16,8 @@
 
 #include "gclass.h"
 
+struct TablePos;
+
 /**/
 /* memory */
 /**/
@@ -35,8 +37,8 @@
 ULONG (*FindColorPen)(UBYTE red,UBYTE green,UBYTE blue);
 void (*DrawRect)(struct RastPort *rp,long x,long y,long w,long h);
 void (*DrawLine)(struct RastPort *rp,ULONG dpi,long x1,long y1,long x2,long y2,ULONG points,UWORD flags);
-void (*gAreaMove)(LONG x,LONG y);
-void (*gAreaDraw)(LONG x,LONG y);
+void (*gAreaMove)(struct RastPort *rp,LONG x,LONG y);
+void (*gAreaDraw)(struct RastPort *rp,LONG x,LONG y);
 void (*gAreaEnd)(struct RastPort *rp);
 ULONG (*GetDPI)(struct Page *page);
 LONG (*GetOffset)(struct Page *page,BOOL horiz);

Modified: trunk/add-ons/line_diagram.c
===================================================================
--- trunk/add-ons/line_diagram.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/add-ons/line_diagram.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -98,8 +98,8 @@
 
         if (i != 0)
         {
-          gAreaMove(x,y);
-          gAreaDraw(x+offset,y-offset);
+          gAreaMove(rp, x, y);
+          gAreaDraw(rp, x + offset, y - offset);
 
           gAreaEnd(rp);
         }
@@ -108,8 +108,8 @@
 
         if (i < gd->gd_Cols-1)
         {
-          gAreaDraw(x+offset,y-offset);
-          gAreaDraw(x,y);
+          gAreaDraw(rp, x + offset, y - offset);
+          gAreaDraw(rp, x, y);
         }
         x += width;
       }

Modified: trunk/graphic.c
===================================================================
--- trunk/graphic.c	2008-12-21 14:32:24 UTC (rev 23)
+++ trunk/graphic.c	2008-12-21 20:47:02 UTC (rev 24)
@@ -38,16 +38,16 @@
 
 
 void PUBLIC
-libAreaMove(REG(d0, LONG x), REG(d1, LONG y))
+libAreaMove(REG(a0, struct RastPort *rp), REG(d0, LONG x), REG(d1, LONG y))
 {
-	gAreaMove(NULL, x, y);
+	gAreaMove(rp, x, y);
 }
 
 
 void PUBLIC
-libAreaDraw(REG(d0, LONG x), REG(d1, LONG y))
+libAreaDraw(REG(a0, struct RastPort *rp), REG(d0, LONG x), REG(d1, LONG y))
 {
-	gAreaDraw(NULL, x, y);
+	gAreaDraw(rp, x, y);
 }
 
 
@@ -157,8 +157,10 @@
 
 	FreeTmpRas();
 	if ((sTempBitmap = AllocVec(bytes, MEMF_CHIP | MEMF_CLEAR)) != 0)
-		//grp->TmpRas = InitTmpRas(&sTempRaster, sTempBitmap, bytes);  FIXME: InitTmpRas is a void function
+	{
 		InitTmpRas(&sTempRaster, sTempBitmap, bytes);
+		grp->TmpRas = &sTempRaster;
+	}
 
 	gInitArea(0, 0, width - 1, height - 1);
 }



From marust at mail.berlios.de  Mon Dec 22 00:45:24 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Mon, 22 Dec 2008 00:45:24 +0100
Subject: [Ignition-commits] r25 - trunk
Message-ID: <200812212345.mBLNjOkB014388@sheep.berlios.de>

Author: marust
Date: 2008-12-22 00:45:21 +0100 (Mon, 22 Dec 2008)
New Revision: 25
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=25&view=rev

Modified:
   trunk/funcs.h
   trunk/handlewindows.c
Log:
* HandleFileTypeIDCMP() is a callback hook and must therefor get the argument
  order Hook*(a0), APTR (a2), Message*(a1)


Modified: trunk/funcs.h
===================================================================
--- trunk/funcs.h	2008-12-21 20:47:02 UTC (rev 24)
+++ trunk/funcs.h	2008-12-21 23:45:21 UTC (rev 25)
@@ -36,7 +36,7 @@
 extern void UpdateGInterface(struct Window *giwin,struct MinList *list,struct gObject *go,UBYTE page);
 extern void HandleGGadget(struct Page *page,struct gObject *go);
 extern void UpdateObjectGadgets(struct Window *win);
-extern void PUBLIC HandleFileTypeIDCMP(REG(a1, struct IntuiMessage *msg),REG(a2, struct FileRequester *fr));
+extern void PUBLIC HandleFileTypeIDCMP(REG(a0, struct Hook *),REG(a2, struct FileRequester *fr),REG(a1, struct IntuiMessage *msg));
 
 // pointer.c
 extern void SetMousePointer(struct Window *win,ULONG which);

Modified: trunk/handlewindows.c
===================================================================
--- trunk/handlewindows.c	2008-12-21 20:47:02 UTC (rev 24)
+++ trunk/handlewindows.c	2008-12-21 23:45:21 UTC (rev 25)
@@ -1633,7 +1633,7 @@
 
 
 void PUBLIC
-HandleFileTypeIDCMP(REG(a1, struct IntuiMessage *msg), REG(a2, struct FileRequester *fr))
+HandleFileTypeIDCMP(REG(a0, struct Hook *h), REG(a2, struct FileRequester *fr), REG(a1, struct IntuiMessage *msg))
 {
     struct winData *wd;
 	struct Window *typeWindow = msg->IDCMPWindow;



From marust at mail.berlios.de  Fri Dec 26 11:56:55 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Fri, 26 Dec 2008 11:56:55 +0100
Subject: [Ignition-commits] r26 - in trunk: . add-ons
Message-ID: <200812261056.mBQAutPi014648@sheep.berlios.de>

Author: marust
Date: 2008-12-26 11:56:50 +0100 (Fri, 26 Dec 2008)
New Revision: 26
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=26&view=rev

Modified:
   trunk/add-ons/gclass.c
   trunk/add-ons/gclass.h
   trunk/add-ons/iotype.c
   trunk/add-ons/iotype.h
   trunk/classes.c
   trunk/graphic.c
   trunk/io.c
Log:
* Little improvement for handling of core functions:
  Pointer to *begin* of function table is forwarded to
  segment init functions.
* Removed JSR from function tables.


Modified: trunk/add-ons/gclass.c
===================================================================
--- trunk/add-ons/gclass.c	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/add-ons/gclass.c	2008-12-26 10:56:50 UTC (rev 26)
@@ -61,16 +61,9 @@
 extern ULONG instanceSize;
 extern const STRPTR superClass;
 
-#ifdef __AROS__
-// ensure that InitGClass becomes 1st function in segment
-BOOL PUBLIC
-InitGClass(REG(a0, struct __gClass *gc), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
-	REG(a6, struct ExecBase *ExecBase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
-    REG(d4, long magic)) __attribute__((section(".aros.startup")));
-#endif
 
 BOOL PUBLIC
-InitGClass(REG(a0, struct __gClass *gc), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
+InitGClass(REG(a0, struct __gClass *gc), REG(a1, APTR *functable), REG(a2, APTR mainpool), REG(a3, APTR gfxbase),
 	REG(a6, struct ExecBase *ExecBase), REG(d0, APTR mathbase), REG(d1, APTR mathtrans), REG(d2, APTR utilitybase), REG(d3, APTR localebase),
     REG(d4, long magic))
 {
@@ -95,45 +88,45 @@
     gc->gc_Interface = interface;
 	gc->gc_InstSize = gc->gc_InstOffset + instanceSize;
 
-    gcBase = table;
+    gcBase = functable;
     pool = mainpool;
 
 	// Initialize function pointers
-	AllocStringLength = table[-1].func;
-	AllocString = table[-2].func;
-	FreeString = table[-3].func;
-	gDoMethodA = table[-4].func;
-	gDoSuperMethodA = table[-5].func;
-	SetHighColor = table[-6].func;
-	SetColors = table[-7].func;
-	FindColorPen = table[-8].func;
-	DrawRect = table[-9].func;
-	DrawLine = table[-10].func;
-	gAreaMove = table[-11].func;
-	gAreaDraw = table[-12].func;
-	gAreaEnd = table[-13].func;
-	GetDPI = table[-14].func;
-	GetOffset = table[-15].func;
-	FreeFontInfo = table[-16].func;
-	SetFontInfoA = table[-17].func;
-	CopyFontInfo = table[-18].func;
-	NewFontInfoA = table[-19].func;
-	DrawText = table[-20].func;
-	OutlineLength = table[-21].func;
-	OutlineHeight = table[-22].func;
-	pixel = table[-23].func;
-	mm = table[-24].func;
-	CreateTerm = table[-25].func;
-	DeleteTerm = table[-26].func;
-	CopyTerm = table[-27].func;
-	CalcTerm = table[-28].func;
-	gInsertRemoveCellsTablePos = table[-29].func;
-	gInsertRemoveCellsTerm = table[-30].func;
-	TintColor = table[-31].func;
-	gSuperDraw = table[-32].func;
-	gGetLink = table[-33].func;
-	SetLowColor = table[-34].func;
-	SetOutlineColor = table[-35].func;
+	AllocStringLength = functable[34];
+	AllocString = functable[33];
+	FreeString = functable[32];
+	gDoMethodA = functable[31];
+	gDoSuperMethodA = functable[30];
+	SetHighColor = functable[29];
+	SetColors = functable[28];
+	FindColorPen = functable[27];
+	DrawRect = functable[26];
+	DrawLine = functable[25];
+	gAreaMove = functable[24];
+	gAreaDraw = functable[23];
+	gAreaEnd = functable[22];
+	GetDPI = functable[21];
+	GetOffset = functable[20];
+	FreeFontInfo = functable[19];
+	SetFontInfoA = functable[18];
+	CopyFontInfo = functable[17];
+	NewFontInfoA = functable[16];
+	DrawText = functable[15];
+	OutlineLength = functable[14];
+	OutlineHeight = functable[13];
+	pixel = functable[12];
+	mm = functable[11];
+	CreateTerm = functable[10];
+	DeleteTerm = functable[9];
+	CopyTerm = functable[8];
+	CalcTerm = functable[7];
+	gInsertRemoveCellsTablePos = functable[6];
+	gInsertRemoveCellsTerm = functable[5];
+	TintColor = functable[4];
+	gSuperDraw = functable[3];
+	gGetLink = functable[2];
+	SetLowColor = functable[1];
+	SetOutlineColor = functable[0];
 
 	if (!initClass(gc))
 		return FALSE;

Modified: trunk/add-ons/gclass.h
===================================================================
--- trunk/add-ons/gclass.h	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/add-ons/gclass.h	2008-12-26 10:56:50 UTC (rev 26)
@@ -27,10 +27,6 @@
 #include "cell.h"
 #endif
 
-typedef struct {
-	UWORD jsr;
-	APTR func;
-} TableEntry;
 
 /*** class ***/
 

Modified: trunk/add-ons/iotype.c
===================================================================
--- trunk/add-ons/iotype.c	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/add-ons/iotype.c	2008-12-26 10:56:50 UTC (rev 26)
@@ -80,17 +80,9 @@
 
 #define MAKE_ID(a,b,c,d) ((a << 24) | (b << 16) | (c << 8) | d)
 
-#ifdef __AROS__
-// ensure that InitModule becomes 1st function in segment
 BOOL PUBLIC
-InitModule(REG(a0, struct IOType *io), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
+InitModule(REG(a0, struct IOType *io), REG(a1, APTR *functable), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
 	REG(a6, struct ExecBase *execBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, APTR utilityBase),
-	REG(d3, APTR localeBase), REG(d4, long magic)) __attribute__((section(".aros.startup")));
-#endif
-
-BOOL PUBLIC
-InitModule(REG(a0, struct IOType *io), REG(a1, TableEntry *table), REG(a2, APTR mainpool), REG(a3, APTR dosBase),
-	REG(a6, struct ExecBase *execBase), REG(d0, APTR mathBase), REG(d1, APTR mathtransBase), REG(d2, APTR utilityBase),
 	REG(d3, APTR localeBase), REG(d4, long magic))
 {
 #ifdef IGNITION_LITE_EDITION
@@ -115,25 +107,25 @@
 	io->io_OpenPrefsGUI = openPrefsGUI;
 	io->io_ClosePrefsGUI = closePrefsGUI;
 
-	ioBase = table;
+	ioBase = functable;
 	pool = mainpool;
 
 	// Initialize function table
-	ReportErrorA = table[-15].func;
-	NewPage = table[-14].func;
-	CalculatePageDPI = table[-13].func;
-	NewCell = table[-12].func;
-	UpdateCellText = table[-11].func;
-	SetTableSize = table[-10].func;
-	FindColorPen = table[-9].func;
-	AddPen = table[-8].func;
-	Coord2String = table[-7].func;
-	pixel = table[-6].func;
-	mm = table[-5].func;
-	AllocStringLength = table[-4].func;
-	AllocString = table[-3].func;
-	FreeString = table[-2].func;
-	ita = table[-1].func;
+	ReportErrorA = functable[0];
+	NewPage = functable[1];
+	CalculatePageDPI = functable[2];
+	NewCell = functable[3];
+	UpdateCellText = functable[4];
+	SetTableSize = functable[5];
+	FindColorPen = functable[6];
+	AddPen = functable[7];
+	Coord2String = functable[8];
+	pixel = functable[9];
+	mm = functable[10];
+	AllocStringLength = functable[11];
+	AllocString = functable[12];
+	FreeString = functable[13];
+	ita = functable[14];
 
 	setPrefs(io->io_Prefs);
 

Modified: trunk/add-ons/iotype.h
===================================================================
--- trunk/add-ons/iotype.h	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/add-ons/iotype.h	2008-12-26 10:56:50 UTC (rev 26)
@@ -38,10 +38,6 @@
 #	include "cell.h"
 #endif
 
-typedef struct {
-	UWORD jsr;
-	APTR func;
-} TableEntry;
 
 /*** Project related ***/
 

Modified: trunk/classes.c
===================================================================
--- trunk/classes.c	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/classes.c	2008-12-26 10:56:50 UTC (rev 26)
@@ -1377,7 +1377,7 @@
 BOOL
 LoadGClass(struct gClass *gc)
 {
-	BOOL ASM (*initGCSegment)(REG(a0, APTR), REG(a1, APTR), REG(a2, APTR), REG(a3, APTR), REG(a6, APTR),
+	BOOL ASM (*initGCSegment)(REG(a0, APTR), REG(a1, APTR *), REG(a2, APTR), REG(a3, APTR), REG(a6, APTR),
 		REG(d0, APTR), REG(d1, APTR), REG(d2, APTR), REG(d3, APTR), REG(d4, long));
 	BPTR dir,olddir,segment;
 
@@ -1390,7 +1390,7 @@
 		if ((segment = LoadSeg(gc->gc_ClassName)) != 0)
 		{
 			initGCSegment = MKBADDR(segment) + sizeof(APTR);
-			if (initGCSegment(gc, (UBYTE *)gClassFuncTable + gClassFuncTableSize, pool, GfxBase, SysBase, MathIeeeDoubBasBase,
+			if (initGCSegment(gc, gClassFuncTable, pool, GfxBase, SysBase, MathIeeeDoubBasBase,
 					MathIeeeDoubTransBase, UtilityBase, LocaleBase,
 #ifdef IGNITION_LITE_EDITION
 					MAKE_ID('I','G','L',0)))

Modified: trunk/graphic.c
===================================================================
--- trunk/graphic.c	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/graphic.c	2008-12-26 10:56:50 UTC (rev 26)
@@ -281,45 +281,43 @@
 
 #define JSR 0x4ef9
 
-struct {
-	UWORD jsr;
-	APTR func;
-} gClassFuncTable[] = {
-	/* -210 */		  {JSR, SetOutlineColor},
-	/* -204 */		  {JSR, SetLowColor},
-	/* -198 */		  {JSR, gGetLink},
-	/* -192 */		  {JSR, gSuperDraw},
-	/* -186 */		  {JSR, TintColor},
-	/* -180 */		  {JSR, gInsertRemoveCellsTerm},
-	/* -174 */		  {JSR, gInsertRemoveCellsTablePos},
-	/* -168 */		  {JSR, CalcTerm},
-	/* -162 */		  {JSR, CopyTerm},
-	/* -156 */		  {JSR, DeleteTerm},
-	/* -150 */		  {JSR, CreateTerm},
-	/* -144 */		  {JSR, mm},
-	/* -138 */		  {JSR, pixel},
-	/* -132 */		  {JSR, OutlineHeight},
-	/* -126 */		  {JSR, OutlineLength},
-	/* -120 */		  {JSR, DrawText},
-	/* -114 */		  {JSR, NewFontInfoA},
-	/* -108 */		  {JSR, CopyFontInfo},
-	/* -102 */		  {JSR, SetFontInfoA},
-	/*  -96 */		  {JSR, FreeFontInfo},
-	/*  -90 */		  {JSR, GetOffset},
-	/*  -84 */		  {JSR, GetDPI},
-	/*  -78 */		  {JSR, libAreaEnd},
-	/*  -72 */		  {JSR, libAreaDraw},
-	/*  -66 */		  {JSR, libAreaMove},
-	/*  -60 */		  {JSR, DrawLine},
-	/*  -54 */		  {JSR, DrawRect},
-	/*  -48 */		  {JSR, FindColorPen},
-	/*  -42 */		  {JSR, SetColors},
-	/*  -36 */		  {JSR, SetHighColor},
-	/*  -30 */		  {JSR, gDoSuperMethodA},
-	/*  -24 */		  {JSR, gDoMethodA},
-	/*  -18 */		  {JSR, FreeString},
-	/*  -12 */		  {JSR, AllocString},
-	/*   -6 */		  {JSR, AllocStringLength}
+const APTR gClassFuncTable[] = {
+	/*  0 */ SetOutlineColor,
+	/*  1 */ SetLowColor,
+	/*  2 */ gGetLink,
+	/*  3 */ gSuperDraw,
+	/*  4 */ TintColor,
+	/*  5 */ gInsertRemoveCellsTerm,
+	/*  6 */ gInsertRemoveCellsTablePos,
+	/*  7 */ CalcTerm,
+	/*  8 */ CopyTerm,
+	/*  9 */ DeleteTerm,
+	/* 10 */ CreateTerm,
+	/* 11 */ mm,
+	/* 12 */ pixel,
+	/* 13 */ OutlineHeight,
+	/* 14 */ OutlineLength,
+	/* 15 */ DrawText,
+	/* 16 */ NewFontInfoA,
+	/* 17 */ CopyFontInfo,
+	/* 18 */ SetFontInfoA,
+	/* 19 */ FreeFontInfo,
+	/* 20 */ GetOffset,
+	/* 21 */ GetDPI,
+	/* 22 */ libAreaEnd,
+	/* 23 */ libAreaDraw,
+	/* 24 */ libAreaMove,
+	/* 25 */ DrawLine,
+	/* 26 */ DrawRect,
+	/* 27 */ FindColorPen,
+	/* 28 */ SetColors,
+	/* 29 */ SetHighColor,
+	/* 30 */ gDoSuperMethodA,
+	/* 31 */ gDoMethodA,
+	/* 32 */ FreeString,
+	/* 33 */ AllocString,
+	/* 34 */ AllocStringLength,
+	NULL
 };
 
 int32 gClassFuncTableSize = sizeof(gClassFuncTable);

Modified: trunk/io.c
===================================================================
--- trunk/io.c	2008-12-21 23:45:21 UTC (rev 25)
+++ trunk/io.c	2008-12-26 10:56:50 UTC (rev 26)
@@ -2417,23 +2417,24 @@
 
 #endif  // ENABLE_OLD_FORMAT
 
-const struct {UWORD jsr;APTR func;} io_functable[] = {
-		{0x4ef9, ErrorRequestA},
-		{0x4ef9, NewPage},
-		{0x4ef9, RecalcPageDPI},
-		{0x4ef9, AllocTableField},
-		{0x4ef9, ioUpdateTFText},
-		{0x4ef9, AllocTableSize},
-		{0x4ef9, FindColorPen},
-		{0x4ef9, ioAddPen},
-		{0x4ef9, AbsCoord2String},
-		{0x4ef9, pixel},
-		{0x4ef9, mm},
-		{0x4ef9, AllocStringLength},
-		{0x4ef9, AllocString},
-		{0x4ef9, FreeString},
-		{0x4ef9, ioita},
-	};  /* to be continued */
+const APTR io_functable[] = {
+	/*  0 */ ErrorRequestA,
+	/*  1 */ NewPage,
+	/*  2 */ RecalcPageDPI,
+	/*  3 */ AllocTableField,
+	/*  4 */ ioUpdateTFText,
+	/*  5 */ AllocTableSize,
+	/*  6 */ FindColorPen,
+	/*  7 */ ioAddPen,
+	/*  8 */ AbsCoord2String,
+	/*  9 */ pixel,
+	/* 10 */ mm,
+	/* 11 */ AllocStringLength,
+	/* 12 */ AllocString,
+	/* 13 */ FreeString,
+	/* 14 */ ioita,
+	NULL
+};  /* to be continued */
 
 
 void
@@ -2452,7 +2453,7 @@
 		if ((segment = LoadSeg(io->io_Filename)) != 0)
 		{
 			initIOSegment = MKBADDR(segment) + sizeof(APTR);
-			if (initIOSegment(io, (APTR)((UBYTE *)io_functable + sizeof(io_functable)), pool, DOSBase,
+			if (initIOSegment(io, io_functable, pool, DOSBase,
 					SysBase, MathIeeeDoubBasBase, MathIeeeDoubTransBase, UtilityBase, LocaleBase, MAKE_ID('I','G','N',0)))
 				io->io_Segment = segment;
 			else



From marust at mail.berlios.de  Fri Dec 26 14:30:25 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Fri, 26 Dec 2008 14:30:25 +0100
Subject: [Ignition-commits] r27 - in trunk: . libs
Message-ID: <200812261330.mBQDUPZM015111@sheep.berlios.de>

Author: marust
Date: 2008-12-26 14:30:19 +0100 (Fri, 26 Dec 2008)
New Revision: 27
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=27&view=rev

Added:
   trunk/safeclip.c
   trunk/safeclip.h
Modified:
   trunk/graphic.c
   trunk/graphic.h
   trunk/libs/compatibility.c
   trunk/mmakefile.src
Log:
* SafeClip rewritten because orignal contained assembler code.
  Alltough current clipping is implemented very naive it doesn't
  seem to cause graphics corruption. (Maybe the real reason for
  the graphics corruption on AROS was unclosed areas.)
  Now the pseudo 3D diagrams are working on AROS.


Modified: trunk/graphic.c
===================================================================
--- trunk/graphic.c	2008-12-26 10:56:50 UTC (rev 26)
+++ trunk/graphic.c	2008-12-26 13:30:19 UTC (rev 27)
@@ -8,12 +8,8 @@
 #include "types.h"
 #include "funcs.h"
 #include "classes.h"
+#include "safeclip.h"
 
-#if defined(HAVE_SAVECLIP)
-// library exits only on 68k
-#include <safeclip.h>
-#endif
-
 #define AREABUFFERS 300
 
 struct MinList colors;
@@ -28,12 +24,7 @@
 void
 gInitArea(long xmin, long ymin, long xmax, long ymax)
 {
-#if defined(HAVE_SAFECLIP)
-	CLP_xmin = xmin;
-	CLP_ymin = ymin;
-	CLP_xmax = xmax;
-	CLP_ymax = ymax;
-#endif
+	SafeSetLimits(xmin, ymin, xmax, ymax);
 }
 
 

Modified: trunk/graphic.h
===================================================================
--- trunk/graphic.h	2008-12-26 10:56:50 UTC (rev 26)
+++ trunk/graphic.h	2008-12-26 13:30:19 UTC (rev 27)
@@ -661,15 +661,9 @@
 extern struct colorPen *AddColor(struct MinList *list, STRPTR name, UBYTE red, UBYTE green, UBYTE blue);
 
 // graphic.c
-#if defined(HAVE_SAFECLIP)
-#	define gAreaMove(rp,x,y) SafeAreaDraw(x,y)
-#	define gAreaDraw(rp,x,y) SafeAreaDraw(x,y)
-#	define gAreaEnd(rp) SafeAreaEnd(rp)
-#else
-#	define gAreaMove(rp,x,y) AreaMove(rp,x,y)
-#	define gAreaDraw(rp,x,y) AreaDraw(rp,x,y)
-#	define gAreaEnd(rp) AreaEnd(rp)
-#endif
+#define gAreaMove(rp,x,y) SafeAreaDraw(x,y)
+#define gAreaDraw(rp,x,y) SafeAreaDraw(x,y)
+#define gAreaEnd(rp) SafeAreaEnd(rp)
 
 extern ULONG SafeInit (ULONG nvertmax);
 extern void SafeClose (void);

Modified: trunk/libs/compatibility.c
===================================================================
--- trunk/libs/compatibility.c	2008-12-26 10:56:50 UTC (rev 26)
+++ trunk/libs/compatibility.c	2008-12-26 13:30:19 UTC (rev 27)
@@ -70,18 +70,3 @@
 }
 
 #endif
-
-
-#if !defined(HAVE_SAFECLIP)
-
-ULONG SafeInit (ULONG nvertmax)
-{
-	return 0;
-}
-
-
-void SafeClose (void)
-{
-}
-
-#endif

Modified: trunk/mmakefile.src
===================================================================
--- trunk/mmakefile.src	2008-12-26 10:56:50 UTC (rev 26)
+++ trunk/mmakefile.src	2008-12-26 13:30:19 UTC (rev 27)
@@ -55,6 +55,7 @@
 	project \
 	reference \
     rexx \
+	safeclip \
 	screen \
 	search \
 	support \

Added: trunk/safeclip.c
===================================================================
--- trunk/safeclip.c	2008-12-26 10:56:50 UTC (rev 26)
+++ trunk/safeclip.c	2008-12-26 13:30:19 UTC (rev 27)
@@ -0,0 +1,93 @@
+/* Clipping for Area... functions
+ *
+ * Copyright ?1996-2008 pinc Software. All Rights Reserved.
+ * Licensed under the terms of the GNU General Public License, version 3.
+ */
+
+#include "safeclip.h"
+
+#include <proto/exec.h>
+#include <proto/graphics.h>
+
+
+static LONG clp_xmin, clp_ymin, clp_xmax, clp_ymax;
+static ULONG clp_nvert, clp_nvertmax;
+
+static struct CLP_Vert {
+	LONG x;
+	LONG y;
+} *clp_vert;
+
+static LONG Clip2d (LONG n);
+
+
+ULONG SafeInit (ULONG nvertmax)
+{
+	clp_nvertmax = nvertmax;
+	clp_vert = AllocVec(nvertmax * sizeof(struct CLP_Vert), MEMF_ANY);
+	if (clp_vert)
+		return 0;
+	else {
+		clp_vert = 0;
+		return 1;
+	}
+}
+
+VOID SafeClose (VOID)
+{
+	FreeVec(clp_vert);
+}
+
+VOID SafeSetLimits (LONG x1, LONG y1, LONG x2, LONG y2)
+{
+	clp_xmin = x1;
+	clp_ymin = y1;
+	clp_xmax = x2;
+	clp_ymax = y2;
+}
+
+VOID SafeAreaDraw (LONG x, LONG y)
+{
+	if (clp_nvert < clp_nvertmax) {
+		clp_vert[clp_nvert].x = x;
+		clp_vert[clp_nvert].y = y;
+		clp_nvert++;
+	}
+}
+
+VOID SafeAreaEnd (struct RastPort *rp)
+{
+	int i;
+
+	if (clp_nvert > 0) {
+		SafeAreaDraw(clp_vert[0].x, clp_vert[0].y); // close area
+		clp_nvert = Clip2d(clp_nvert);
+		AreaMove(rp, clp_vert[0].x, clp_vert[0].y);
+		for (i = 1; i < clp_nvert; i++) {
+			AreaDraw(rp, clp_vert[i].x, clp_vert[i].y);
+		}
+		AreaEnd(rp);
+		clp_nvert = 0;
+	}
+}
+
+static LONG Clip2d (LONG n)
+{
+	int i;
+	
+	if (clp_vert == NULL)
+		return 0;
+	
+	// TODO: improve clipping
+	for (i = 0; i < clp_nvert; i++) {
+		if (clp_vert[i].x < clp_xmin)
+			clp_vert[i].x = clp_xmin;
+		if (clp_vert[i].x > clp_xmax)
+			clp_vert[i].x = clp_xmax;
+		if (clp_vert[i].y < clp_ymin)
+			clp_vert[i].y = clp_ymin;
+		if (clp_vert[i].y > clp_ymax)
+			clp_vert[i].y = clp_ymax;
+	}
+	return n;
+}


Property changes on: trunk/safeclip.c
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native

Added: trunk/safeclip.h
===================================================================
--- trunk/safeclip.h	2008-12-26 10:56:50 UTC (rev 26)
+++ trunk/safeclip.h	2008-12-26 13:30:19 UTC (rev 27)
@@ -0,0 +1,19 @@
+/* Clipping for Area... functions
+ *
+ * Copyright ?1996-2008 pinc Software. All Rights Reserved.
+ * Licensed under the terms of the GNU General Public License, version 3.
+ */
+
+#ifndef SAFECLIP_H
+#define SAFECLIP_H
+
+#include <exec/types.h>
+#include <graphics/rastport.h>
+
+ULONG SafeInit (ULONG nvertmax);
+VOID SafeClose (VOID);
+VOID SafeSetLimits (LONG x1, LONG y1, LONG x2, LONG y2);
+VOID SafeAreaDraw (LONG x, LONG y);
+VOID SafeAreaEnd (struct RastPort *rp);
+
+#endif // SAFECLIP_H


Property changes on: trunk/safeclip.h
___________________________________________________________________
Name: svn:keywords
   + Id Date Revision Author
Name: svn:eol-style
   + native



From marust at mail.berlios.de  Fri Dec 26 16:21:44 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Fri, 26 Dec 2008 16:21:44 +0100
Subject: [Ignition-commits] r28 - in trunk: . add-ons
	libs/gtdrag/include/clib libs/include
Message-ID: <200812261521.mBQFLi6W026385@sheep.berlios.de>

Author: marust
Date: 2008-12-26 16:21:39 +0100 (Fri, 26 Dec 2008)
New Revision: 28
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=28&view=rev

Modified:
   trunk/add-ons/gclass_protos.h
   trunk/add-ons/iotype.h
   trunk/font.h
   trunk/funcs.h
   trunk/graphic.h
   trunk/libs/gtdrag/include/clib/gtdrag_protos.h
   trunk/libs/include/SDI_compiler.h
   trunk/windows.h
Log:
* Added SDI_compiler macro VARARG68K to all variadic functions.
  This should ensure that parameters are passed on the stack.


Modified: trunk/add-ons/gclass_protos.h
===================================================================
--- trunk/add-ons/gclass_protos.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/add-ons/gclass_protos.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -70,8 +70,8 @@
 void (*SetOutlineColor)(struct RastPort *rp,ULONG color);
 
 /* variadic functions must be real functions */
-ULONG gDoMethod(APTR go,LONG data,...);
-ULONG gDoSuperMethod(struct gClass *gc,APTR go,LONG data,...);
-struct FontInfo *SetFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag1,...);
+ULONG gDoMethod(APTR go,LONG data,...) VARARG68K;
+ULONG gDoSuperMethod(struct gClass *gc,APTR go,LONG data,...) VARARG68K;
+struct FontInfo *SetFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag1,...) VARARG68K;
 
 #endif  /* CLIB_GCLASS_PROTOS_H */

Modified: trunk/add-ons/iotype.h
===================================================================
--- trunk/add-ons/iotype.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/add-ons/iotype.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -443,7 +443,7 @@
 STRPTR (*ita)(double d,long komma ,UBYTE flags);
 
 // variadic functions must be real functions
-void   ReportError(STRPTR fmt, ...);
+void   ReportError(STRPTR fmt, ...) VARARG68K;
 
 #if defined(__SASC)
 #	pragma tagcall ioBase ReportError 5a 9802

Modified: trunk/font.h
===================================================================
--- trunk/font.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/font.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -99,9 +99,9 @@
 extern ULONG PUBLIC OutlineHeight(REG(a0, struct FontInfo *fi),REG(a1, STRPTR text),REG(d0, long len));
 extern void PUBLIC FreeFontInfo(REG(a0, struct FontInfo *fi));
 extern struct FontInfo * PUBLIC NewFontInfoA(REG(a0, struct FontInfo *fi),REG(d0, ULONG dpi),REG(a1, struct TagItem *ti));
-extern struct FontInfo *NewFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag,...);
+extern struct FontInfo *NewFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag,...) VARARG68K;
 extern struct FontInfo * PUBLIC SetFontInfoA(REG(a0, struct FontInfo *fi),REG(d0, ULONG dpi),REG(a1, struct TagItem *ti));
-extern struct FontInfo *SetFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag,...);
+extern struct FontInfo *SetFontInfo(struct FontInfo *fi,ULONG dpi,ULONG tag,...) VARARG68K;
 extern struct FontInfo * PUBLIC CopyFontInfo(REG(a0, struct FontInfo *fi));
 
 #endif   /* IGN_FONT_H */

Modified: trunk/funcs.h
===================================================================
--- trunk/funcs.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/funcs.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -102,10 +102,10 @@
 extern void InitPrinter(void);
 
 // lock.c
-extern struct LockNode *FindLockNode(struct MinList *list,ULONG length,...);
+extern struct LockNode *FindLockNode(struct MinList *list,ULONG length,...) VARARG68K;
 extern void RemLockNode(struct LockNode *ln);
-extern void RemLockNodeData(struct MinList *list,ULONG length,...);
-extern struct LockNode *AddLockNode(struct MinList *list,BYTE pri,APTR func,ULONG length,...);
+extern void RemLockNodeData(struct MinList *list,ULONG length,...) VARARG68K;
+extern struct LockNode *AddLockNode(struct MinList *list,BYTE pri,APTR func,ULONG length,...) VARARG68K;
 extern struct LockNode *AddFreeLock(APTR list,struct Window *win);
 extern struct LockNode *AddListViewLock(struct MinList *list,struct Window *win,struct Gadget *gad);
 extern struct LockNode *AddTreeLock(struct MinList *list,struct Window *win,struct Gadget *gad);
@@ -154,7 +154,7 @@
 extern void RemoveRexxPort(struct RexxPort *rxp);
 extern void FreeRexxScript(struct RexxScript *rxs);
 extern ULONG RunRexxScript(UBYTE type,STRPTR name);
-extern ULONG RexxCall(ULONG (*func)(long *opts),...);
+extern ULONG RexxCall(ULONG (*func)(long *opts),...) VARARG68K;
 extern void CloseRexx(void);
 extern void initRexx(void);
 
@@ -212,11 +212,11 @@
 extern int32 ConvertTime(STRPTR s);
 extern double ConvertNumber(STRPTR s,UBYTE targettype);
 extern void WriteChunkString(APTR iff,STRPTR t);
-extern void MakeLocaleStrings(struct MinList *list, LONG id, ...);
-extern struct List *MakeLocaleStringList(LONG id, ...);
+extern void MakeLocaleStrings(struct MinList *list, LONG id, ...) VARARG68K;
+extern struct List *MakeLocaleStringList(LONG id, ...) VARARG68K;
 extern void FreeStringList(struct List *list);
-extern void MakeStrings(struct MinList *list, const STRPTR string, ...);
-extern struct List *MakeStringList(const STRPTR string, ...);
+extern void MakeStrings(struct MinList *list, const STRPTR string, ...) VARARG68K;
+extern struct List *MakeStringList(const STRPTR string, ...) VARARG68K;
 extern ULONG DoClassMethodA(Class *cl,Msg msg);
 extern BOOL IsDoubleClick(WORD entry);
 extern struct Node *HandleLVRawKeys(struct Gadget *lvgad,struct Window *win,struct MinList *list,long itemheight);
@@ -259,7 +259,7 @@
 extern void UpdateMapTitle(struct Mappe *mp);
 extern STRPTR GetPageTitle(struct Page *page);
 extern void SetProjectMouseReport(struct Page *page,BOOL set);
-extern void UpdatePageFont(struct Page *page,ULONG tag,...);
+extern void UpdatePageFont(struct Page *page,ULONG tag,...) VARARG68K;
 extern void UpdateProjPage(struct Window *win,struct Page *page);
 extern void ProjectToGObjects(struct Page *page,struct winData *wd);
 extern void ASM handleProjIDCMP(REG(a0, struct TagItem *tags));
@@ -274,7 +274,7 @@
 
 // ignition.c
 extern void NormalizeWindowBox(struct IBox *box);
-extern struct Window *OpenProjWindow(struct Page *,ULONG,...);
+extern struct Window *OpenProjWindow(struct Page *,ULONG,...) VARARG68K;
 extern struct Gadget *MakeProjectGadgets(struct winData *,long w,long h);
 extern void MakeMarkText(struct Page *page,STRPTR t);
 extern void DisplayTablePos(struct Page *page);

Modified: trunk/graphic.h
===================================================================
--- trunk/graphic.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/graphic.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -710,9 +710,9 @@
 extern struct gObject *gMakeRefObject(struct Page *page, struct gClass *gc, struct gObject *go, const STRPTR undoText);
 extern ULONG GetGObjectAttr(struct gObject *go,ULONG tag,ULONG *data);
 extern void gSetObjectAttrsA(struct Page *page,struct gObject *go,struct TagItem *tags);
-extern void gSetObjectAttrs(struct Page *page,struct gObject *go,ULONG tag1,...);
+extern void gSetObjectAttrs(struct Page *page,struct gObject *go,ULONG tag1,...) VARARG68K;
 extern void SetGObjectAttrsA(struct Page *page,struct gObject *go,struct TagItem *tag);
-extern void SetGObjectAttrs(struct Page *page,struct gObject *go,ULONG tag1,...);
+extern void SetGObjectAttrs(struct Page *page,struct gObject *go,ULONG tag1,...) VARARG68K;
 extern void RefreshGObjectBounds(struct Page *page,struct gObject *go);
 extern void RemoveGObject(struct Page *page,struct gObject *go,BYTE draw);
 extern void AddGObject(struct Page *page,struct gGroup *gg,struct gObject *go,BYTE draw);
@@ -728,9 +728,9 @@
 extern BOOL HandleGObjects(struct Page *page);
 extern void PrepareCreateObject(struct Page *page,struct gClass *gc,BOOL more);
 extern ULONG gDoClassMethodA(struct gClass *gc,APTR go,Msg msg);
-extern ULONG gDoClassMethod(struct gClass *gc,APTR go,ULONG id,...);
+extern ULONG gDoClassMethod(struct gClass *gc,APTR go,ULONG id,...) VARARG68K;
 extern ULONG PUBLIC gDoMethodA(REG(a0, APTR go),REG(a1, Msg msg));
-extern ULONG gDoMethod(APTR go,ULONG id,...);
+extern ULONG gDoMethod(APTR go,ULONG id,...) VARARG68K;
 extern ULONG PUBLIC gDoSuperMethodA(REG(a0, struct gClass *gc),REG(a1, APTR go),REG(a2, Msg msg));
 extern BOOL PUBLIC gIsSubclassFrom(REG(a0, struct gClass *gc),REG(a1, struct gClass *supergc));
 extern void PUBLIC gSuperDraw(REG(d0, struct Page *page),REG(d1, ULONG dpi),REG(a0, struct RastPort *rp),REG(a1, struct gClass *gc),REG(a2, struct gObject *go),REG(a3, struct gBounds *gb));

Modified: trunk/libs/gtdrag/include/clib/gtdrag_protos.h
===================================================================
--- trunk/libs/gtdrag/include/clib/gtdrag_protos.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/libs/gtdrag/include/clib/gtdrag_protos.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -29,17 +29,17 @@
 /* Handling functions */
 /**/
 int GTD_AddAppA(STRPTR t,struct TagItem *tag);
-int GTD_AddApp(STRPTR t,ULONG tag1,...);
+int GTD_AddApp(STRPTR t,ULONG tag1,...) VARARG68K;
 void GTD_RemoveApp(void);
 void GTD_AddWindowA(struct Window *win,struct TagItem *tag);
-void GTD_AddWindow(struct Window *win,ULONG tag1,...);
+void GTD_AddWindow(struct Window *win,ULONG tag1,...) VARARG68K;
 void GTD_RemoveWindow(struct Window *);
 void GTD_AddGadgetA(ULONG type,struct Gadget *gad,struct Window *win,struct TagItem *tag);
-void GTD_AddGadget(ULONG type,struct Gadget *gad,struct Window *win,ULONG tag1,...);
+void GTD_AddGadget(ULONG type,struct Gadget *gad,struct Window *win,ULONG tag1,...) VARARG68K;
 void GTD_RemoveGadget(struct Gadget *);
 void GTD_RemoveGadgets(struct Window *);
 void GTD_SetAttrsA(APTR gad,struct TagItem *tags);
-void GTD_SetAttrs(APTR gad,ULONG tag1,...);
+void GTD_SetAttrs(APTR gad,ULONG tag1,...) VARARG68K;
 BOOL GTD_GetAttr(APTR gad,ULONG tag,ULONG *storage);
 struct Hook *GTD_GetHook(ULONG type);
 STRPTR GTD_GetString(struct ObjectDescription *od,STRPTR buf,LONG len);

Modified: trunk/libs/include/SDI_compiler.h
===================================================================
--- trunk/libs/include/SDI_compiler.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/libs/include/SDI_compiler.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -227,6 +227,8 @@
   #undef REGARGS
   #define REGARGS
 
+  #undef VARARG68K
+  #define VARARG68K __stackparm
 #endif /* __AROS__ */
 
 /*************************************************************************/

Modified: trunk/windows.h
===================================================================
--- trunk/windows.h	2008-12-26 13:30:19 UTC (rev 27)
+++ trunk/windows.h	2008-12-26 15:21:39 UTC (rev 28)
@@ -231,8 +231,8 @@
 extern void PUBLIC PatternPopper(REG(a0, struct RastPort *rp),REG(d0, UWORD x),REG(d1, UWORD y),REG(d2, UWORD cols),REG(d3, UWORD rows));
 extern void PUBLIC ColorPopper(REG(a0, struct RastPort *rp),REG(d0, UWORD x),REG(d1, UWORD y),REG(d2, UWORD cols),REG(d3, UWORD rows));
 extern long PopColors(struct Window *win,struct Gadget *gad);
-extern long PopUpTable(struct Window *win,struct Gadget *refgad,UWORD cols,UWORD rows,APTR func,ULONG tag1,...);
-extern long PopUpList(struct Window *,struct Gadget *,struct MinList *,ULONG tag1,...);
+extern long PopUpTable(struct Window *win,struct Gadget *refgad,UWORD cols,UWORD rows,APTR func,ULONG tag1,...) VARARG68K;
+extern long PopUpList(struct Window *,struct Gadget *,struct MinList *,ULONG tag1,...) VARARG68K;
 extern void ClosePopUpText(void);
 extern void ShowPopUpText(STRPTR t,long wx,long wy);
 
@@ -244,12 +244,12 @@
 extern void CloseAppScreen(struct Screen *scr);
  
 // windows.c
-extern long DoRequest(CONST_STRPTR t,CONST_STRPTR gads,...);
-extern void ErrorRequest(CONST_STRPTR t,...);
+extern long DoRequest(CONST_STRPTR t,CONST_STRPTR gads,...) VARARG68K;
+extern void ErrorRequest(CONST_STRPTR t,...) VARARG68K;
 extern void PUBLIC ErrorRequestA(REG(a0, CONST_STRPTR t),REG(a1, APTR args));
 extern void ErrorOpenLibrary(STRPTR lib,STRPTR paket);
-extern void MakeLocaleLabels(const char *labels[], ULONG id, ...);
-extern void MakeShortCutString(STRPTR shortCuts, ULONG ids, ...);
+extern void MakeLocaleLabels(const char *labels[], ULONG id, ...) VARARG68K;
+extern void MakeShortCutString(STRPTR shortCuts, ULONG ids, ...) VARARG68K;
 extern void SetBusy(BOOL set,BYTE type);
 extern void DisposeProgressBar(struct ProgressBar *pb);
 extern struct ProgressBar *NewProgressBar(struct Window *win,long x,long y,long w,long h);
@@ -258,11 +258,11 @@
 extern void StandardNewSize(void (*create)(struct winData *,long,long));
 extern BOOL WindowIsProjectDependent(long type);
 extern void RefreshAppWindow(struct Window *win,struct winData *wd);
-extern struct Window *OpenAppWindow(long type,ULONG tag1,...);
+extern struct Window *OpenAppWindow(long type,ULONG tag1,...) VARARG68K;
 extern void CloseAppWindow(struct Window *win,BOOL);
 extern void DisableGadget(struct Gadget *gad,struct Window *win,BOOL disable);
 extern long CountGadToolGads(struct Window *win);
-extern APTR NewObj(struct winData *,short type,APTR,STRPTR,ULONG tag1,...);
+extern APTR NewObj(struct winData *,short type,APTR,STRPTR,ULONG tag1,...) VARARG68K;
 extern void DrawDithRect(struct RastPort *rp,long x1,long y1,long x2,long y2);
 extern void DrawGroupBorder(struct RastPort *rp, CONST_STRPTR t,long x, long y, long w, long h);
 extern void PUBLIC DrawRect(REG(a0, struct RastPort *rp),REG(d0, long x),REG(d1, long y),REG(d2, long w),REG(d3, long h));



From marust at mail.berlios.de  Fri Dec 26 16:55:18 2008
From: marust at mail.berlios.de (marust at mail.berlios.de)
Date: Fri, 26 Dec 2008 16:55:18 +0100
Subject: [Ignition-commits] r29 - trunk
Message-ID: <200812261555.mBQFtI6e029912@sheep.berlios.de>

Author: marust
Date: 2008-12-26 16:55:16 +0100 (Fri, 26 Dec 2008)
New Revision: 29
ViewCVS: http://svn.berlios.de/viewcvs/ignition?rev=29&view=rev

Modified:
   trunk/diagram.c
Log:
* Fix for a segfault which happened when diagram window was closed
  with "OK" without prior selecting a diagram.


Modified: trunk/diagram.c
===================================================================
--- trunk/diagram.c	2008-12-26 15:21:39 UTC (rev 28)
+++ trunk/diagram.c	2008-12-26 15:55:16 UTC (rev 29)
@@ -2195,7 +2195,8 @@
 				case 33:
 				{
 					// don't let CloseDiagramWindow() free this object
-					gd->gd_Object.go_Window = NULL;
+					if (gd)
+						gd->gd_Object.go_Window = NULL;
 					wd->u.diagram.wd_CurrentDiagram = NULL;
 					CloseAppWindow(win, TRUE);
 



